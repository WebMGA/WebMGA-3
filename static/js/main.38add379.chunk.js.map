{"version":3,"sources":["Model/Shapes.ts","Model/Light.ts","Model/Parameters.js","Model/Set.js","Model/ReferenceTools.js","Model/Model.tsx","View/Tools.js","View/GeneralMenu.js","View/SubMenus.js","View/VisualisationMenu.js","View/View.js","Controller.js","App.js","index.js"],"names":["linspace","start","stop","number","increment","values","i","push","base","Shape","LOD","parameters","stripGeometry","this","arguments","default_lod","undefined","lod","complexity_count","complexity","math","map","value","LightTypes","Sphere","radius","vertical_sample_scale","samples","vertical_samples","update_samples","Math","max","genGeometries","theta","phi","sin_phi","sin","cos","thetas","phis","offset_thetas","PI","result","entries","phi_index","abc","sample_sphere","vertices","vertex_row","vertex","floor","slice","phi_offset","spherical_vertices","quarter_thetas","bottom_half","rolled_vertices","roll_offset","length","concat","toReversed","build_quarters","quarter_sphere_vertices","offset","cut","roll_vertices","build_halves","half_sphere_vertices","positions","row","row_column","position_components","to_triangles","geometry","BufferGeometry","setAttribute","BufferAttribute","Float32Array","BufferGeometryUtils","mergeVertices","computeVertexNormals","normalizeNormals","sub_geometries","generate_vertices","sub_vertices","geometry_from_vertices","mergeBufferGeometries","genGeometriesBase","Spherocylinder","length_scaling_vector","sphere_coordinate","Spheroplatelet","circle_radius","row_count","column_count","top","column","bottom","circle_angles","radius_vector","norm","face_circle_angles","x","normalised_radius_vector","Ellipsoid","y","z","scale","CapCutSphereBase","cut_radius","z_cut","flat_top","end_source_index","xs","ys","zs","end","Array","fill","CutSphere","DoubleCutSphere","angle_cut","partial_vertices","index","Cap","BaseLens","radius_2","angle","top_shape","bottom_cap","bottom_shape","set_lod","reverse","pole_offset","distance","ThickLens","thickness","cos_theta","Lens","RadiusOnlyLens","acos","Parameters","names","vals","Set","data","cp","ci","Folded_position","orientations","elements","meshes","Element","p","q","position","orientation","quaternionToUnitVector","euler","Euler","setFromQuaternion","colourIndex","quaternion","w","geoms","geometries","name","orientationType","unitBox","clippingPlanes","clipIntersection","setDefaults","shapeType","genSet","a","b","c","validateData","genElements","genMeshes","Error","toString","defaultParameters","getParameters","userColour","Color","colourByDirector","wireframe","renderBackFace","constant","isFoldedTest","pos","rnd1","random","rnd2","rnd3","Alert","info","lx","ly","lz","rx","ry","rz","round","bool","num","geometry_distances","distance_index","new_gen_geometries","rgb","colourMap","Model","rgbToHex","mat","MeshPhongMaterial","side","THREE","clipShadows","color","matrix2","ori","compose","lod_mesh","addLevel","applyMatrix4","getRotations","calculateDirector","elem","setColourIndex","calculateColourIndex","shape","SHAPE","generate","translate","type","rot","Quaternion","orientationVector","Vector3","normalize","setFromUnitVectors","set","setFromAxisAngle","e","fromArray","setFromEuler","n","orderTensor","factor","eigen","eigs","reduce","iMax","arr","director","vectors","sqrt","isNaN","error","element","scalarProduct","abs","hex","val","LightNew","lightType","light","helper","setLight","setHelper","AMBIENT","AmbientLight","DIRECTIONAL","DirectionalLight","POINT","PointLight","RangeError","DirectionalLightHelper","PointLightHelper","setHex","parseInt","substring","intensity","light_types","ReferenceTools","s","axes","size","colour","material","LineBasicMaterial","linewidth","multicolour","genMulticolourAxes","genSubgrid","R","G","B","director_colour","boundingShapeType","setsGeometry","sets","boundingShape","genUnitBox","box","Box3","setFromCenterAndSize","Box3Helper","genAxes","subGrid","GridHelper","console","log","axesSize","origin","Line","setFromPoints","director_vector","clone","multiplyScalar","mat1","mat2","mat3","mat4","updateColour","chronometer","notify","scene","camera","lighting","bgColour","controls","lookAt","tools","renderer","height","width","axesEnabled","sidebarExpanded","cameraType","cameraPosition","selectedSet","clippingHelpers","numOfObject","axes_enabled","colour_axes","onBeforeRender","set_axes","setDefault","WebGLRenderer","antialias","powerPreference","preserveDrawingBuffer","setPixelRatio","window","devicePixelRatio","rotating","lightHelperWarningGiven","Video_sample_list","initClippers","updateDimensions","setCamera","setClearColor","l","add","enabled","axes_origin","assert","zoom","axis","remove","divideScalar","world_axes_origin","localToWorld","axis_line_ends","director_line_ends","line_ends","line_materials","line_end","colour_from_director","line_geometry","vector","enable_colour","palette_start","palette_range","hue","lightness","min","dot","setHSL","render","click","traverse","child","isMesh","model","temp","updateCamera","autoRotate","id","params","f","m","updateSets","setUserColour","r","g","toggle","setData","clippingIntersections","getRender_Object_number","innerHeight","innerWidth","setSize","PerspectiveCamera","OrthographicCamera","OrbitControls","domElement","target","aspect","left","right","updateProjectionMatrix","update","warning","updatePosition","genFoldedPositionFromUnfold","passAxes","toggleAxes","toggleMulticolour","boundingShapeEnabled","genBoundingShape","localClippingEnabled","setBackFace","Plane","PlaneHelper","visible","updateSlicers","Promise","resolve","reject","fileHandle","lst","showOpenFilePicker","multiple","getFile","file","style","step","updateCameraZoom","updateLightPosition","deleteAllMeshes","testMaterial","testShape","testTotal","testLimit","testGeo","InstancedMesh1","InstancedMesh","InstancedMesh2","InstancedMesh3","matrix","Matrix4","rotation","setMatrixAt","setColorAt","componentToHex","Scene","ParameterSet","props","titles","title","numerical","positive","styling","ParameterInput","active","selectingSet","changeValue","bind","InputBox","defaultVal","InputNumber","defaultValue","onChange","act","listItems","localeCompare","Dropdown","Item","eventKey","onSelect","panel","ButtonToolbar","marginLeft","Row","marginTop","Col","md","React","Component","SliceSlider","useState","setValue","InputGroup","nextValue","parseFloat","Addon","RangeSlider","progress","CustomSlider","disabled","boundaries","Slider","marginBottom","ExportDropdown","dimensions","resolution","setResolution","setDimensions","export","trigger","placement","icon","Icon","marginRight","Button","appearance","onClick","LibraryDropdown","state","toggler","Menu","PerformanceDropdown","updateVal","setState","Form","layout","FormGroup","ControlLabel","Whisper","speaker","Tooltip","graduated","updateLOD","GeneralMenu","continuousRender","requestAnimationFrame","functions","fps","showDrawer","numOfRender","updateFPS","toggleDrawer","toggleAutorotate","runPerformanceTest","autorotate","closeSidemenu","initTesting","testing","toFixed","Header","Navbar","Body","Nav","pullRight","spin","display","className","accept","files","htmlFor","padding","Drawer","show","onHide","backdrop","Title","href","rel","margin","TITLE_LEFT_MARGIN","dividerStyle","submenuParameterSetStyling","ModelsOptions","View","selectShape","selectSet","updateParameter","toggleWireframe","toggleColour","updateUserColour","configurations","colourFromDirector","toggleUserColour","displayAsWireframe","parameter","globalState","configs","updateShape","reset","configState","Divider","Checkbox","checked","VideoOptions","reference","setfps","UploadFiles","RealTimeVideo","VideoToggle","setVideoState","filename","setFileName","uploaded","runAfterUpload","uploadConfig","then","notifyFinishUpload","vidstate","loadVideoState","video","retrieveVideoSample","max_iter","capturer","ccapture","format","framerate","quality","vidState","capture","save","blob","url","URL","createObjectURL","link","document","createElement","download","body","appendChild","removeChild","upload","Grid","fluid","Input","placeholder","CameraOptions","selectType","updateLookat","updateZoom","updateState","updateCameraPosition","updateLookAt","controlId","RadioGroup","Radio","JSON","stringify","SlicingOptions","slicing","toggleSlicer","toggleHelperX","toggleHelperY","toggleHelperZ","updateHelpers","updateSlicer","slicing_enabled","enableClipping","helpers","toggleHelper","ty","AdditionalLightsNav","activeKey","justified","AdditionalLightOptions","pointLight","handleSelect","toggleLightEnabled","directionalLight","toggleLightHelper","updateLight","lightState","AmbientLightOptions","ambientLight","updateBg","ambientLightColour","darkBackGround","backgroundColour","ReferenceOptions","toggleFold","toggleBoundingShapeEnabled","toggle_axes_enabled","toggle_axes_colour","displayFoldState","toggleFoldState","updateBoundingShape","activeShape","toggleAxesMulticolour","showAxes","NavToggle","expand","IconButton","circle","textAlign","navItemStyle","sidebarHeight","CustomNav","backgroundColor","MenuContent","menuContent","VisualisationMenu","handleToggle","toggleSidebar","Sidebar","flexDirection","collapsible","Container","vertical","Content","io","chrono","ModelDefaultState","SlicingDefaultState","ConfigurationDefaultState","CameraDefaultState","PointLightDefaultState","DirectionalLightDefaultState","ReferenceDefaultState","AmbientLightDefaultState","expanded","header","sidebar","vid","loadLightingAndCamera","loadReferenceAndSlicing","loadModel","substate","xor","directionalLightColour","parse","pointLightColour","init","loadState","Controller","ExternalToggle","Chronometer","externalToggle","logPerformance","rawPerformanceData","counter","tick","avgPerformanceData","mean","stdPerformanceData","std","addRandomParticles","frames","prevTime","Date","now","time","sample2","addListeners","Blob","navigator","msSaveOrOpenBlob","setTimeout","revokeObjectURL","getData","view","saveVideoState","starting","genSets","setDefaultState","load","VIDEO","fileReader","FileReader","onloadend","split","pop","toLowerCase","qmga_to_json","cnf_to_json","success","readAsText","loadSample","sample","sample1","sample3","sample4","sample5","sample6","sample7","sample8","sample9","sample10","sample11","sample12","sample13","sample14","sample15","unfolded_sample1","unfolded_sample2","dataURL","toDataURL","getHeader","getSidebar","getDomElement","addEventListener","overflow","onkeydown","code","config","duration","description","Notification","split_data","trim","unit_box","molecule_count","molecule_number","molecule_data","App","controller","mount","ref","ReactDOM","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.38add379.chunk.js","sourcesContent":["import {BufferAttribute, BufferGeometry} from 'three';\nimport {BufferGeometryUtils} from 'three/examples/jsm/utils/BufferGeometryUtils';\nimport * as math from \"mathjs\";\n\nfunction linspace(start: number, stop: number, number: number): number[] {\n    let increment: number = (stop - start) / (number - 1)\n    let values: number[] = []\n    for (let i: number = 0; i < number; ++i) {\n        values.push(start + i * increment)\n    }\n    return values\n}\n\nfunction logspace(start: number, stop: number, number: number, base: number): number[] {\n    return linspace(start, stop, number).map(value => base ** value)\n}\n\nexport class Shape {\n\n    //complexity attributes\n    LOD;\n    static default_lod: number = 5\n    static complexity_count: number = 10\n    static complexity: number[] = math.multiply(math.round(math.divide(logspace(3, 7, Shape.complexity_count, 2), 2)), 2);\n\n    //shape model attributes\n    parameters;\n\n    //graphics components\n    stripGeometry?: BufferGeometry;\n\n    constructor() {\n        this.parameters = arguments[0];\n        this.LOD = Shape.default_lod;\n        this.stripGeometry = undefined;\n    }\n\n    set_lod(lod: number) {\n        this.LOD = lod\n    }\n}\n\nexport class Sphere extends Shape {\n    radius: number\n    samples: number = Sphere.complexity[this.LOD]\n    vertical_samples: number = this.samples\n    vertical_sample_scale: number\n\n    constructor(radius: number, vertical_sample_scale: number = 1) {\n        super();\n        this.radius = radius\n        this.vertical_sample_scale = vertical_sample_scale\n        this.update_samples()\n    }\n\n    update_samples(): void {\n        this.samples = Math.max(4, Sphere.complexity[this.LOD])\n        this.vertical_samples = Math.max(4, this.samples * this.vertical_sample_scale)\n        if (this.vertical_samples % 2 == 1) {\n            ++this.vertical_samples\n        }\n    }\n\n    set_lod(lod: number) {\n        super.set_lod(lod);\n        this.update_samples();\n    }\n\n    generate(): void {\n        this.update_samples();\n        this.genGeometries();\n    }\n\n    sample_sphere(radius: number, theta: number, phi: number): number[] {\n        let sin_phi: number = Math.sin(phi);\n        return math.multiply(radius, [sin_phi * Math.cos(theta), sin_phi * Math.sin(theta), Math.cos(phi)])\n    }\n\n    spherical_vertices(radius: number, thetas: math.MathArray, phis: math.MathArray, samples: number): number[][] {\n        let offset_thetas: math.MathType = math.add(thetas, math.divide(Math.PI, samples))\n        let result = []\n        for (let [phi_index, phi] of phis.entries()) {\n            let abc = []\n            for (let theta of ((phi_index % 2 == 0) ? thetas : offset_thetas)) {\n                abc.push(this.sample_sphere(radius, theta, phi))\n            }\n            result.push(abc)\n        }\n        return result\n    }\n\n    build_quarters(vertices: number[][][]): math.MathType {\n        return math.concat(vertices, vertices.map(vertex_row => vertex_row.map(vertex => [-vertex[0], -vertex[1], vertex[2]])), 1)\n    }\n\n    quarter_thetas(samples: number): number[] {\n        return linspace(0, Math.PI, Math.floor(samples / 2) + 1).slice(0, -1)\n    }\n\n    quarter_sphere_vertices(radius: number, samples: number, phi_offset: number, vertical_samples: number = samples): math.MathArray {\n        let phis: number[] = linspace(0, Math.PI / 2, Math.floor(vertical_samples / 2) - phi_offset)\n        return this.spherical_vertices(radius, this.quarter_thetas(samples), phis, samples)\n    }\n\n    build_halves(vertices: number[][][]): math.MathType {\n        return math.concat(vertices, this.bottom_half(vertices), 0)\n    }\n\n    bottom_half(vertices: math.MathArray): math.MathArray {\n        //Initially I used .reverse which broke stuff as it's in-place\n        let rolled_vertices = []\n        let roll_offset = math.floor(vertices[0].length / 2)\n        for (let vertex_row of vertices) {\n            rolled_vertices.push(vertex_row.slice(roll_offset).concat(vertex_row.slice(0, roll_offset)))\n        }\n        return math.multiply(rolled_vertices.toReversed(), -1).slice(1)\n    }\n\n    half_sphere_vertices(radius: number, samples: number, vertical_samples: number = samples): math.MathType {\n        return this.build_quarters(this.quarter_sphere_vertices(radius, samples, 0, vertical_samples))\n    }\n\n    roll_vertices(vertices: number[][][], offset: boolean = false) {\n        for (let i = 0; i < vertices.length; ++i) {\n            let cut = math.ceil((i + (offset ? 1 : 0)) / 2)\n            vertices[i] = vertices[i].slice(-cut).concat(vertices[i].slice(0, -cut))\n        }\n        return vertices\n    }\n\n    generate_vertices(): number[][][][] {\n        return [this.roll_vertices(this.build_halves(this.half_sphere_vertices(this.radius, this.samples, this.vertical_samples)))]\n    }\n\n    to_triangles(vertices: number[][][]) {\n        let positions: number[] = []\n        for (let row = 0; row < vertices.length; ++row) {\n            for (let row_column = 0; row_column < vertices[row].length; ++row_column) {\n                if (row > 0) {\n                    positions = positions.concat(vertices[row][row_column])\n                    positions = positions.concat(vertices[row][(row_column + 1) % vertices[row].length])\n                    positions = positions.concat(vertices[row - 1][(row_column) % vertices[row - 1].length])\n                }\n                //\n                if (row < vertices.length - 1) {\n                    positions = positions.concat(vertices[row][row_column])\n                    positions = positions.concat(vertices[row + 1][(row_column + 1) % vertices[row + 1].length])\n                    positions = positions.concat(vertices[row][(row_column + 1) % vertices[row].length])\n                }\n            }\n        }\n        return positions\n    }\n\n    geometry_from_vertices(vertices: number[][][], position_components: number): BufferGeometry {\n        let positions: number[] = this.to_triangles(vertices)\n        let geometry: BufferGeometry = new BufferGeometry();\n        geometry.setAttribute('position', new BufferAttribute(new Float32Array(positions), position_components));\n        geometry = BufferGeometryUtils.mergeVertices(geometry)\n        geometry.computeVertexNormals();\n        geometry.normalizeNormals();\n        return geometry\n    }\n\n    genGeometriesBase(position_components: number): BufferGeometry {\n        let sub_geometries = this.generate_vertices().map(sub_vertices => this.geometry_from_vertices(sub_vertices, position_components))\n        return BufferGeometryUtils.mergeBufferGeometries(sub_geometries)\n    }\n\n    genGeometries(): void {\n        const positionNumComponents: number = 3;\n        this.stripGeometry = this.genGeometriesBase(positionNumComponents)\n    }\n}\n\n//Spherocylinder mesh generator\nexport class Spherocylinder extends Sphere {\n    //Scaling vector (either side of centre) to stretch sphere into spherocylinder ([0, 0, length / 2])\n    length_scaling_vector: number[];\n\n    constructor(radius: number, length: number) {\n        //Derive from origin centred sphere of chosen radius\n        super(radius);\n        this.length_scaling_vector = [0, 0, length / 2];\n    }\n\n    //Samples from spherocylinder instead of sphere\n    sample_sphere(radius: number, theta: number, phi: number): number[] {\n        let sphere_coordinate: number[] = super.sample_sphere(radius, theta, phi);\n        //Stretch point in z direction by scale vector, matching stretch direction to sign of original vertex z\n        return sphere_coordinate[2] >= 0 ? math.add(sphere_coordinate, this.length_scaling_vector) : math.subtract(sphere_coordinate, this.length_scaling_vector);\n    }\n}\n\nexport class Spheroplatelet extends Sphere {\n    circle_radius: number\n\n    constructor(radius: number, circle_radius: number) {\n        super(radius);\n        this.circle_radius = circle_radius\n    }\n\n    generate_vertices(): math.MathType {\n        let vertices = super.generate_vertices()[0]\n        let row_count = math.size(vertices)[0]\n        let column_count = math.size(vertices)[1]\n        let top = [vertices[0].map(column => column.map(vertex => vertex))]\n        let bottom = [vertices[row_count - 1].map(column => column.map(vertex => vertex))]\n        let circle_angles = linspace(0, 2 * Math.PI, column_count + 1).slice(0, -1)\n        for (let row = 0; row < row_count; ++row) {\n            for (let column = 0; column < column_count; ++column) {\n                let radius_vector = vertices[row][column].slice(0, 2)\n                let norm = math.norm(radius_vector)\n                if (row == 0 || row == row_count - 1) {\n                    let face_circle_angles = circle_angles\n                    if (row == row_count - 1) {\n                        let offset = math.floor(row / 2) + 2\n                        face_circle_angles = circle_angles.slice(offset).concat(circle_angles.slice(0, offset))\n                    }\n                    let x = face_circle_angles[column]\n                    radius_vector = [math.cos(x), math.sin(x)]\n                    norm = 1\n                }\n                let normalised_radius_vector = math.multiply(this.circle_radius, math.divide(radius_vector, norm))\n                vertices[row][column][0] += normalised_radius_vector[0]\n                vertices[row][column][1] += normalised_radius_vector[1]\n            }\n        }\n        return [top.concat(vertices.slice(0, 1)), vertices, vertices.slice(-1).concat(bottom)]\n    }\n}\n\n//Ellipsoid mesh generator\nexport class Ellipsoid extends Sphere {\n    //Scale factor in [x, y, z] directions\n    scale: number[];\n\n    constructor(x: number, y: number, z: number) {\n        //Derive from origin centred sphere of radius 1\n        super(1);\n        this.scale = [x, y, z];\n    }\n\n    //Samples from ellipsoid instead of sphere\n    sample_sphere(radius: number, theta: number, phi: number): number[] {\n        //Multiply origin centred sphere coordinates by scale vector\n        return math.dotMultiply(super.sample_sphere(radius, theta, phi), this.scale);\n    }\n}\n\nexport class CapCutSphereBase extends Sphere {\n    cut_radius: number\n\n    constructor(radius: number, cut_radius: number, vertical_sample_scale: number = 1, z_cut: boolean = true) {\n        super(radius, vertical_sample_scale);\n        this.cut_radius = z_cut ? math.sqrt(math.square(radius) - math.square(cut_radius)) : cut_radius\n    }\n\n    base(phis: number[], flat_top: boolean) {\n        let vertices = this.roll_vertices(this.build_quarters(this.spherical_vertices(this.radius, this.quarter_thetas(this.samples), phis, this.samples)))\n        let end_source_index = flat_top ? 0 : vertices.length - 1\n        let xs = vertices[end_source_index].map(vertex => vertex[0])\n        let ys = vertices[end_source_index].map(vertex => vertex[1])\n        let zs = vertices[end_source_index].map(vertex => vertex[2])\n        let end = [new Array(math.size(vertices)[1]).fill([math.mean(xs), math.mean(ys), math.mean(zs)])]\n        return [vertices, flat_top ? end.concat(vertices.slice(0, 1)) : vertices.slice(-1).concat(end)]\n    }\n}\n\nexport class CutSphere extends CapCutSphereBase {\n    generate_vertices() {\n        let phis = linspace(math.asin(this.cut_radius / this.radius), Math.PI, this.vertical_samples - 1)\n        return super.base(phis, true)\n    }\n}\n\nexport class DoubleCutSphere extends CapCutSphereBase {\n    generate_vertices() {\n        let angle_cut = math.asin(this.cut_radius / this.radius)\n        let phis = linspace(angle_cut, Math.PI - angle_cut, this.vertical_samples - 2)\n        let partial_vertices = super.base(phis, true)\n        let index = partial_vertices[0].length - 1\n        let xs = partial_vertices[0][index].map(vertex => vertex[0])\n        let ys = partial_vertices[0][index].map(vertex => vertex[1])\n        let zs = partial_vertices[0][index].map(vertex => vertex[2])\n        let end = [new Array(math.size(partial_vertices[0])[1]).fill([math.mean(xs), math.mean(ys), math.mean(zs)])]\n        partial_vertices.push(end.concat([partial_vertices[0][index].toReversed()]))\n        return partial_vertices\n    }\n}\n\nexport class Cap extends CapCutSphereBase {\n    generate_vertices() {\n        let phis = linspace(0, math.asin(this.cut_radius / this.radius), this.vertical_samples - 1)\n        return super.base(phis, false)\n    }\n}\n\nexport class BaseLens extends Sphere {\n    radius_2: number\n    angle: number\n\n    constructor(radius: number, radius_2: number, angle: number) {\n        super(radius);\n        this.radius_2 = radius_2\n        this.angle = Math.PI - angle\n    }\n\n    generate_vertices(): math.MathType {\n        if (this.angle == 0) {\n            return super.generate_vertices()\n        }\n        let cut_radius = this.radius * Math.sin(this.angle)\n        let top_proportion = 0.5\n        let bottom_proportion = 0.5\n        let top_shape = new Cap(this.radius_2, cut_radius, top_proportion, false)\n        let bottom_cap = this.angle > Math.PI / 2\n        let bottom_shape = bottom_cap ? new Cap(this.radius, cut_radius, bottom_proportion, false) : new CutSphere(this.radius, cut_radius, bottom_proportion, false)\n        top_shape.set_lod(this.LOD)\n        bottom_shape.set_lod(this.LOD)\n        let top = math.multiply(top_shape.generate_vertices()[0], -1)\n        let bottom = bottom_shape.generate_vertices()[0]\n        if (bottom_cap) {\n            bottom.reverse()\n            for (let row = 0; row < math.size(bottom)[0]; ++row) {\n                bottom[row].reverse()\n                for (let column = 0; column < math.size(bottom)[1]; ++column) {\n                    bottom[row][column][1] *= -1\n                    bottom[row][column][2] *= -1\n                }\n            }\n        }\n        let pole_offset = bottom[bottom.length - 1][0][2]\n        bottom = bottom.map(row => row.map(vertex => math.multiply(math.subtract(vertex, [0, 0, pole_offset]), -1))).reverse()\n        let distance = bottom[bottom.length - 1][0][2] + top[top.length - 1][0][2]\n        top = top.map(row => row.map(vertex => math.add(math.multiply(vertex, -1), [0, 0, distance]))).reverse()\n        return [top, bottom]\n    }\n}\n\nexport class ThickLens extends BaseLens {\n    constructor(radius: number, thickness: number, angle: number) {\n        let cos_theta = Math.cos(Math.PI - angle)\n        let radius_2 = (2 * radius ** 2 * cos_theta + 2 * radius ** 2 - 2 * radius * thickness * cos_theta - 2 * radius * thickness + thickness ** 2) / (2 * (radius * cos_theta + radius - thickness))\n        super(radius, radius_2, angle);\n    }\n}\n\nexport class Lens extends BaseLens {\n    constructor(radius: number, angle: number) {\n        super(radius, radius, angle);\n    }\n}\n\nexport class RadiusOnlyLens extends BaseLens {\n    constructor(radius: number) {\n        let angle = Math.acos(1 - 1 / (2 * Math.PI * radius ** 2));\n        super(radius / 2, radius / 2, angle);\n    }\n}","import {Alert} from 'rsuite';\nimport {AmbientLight, DirectionalLight, DirectionalLightHelper, Light, PointLight, PointLightHelper} from 'three';\n\nenum LightTypes {\n    AMBIENT = 0,\n    DIRECTIONAL,\n    POINT\n}\n\nexport class LightNew {\n    static light_types = LightTypes;\n    light: Light;\n    helper: DirectionalLightHelper | PointLightHelper | undefined;\n\n    constructor(lightType: LightTypes) {\n        this.light = this.setLight(lightType);\n        this.helper = this.setHelper();\n    }\n\n    setLight(lightType: LightTypes) {\n        let light;\n        switch (lightType) {\n            case LightTypes.AMBIENT:\n                light = new AmbientLight(\"#ffffff\", 0.4);\n                break;\n            case LightTypes.DIRECTIONAL:\n                light = new DirectionalLight(\"#ffffff\", 0.5);\n                light.position.set(-5, 0, -5);\n                break;\n            case LightTypes.POINT:\n                light = new PointLight(\"#ffffff\", 0.6);\n                light.position.set(5, 0, 5);\n                break;\n            default:\n                Alert.error(\"Error: null light type selected\");\n                throw RangeError;\n        }\n        return light\n    }\n\n    setHelper() {\n        let helper;\n        if (this.light instanceof DirectionalLight) {\n            helper = new DirectionalLightHelper(this.light, 10);\n        }\n        if (this.light instanceof PointLight) {\n            helper = new PointLightHelper(this.light, 10);\n        }\n        return helper;\n    }\n\n    updatePosition(x: number, y: number, z: number) {\n        this.light.position.set(x, y, z);\n    }\n\n    updateColour(c: string, i: number) {\n        this.light.color.setHex(parseInt(c.substring(1), 16));\n        this.light.intensity = i * 0.01;\n    }\n}\n\nexport default LightNew;","export var Parameters = {\n    Ellipsoid: {\n        names: ['X', 'Y', 'Z'], vals: [1.0, 1.0, 0.2]\n    }, Spherocylinder: {\n        names: ['Radius', 'Length'], vals: [0.5, 0.7]\n    }, Spheroplatelet: {\n        names: ['RadSphere', 'RadCircle'], vals: [0.3, 0.2]\n    }, CutSphere: {\n        names: ['Radius', 'zCut'], vals: [0.8, 0.7]\n    }, Sphere: {\n        names: ['Radius'], vals: [0.6]\n    }, Cap: {\n        names: ['Radius', 'zCut'], vals: [0.8, 0.7]\n    }, Lens: {\n        names: ['Radius', 'Angle'], vals: [1, 0.7]\n    }, ThickLens: {\n        names: ['Radius', 'Thickness', 'Angle'], vals: [1, 0.1, 0.7]\n    }, RadiusOnlyLens: {\n        names: ['Radius'], vals: [0.5]\n    }, DoubleCutSphere: {\n        names: ['Radius', 'zCut'], vals: [0.8, 0.7]\n\n    }\n}\n\nexport default Parameters;","import * as THREE from 'three';\nimport {Color, Euler, LOD, MeshPhongMaterial, Quaternion, Vector3} from 'three';\nimport {eigs} from 'mathjs';\nimport * as SHAPE from './Shapes';\nimport {Shape} from './Shapes';\nimport Model from './Model';\nimport Parameters from './Parameters';\nimport {Alert} from 'rsuite';\nimport colourMap from './ColourMap.json';\n\nexport class Set {\n    name;\n    shapeType;\n    parameters;\n    shape;\n    orientationType;\n    wireframe;\n    userColour;\n    colourByDirector;\n    lod;\n    clippingPlanes;\n    clipIntersection;\n    unitBox;\n\n\n    positions = [];\n    Folded_position = []\n    orientations = [];\n    elements = [];\n    meshes = [];\n// materials =[];\n    Element = class Element {\n        geometries;\n        orientation;\n        position;\n        colourIndex;\n        euler;\n        quaternion;\n\n        constructor(p, q) {\n            this.position = p;\n            this.orientation = this.quaternionToUnitVector(q);\n            this.euler = new Euler();\n            this.euler.setFromQuaternion(q);\n            this.colourIndex = 0;\n            this.quaternion = q\n        }\n\n        quaternionToUnitVector(q) {\n            let a = (2 * (q.w * q.y + q.x * q.z));\n            let b = (2 * (-q.w * q.x + q.y * q.z));\n            let c = (1 - 2 * (q.x ** 2 + q.y ** 2));\n            return [a, b, c];\n        }\n\n        setColourIndex(i) {\n            this.colourIndex = i;\n        }\n\n        setGeometries(geoms) {\n            this.geometries = geoms;\n        }\n\n    }\n\n    constructor(data, cp, ci) {\n        this.name = data.name;\n        this.orientationType = data.orientationType;\n        this.positions = data.positions;\n        this.orientations = data.orientations;\n        this.unitBox = data.unitBox;\n        this.clippingPlanes = cp;\n        this.clipIntersection = ci;\n        this.setDefaults();\n\n        if (data.shapeType != null) {\n            this.shapeType = data.shapeType;\n        }\n        if (data.parameters != null) {\n            this.shapeType = data.parameters;\n        }\n        if (this.name === null) {\n            this.name = this.shapeType;\n        }\n        this.genSet();\n    }\n\n    static getParameters(val) {\n        let parameters;\n\n        switch (val) {\n            case 'Ellipsoid':\n                parameters = Parameters.Ellipsoid;\n                break;\n            case 'Spherocylinder':\n                parameters = Parameters.Spherocylinder;\n                break;\n            case 'Spheroplatelet':\n                parameters = Parameters.Spheroplatelet;\n                break;\n            case 'Cut Sphere':\n                parameters = Parameters.CutSphere;\n                break;\n            case 'Sphere':\n                parameters = Parameters.Sphere;\n                break;\n            case 'Cap':\n                parameters = Parameters.Cap;\n                break;\n            case 'Lens':\n                parameters = Parameters.Lens;\n                break;\n            case 'Cinacchi Lens':\n                parameters = Parameters.RadiusOnlyLens;\n                break;\n            case 'Thick Lens':\n                parameters = Parameters.ThickLens;\n                break;\n            case 'Double Cut Sphere':\n                parameters = Parameters.DoubleCutSphere;\n                break;\n            default:\n                Alert.error('Error: Unexpected shape identifier');\n        }\n\n        return parameters;\n    }\n\n    isFoldedTest() {\n        let x = this.unitBox[0] / 2;\n        let y = this.unitBox[1] / 2;\n        let z = this.unitBox[2] / 2;\n\n        for (let i = 0; i < this.positions.length; i++) {\n            let a = this.positions[i][0];\n            let b = this.positions[i][1];\n            let c = this.positions[i][2];\n            if (a >= x || a <= -x) {\n                return false\n            }\n            if (b >= y || b <= -y) {\n                return false\n            }\n            if (c >= z || c <= -z) {\n                return false\n            }\n\n        }\n        return true;\n    }\n\n    genSet() {\n        this.validateData();\n        this.genElements();\n        this.genMeshes();\n        // this.genListBoundingBox();\n    }\n\n    validateData() {\n        if (this.positions.length !== this.orientations.length) {\n            throw new Error('Error: Position data does not correspond to orientation data. \\n Total positions: ' + this.positions.length + '\\n Total rotations: ' + this.orientations.length);\n        }\n\n        for (let p in this.parameters) {\n            if (p < 0) {\n                throw new Error('Error: Invalid parameter ' + p.toString() + ' for ' + this.name + '\\n Must be positive.');\n            }\n        }\n\n        let defaultParameters = Set.getParameters(this.shapeType);\n        if (this.parameters.length !== defaultParameters.vals.length) {\n            throw new Error('Error: Wrong number of parameters specified for ' + this.name + '. \\n Required: ' + defaultParameters.names);\n        }\n    }\n\n    setDefaults() {\n        this.userColour = new Color(\"#FFFFFF\");\n        this.colourByDirector = true;\n        this.wireframe = true;\n        this.renderBackFace = false;\n        this.lod = Shape.default_lod;\n        this.shapeType = 'Ellipsoid';\n        this.parameters = Parameters.Ellipsoid.vals;\n    }\n\n    updateSlicers(i, vals) {\n        this.clippingPlanes[2 * i + 1].constant = vals[1];\n        this.clippingPlanes[2 * i].constant = -vals[0];\n    }\n\n    genUnitBox() {\n        // This is the user input unit box of whole\n        return this.unitBox;\n\n    }\n\n    genUnfoldPosition() {\n        // Place holder function to generate Psedo unfolded configuration\n        if (this.isFoldedTest() === false) {\n            Alert.info('Model is already unfolded');\n            return\n        }\n        let pos = [];\n        let x = this.unitBox[0];\n        let y = this.unitBox[1];\n        let z = this.unitBox[2];\n\n        for (let i = 0; i < this.positions.length; i++) {\n            let rnd1 = (Math.random() * (2) - 1)\n            let rnd2 = (Math.random() * (2) - 1)\n            let rnd3 = (Math.random() * (2) - 1)\n            pos.push([this.positions[i][0] + rnd1 * x, this.positions[i][1] + rnd2 * y, this.positions[i][2] + rnd3 * z])\n        }\n        this.positions = pos;\n\n    }\n\n    genFoldedPositionFromUnfold() {\n        if (this.isFoldedTest() === true) {\n            Alert.info('Model is already folded');\n            return\n        }\n        let pos = [];\n        let lx = this.unitBox[0];\n        let ly = this.unitBox[1];\n        let lz = this.unitBox[2];\n\n        for (let i = 0; i < this.positions.length; i++) {\n            let rx = this.positions[i][0];\n            let ry = this.positions[i][1];\n            let rz = this.positions[i][2];\n\n            rx = rx - lx * Math.round(rx / lx);\n            ry = ry - ly * Math.round(ry / ly);\n            rz = rz - lz * Math.round(rz / lz);\n\n            pos.push([rx, ry, rz])\n        }\n        this.Folded_position = pos;\n\n    }\n\n    setBackFace(bool) {\n        this.renderBackFace = bool;\n    }\n\n    genMeshes() {\n        let num = this.elements.length;\n\n        let c = '#FFFFFF'\n        let geometry_distances = [0, 0.05, 0.1, 0.2]\n        let geometries = geometry_distances.map((distance, distance_index) => this.new_gen_geometries(Math.max(0, this.lod - distance_index)))\n        for (let i = 0; i < num; i++) {\n            if (this.colourByDirector) {\n                let rgb = colourMap.values[this.elements[i].colourIndex];\n                c = new Color(Model.rgbToHex(...rgb));\n            } else {\n                c = this.userColour;\n            }\n            let mat = new MeshPhongMaterial({\n                side: this.renderBackFace ? THREE.DoubleSide : THREE.FrontSide,\n                clipShadows: true,\n                clippingPlanes: this.clippingPlanes,\n                wireframe: this.wireframe,\n                color: c,\n            });\n            let matrix2 = new THREE.Matrix4();\n            const position = new THREE.Vector3();\n            position.x = this.elements[i].position[0];\n            position.y = this.elements[i].position[1];\n            position.z = this.elements[i].position[2];\n            let ori = this.elements[i].quaternion\n            matrix2.compose(position, ori, new THREE.Vector3(0.5, 0.5, 0.5));\n            let meshes = geometries.map(geometry => new THREE.Mesh(geometry, mat))\n            let lod_mesh = new LOD()\n            for (let i = 0; i < meshes.length; ++i) {\n                lod_mesh.addLevel(meshes[i], geometry_distances[i])\n            }\n            lod_mesh.applyMatrix4(matrix2)\n            this.meshes.push(lod_mesh);\n        }\n    }\n\n    genElements() {\n        let pos = this.positions\n        if (this.Folded_position.length > 0) {\n            pos = this.Folded_position;\n        }\n        for (let i = 0; i < pos.length; i++) {\n            this.elements.push(new this.Element(pos[i], this.getRotations(this.orientationType, this.orientations[i])));\n        }\n        this.calculateDirector();\n        for (let elem of this.elements) {\n            elem.setColourIndex(this.calculateColourIndex(elem));\n        }\n    }\n\n    new_gen_geometries(lod) {\n        let shape\n        switch (this.shapeType) {\n            case 'Ellipsoid':\n                shape = new SHAPE.Ellipsoid(...this.parameters);\n                break;\n            case 'Spherocylinder':\n                shape = new SHAPE.Spherocylinder(...this.parameters);\n                break;\n            case 'Spheroplatelet':\n                shape = new SHAPE.Spheroplatelet(...this.parameters);\n                break;\n            case 'Cut Sphere':\n                shape = new SHAPE.CutSphere(...this.parameters);\n                break;\n            case 'Sphere':\n                shape = new SHAPE.Sphere(...this.parameters);\n                break;\n            case 'Cap':\n                shape = new SHAPE.Cap(...this.parameters);\n                break;\n            case 'Lens':\n                shape = new SHAPE.Lens(...this.parameters);\n                break;\n            case 'Thick Lens':\n                shape = new SHAPE.ThickLens(...this.parameters);\n                break;\n            case 'Cinacchi Lens':\n                shape = new SHAPE.RadiusOnlyLens(...this.parameters);\n                break;\n            case 'Double Cut Sphere':\n                shape = new SHAPE.DoubleCutSphere(...this.parameters);\n                break;\n            default:\n                throw new Error('Error: unexpected shape identifier. \\n Found: ' + this.shapeType);\n        }\n        shape.LOD = lod\n        shape.generate();\n        return shape.stripGeometry\n    }\n\n    translate(pos, geoms) {\n        for (let g of geoms) {\n            g.translate(2 * pos[0], 2 * pos[1], 2 * pos[2]);\n        }\n    }\n\n    getRotations(type, rot) {\n        let q = new Quaternion();\n        switch (type) {\n            case 'v':\n                let orientationVector = new Vector3(rot[0], rot[1], rot[2])\n                orientationVector.normalize();\n                q.setFromUnitVectors(new Vector3(0, 0, 1), orientationVector);\n                break;\n            case 'q':\n                q.set(rot[1], rot[2], rot[3], rot[0]);\n                break;\n            case 'a':\n                q.setFromAxisAngle(new Vector3(rot[0], rot[1], rot[2]), rot[3]);\n                break;\n            case 'e':\n                let e = new Euler();\n                e.fromArray(rot);\n                q.setFromEuler(e)\n                break;\n            default:\n                throw new Error('Error: Unexpected rotation type value. \\n Found: ' + type + '\\n Expected: v | q | a | e');\n        }\n\n        q.normalize();\n\n        return q;\n\n    }\n\n    calculateDirector() {\n        let n = this.elements.length;\n\n        if (this.elements.length === 0) {\n            Alert.error('Error: No elements in set, director calculation failed.');\n            return;\n        }\n\n        let orderTensor = [[0, 0, 0], [0, 0, 0], [0, 0, 0]];\n        //let eigenvectorsInColumns = new Matrix3();\n\n        let factor = 3 / (2 * n);\n        let constant = 0.5;\n\n        let orientation;\n\n        // loop over all molecules and calculate order tensor\n        for (let i = 0; i < n; ++i) {\n            orientation = this.elements[i].orientation;\n            orderTensor[0][0] += orientation[0] ** 2;\n            orderTensor[0][1] += orientation[0] * orientation[1];\n            orderTensor[0][2] += orientation[0] * orientation[2];\n            orderTensor[1][1] += orientation[1] ** 2;\n            orderTensor[1][2] += orientation[1] * orientation[2];\n            orderTensor[2][2] += orientation[2] ** 2;\n        }\n\n        // multiply each tensor value with \"factor\" and afterwards subtract \"subtract\" from diagonal elements\n        orderTensor[0][0] *= factor;\n        orderTensor[0][0] -= constant;\n        orderTensor[0][1] *= factor;\n        orderTensor[0][2] *= factor;\n        orderTensor[1][1] *= factor;\n        orderTensor[1][1] -= constant;\n        orderTensor[1][2] *= factor;\n        orderTensor[2][2] *= factor;\n        orderTensor[2][2] -= constant;\n\n        // mirror matrix to make it symmetric\n        orderTensor[1][0] = orderTensor[0][1];\n        orderTensor[2][0] = orderTensor[0][2];\n        orderTensor[2][1] = orderTensor[1][2];\n\n        let eigen = eigs(orderTensor);\n\n        //returns index of max eigenvalue\n        //this line of code is a bit dodgy\n        let index = eigen.values.reduce((iMax, x, i, arr) => x > arr[iMax] ? i : iMax, 0);\n\n        this.director = eigen.vectors[index];\n\n        let norm = Math.sqrt(this.director[0] ** 2 + this.director[1] ** 2 + this.director[2] ** 2);\n\n        if (norm === 0 || norm === isNaN || norm === undefined) {\n            this.director = [0, 0, 1];\n        } else {\n            this.director[0] /= norm;\n            this.director[1] /= norm;\n            this.director[2] /= norm;\n        }\n\n        // TEST!\n    }\n\n    calculateColourIndex(element) {\n        let n = colourMap.values.length - 1;\n\n        let scalarProduct = Math.abs(element.orientation[0] * this.director[0] + element.orientation[1] * this.director[1] + element.orientation[2] * this.director[2]);\n        if (this.orientationType === 'v') {\n            scalarProduct = Math.abs(element.orientation[1] * this.director[0] + element.orientation[0] * this.director[1] + element.orientation[2] * this.director[2]);\n        }\n        if (scalarProduct > 1) {\n            scalarProduct = 1;\n        }\n\n        return Math.round(Math.acos(scalarProduct) / Math.PI * 2 * (n));\n\n    }\n\n    setUserColour(hex) {\n        this.userColour = new Color(hex);\n    }\n}\n\nexport default Set;","import {Box3, Box3Helper, BufferGeometry, Color, GridHelper, Line, LineBasicMaterial, Vector3} from 'three';\nimport {Alert} from 'rsuite';\n\nexport class ReferenceTools {\n    subGrid;\n    axes = [];\n    // boundingShape;\n    // boundingShapeType;\n    setsGeometry;\n    size;\n    colour;\n    material;\n    R;\n    G;\n    B;\n    director_colour;\n\n    constructor(s, c) {\n        this.size = s;\n        this.colour = c;\n\n        this.material = new LineBasicMaterial({\n            color: this.colour, linewidth: 3\n        });\n\n        this.multicolour = true;\n        this.genMulticolourAxes(undefined);\n        this.genSubgrid();\n\n        this.R = new Color(\"rgb(255, 0, 0)\");\n        this.G = new Color(\"rgb(0, 255, 0)\");\n        this.B = new Color(\"rgb(0, 0, 255)\");\n        this.director_colour = new Color(\"rgb(255, 0, 255)\");\n\n        this.boundingShapeType = 'box';\n        this.setsGeometry = null;\n\n    }\n\n    genBoundingShape(type, sets) {\n        this.boundingShapeType = type;\n        let b = null;\n        this.boundingShape = null;\n\n        for (let set of sets) {\n            if (b != null) {\n                break\n            }\n            b = set.genUnitBox()\n\n        }\n\n        switch (type) {\n            case 'box':\n                let box = new Box3();\n                box.setFromCenterAndSize(new Vector3(0, 0, 0), new Vector3(b[0], b[1], b[2]));\n                this.boundingShape = new Box3Helper(box, this.colour);\n\n                break;\n            default:\n                Alert.error('Error: Unknown bounding shape identifier');\n\n\n        }\n\n\n        return this.boundingShape;\n\n    }\n\n\n    updateColour(colour, director) {\n        this.colour = colour;\n        this.material = new LineBasicMaterial({\n            color: this.colour, linewidth: 5\n        });\n        if (!this.multicolour) {\n            this.genAxes(director);\n        }\n        this.genSubgrid();\n    }\n\n    genSubgrid() {\n        this.subGrid = new GridHelper(this.size, this.size, this.colour, this.colour);\n    }\n\n    genAxes(director) {\n        console.log(\"director\", director)\n        this.axes = [];\n        let axesSize = this.size / 2;\n        let origin = new Vector3(0, 0, 0);\n        this.axes.push(new Line(new BufferGeometry().setFromPoints([origin, new Vector3(axesSize, 0, 0)]), this.material));\n        this.axes.push(new Line(new BufferGeometry().setFromPoints([origin, new Vector3(0, axesSize, 0)]), this.material));\n        let director_vector = new Vector3(director[0], director[1], -director[2]);\n        this.axes.push(new Line(new BufferGeometry().setFromPoints([origin, director_vector.clone().multiplyScalar(axesSize)]), this.material));\n        this.axes.push(new Line(new BufferGeometry().setFromPoints([origin, new Vector3(0, 0, axesSize)]), this.material));\n    }\n\n    genMulticolourAxes(director) {\n        this.axes = [];\n        let axesSize = this.size / 2;\n        let origin = new Vector3(0, 0, 0);\n        let mat1, mat2, mat3;\n        mat1 = new LineBasicMaterial({\n            color: this.R, linewidth: 5\n        });\n        this.axes.push(new Line(new BufferGeometry().setFromPoints([origin, new Vector3(axesSize, 0, 0)]), mat1));\n        mat2 = this.material = new LineBasicMaterial({\n            color: this.G, linewidth: 5\n        });\n        this.axes.push(new Line(new BufferGeometry().setFromPoints([origin, new Vector3(0, axesSize, 0)]), mat2));\n        mat3 = this.material = new LineBasicMaterial({\n            color: this.B, linewidth: 5\n        });\n        this.axes.push(new Line(new BufferGeometry().setFromPoints([origin, new Vector3(0, 0, axesSize)]), mat3));\n        if (typeof director !== typeof undefined) {\n            let director_vector = new Vector3(director[0], director[1], -director[2]);\n            let mat4 = this.material = new LineBasicMaterial({color: this.director_colour, linewidth: 5});\n            this.axes.push(new Line(new BufferGeometry().setFromPoints([origin, director_vector.clone().multiplyScalar(axesSize)]), mat4));\n        }\n    }\n\n    toggleMulticolour(director) {\n        this.multicolour = !this.multicolour;\n        if (this.multicolour) {\n            this.genMulticolourAxes(director);\n        } else {\n            this.updateColour(this.colour, director);\n            this.genAxes(director);\n        }\n    }\n\n\n}\n\nexport default ReferenceTools;","import {\n    BufferGeometry,\n    Color,\n    Euler,\n    InstancedMesh,\n    Line,\n    LineBasicMaterial,\n    Matrix4,\n    MeshPhongMaterial,\n    OrthographicCamera,\n    PerspectiveCamera,\n    Plane,\n    PlaneHelper,\n    Quaternion,\n    Scene,\n    Vector3,\n    WebGLRenderer\n} from 'three';\nimport {OrbitControls} from 'three/examples/jsm/controls/OrbitControls';\nimport Set from './Set'\nimport LightNew from './Light'\nimport ReferenceTools from './ReferenceTools'\nimport {Alert} from 'rsuite'\nimport * as SHAPE from './Shapes';\n\n\nexport class Model extends Scene {\n    sets = [];\n\n    scene;\n    camera;\n    lighting;\n    bgColour;\n    controls;\n    lookAt;\n    tools;\n    renderer;\n\n    height;\n    width;\n    axesEnabled = false;\n\n\n    sidebarExpanded = false;\n\n    cameraType = 'perspective';\n    cameraPosition;\n\n    selectedSet;\n    clippingPlanes;\n    clippingHelpers;\n    numOfObject;\n    axes: Line[] = [];\n    axes_enabled: boolean = false;\n    colour_axes: boolean = true;\n    lod: number = SHAPE.Shape.default_lod;\n\n    constructor(chronometer, notify) {\n        super();\n        this.scene = this;\n        this.chronometer = chronometer;\n        this.setDefault();\n        this.notify = notify;\n\n    }\n\n    onBeforeRender = () => {\n        this.set_axes();\n    };\n\n    /* GENERAL FUNCTIONS */\n\n    static rgbToHex(r, g, b) {\n        function componentToHex(c) {\n            let hex = c.toString(16);\n            return hex.length === 1 ? \"0\" + hex : hex;\n        }\n\n        return \"#\" + componentToHex(r) + componentToHex(g) + componentToHex(b);\n    }\n\n    setDefault() {\n\n        this.renderer = new WebGLRenderer({\n            antialias: false, powerPreference: \"high-performance\", preserveDrawingBuffer: true\n        });\n        this.renderer.setPixelRatio(window.devicePixelRatio);\n        this.rotating = false;\n        this.lightHelperWarningGiven = false;\n        this.selectedSet = 0;\n        this.Video_sample_list = [];\n        this.initClippers();\n        this.lookAt = new Vector3(0, 0, 0);\n        this.updateDimensions();\n        this.setCamera(this.cameraType, true);\n        this.lighting = [new LightNew(LightNew.light_types.AMBIENT), new LightNew(LightNew.light_types.DIRECTIONAL), new LightNew(LightNew.light_types.POINT)];\n\n        this.tools = new ReferenceTools(50, 0xffffff);\n        this.bgColour = \"#000000\";\n        this.renderer.setClearColor(this.bgColour);\n\n        for (let l of this.lighting) {\n            this.scene.add(l.light);\n        }\n        this.scene.add(this.camera);\n        this.lod = SHAPE.Shape.default_lod;\n    }\n\n    set_axes(enabled: boolean = this.axes_enabled, scale: number = 200, camera: PerspectiveCamera | OrthographicCamera = this.camera, sets: Set[] = this.sets, axes_origin: Vector3 = new Vector3(450, -250, 0), scene: Scene = this.scene, colour_axes: boolean = this.colour_axes): void {\n        console.assert(scale > 0)\n        console.log(camera.zoom)\n        //Remove existing lines from scene\n        if (typeof this.axes !== typeof undefined) {\n            for (let axis of this.axes) {\n                scene.remove(axis);\n            }\n        }\n        if (!enabled) {\n            return;\n        }\n        scale /= camera.zoom;\n        axes_origin.divideScalar(camera.zoom);\n        //Construct line parameters\n        let world_axes_origin: Vector3 = camera.localToWorld(axes_origin);\n        let axis_line_ends: Vector3[] = [new Vector3(1, 0, 0), new Vector3(0, 1, 0), new Vector3(0, 0, 1)];\n        let director_line_ends: Vector3[] = sets.map(set => set.director).map(director => new Vector3(director[0], director[1], -director[2]));\n        let line_ends: Vector3[] = axis_line_ends.concat(director_line_ends);\n        //Build line materials\n        let line_materials: LineBasicMaterial[] = line_ends.map(line_end => new LineBasicMaterial({color: this.colour_from_director(line_end, colour_axes)}));\n        //Build line geometries\n        let line_geometries: BufferGeometry[] = line_ends.map(line_end => new BufferGeometry().setFromPoints([world_axes_origin, world_axes_origin.clone().add(line_end.multiplyScalar(scale))]));\n        //Build line objects\n        let axes: Line[] = line_geometries.map((line_geometry, i) => new Line(line_geometry, line_materials[i]));\n        //Add lines to scene\n        for (let axis of axes) {\n            scene.add(axis);\n        }\n        //Store lines\n        this.axes = axes;\n    }\n\n    colour_from_director(vector: Vector3, enable_colour: boolean = true, palette_start: number = 4 * Math.PI / 3, palette_range: number = -2 / 3, sets: Set[] = this.sets): Color {\n        console.assert(0 <= palette_start && palette_start < 2 * Math.PI);\n        console.assert(-1 <= palette_range && palette_range <= 1);\n        console.assert(sets.length > 0);\n        let hue: number = 0;\n        let lightness: number = 1;\n        //Update hue if director present\n        if (enable_colour && sets.length > 0) {\n            //TODO handle multiple directors and director should be stored as vec3 in first place\n            let director: number[] = sets[0].director;\n            let director_vector: Vector3 = new Vector3(director[0], director[1], -director[2]);\n            //Set hue based on angle between director and vector\n            //TODO properly check rather than min\n            let angle: number = Math.acos(Math.min(director_vector.dot(vector.normalize()), 1));\n            console.assert(0 <= angle && angle <= Math.PI);\n            if (angle > Math.PI / 2) {\n                angle = Math.PI - angle;\n            }\n            console.assert(0 <= angle && angle <= Math.PI / 2);\n            hue = (palette_start + (angle * 4) * palette_range) % (2 * Math.PI) / (2 * Math.PI);\n            lightness = 0.5;\n        }\n        console.assert(0 <= hue && hue <= 1);\n        console.assert(0 <= lightness && lightness <= 1);\n        return new Color().setHSL(hue, 1, lightness);\n    }\n\n    update() {\n        console.log('update called');\n        this.renderer.render(this.scene, this.camera);\n        if (!this.rotating) {\n            this.chronometer.click();\n        }\n\n    }\n\n    // occlusionCulling(){\n\n    // const renderer = new WebGLRenderer();\n    // const gl = renderer.getContext();\n    // console.log(gl)\n    // const scene = new Scene();\n    // const mesh1 = new Mesh(new BoxGeometry( 1, 1, 1 ), new MeshBasicMaterial( {color: 0x00ff00}));\n    // const mesh2 = new Mesh(new BoxGeometry( 1, 1, 1 ), new MeshBasicMaterial( {color: 0x00ff00}));\n    // scene.add(mesh1, mesh2);\n    // var query = gl.createQuery();\n    // const camera = this.camera = new PerspectiveCamera(50, this.width / this.height, 0.1, 1000);\n\n    // camera.position.z = 5;\n    // for (let l of this.lighting) {\n    //     scene.add(l.light);}\n    // gl.beginQuery(gl.ANY_SAMPLES_PASSED,query);\n    // renderer.render(scene, camera);\n    // gl.endQuery(gl.ANY_SAMPLES_PASSED,query);\n    // var result = gl.getQueryParameter(query,gl.QUERY_RESULT);\n    // console.log(Number(result));\n    // console.log(result)\n\n    getRender_Object_number() {\n        let num = 0;\n        this.scene.traverse(function (child) {\n            //@ts-ignore\n            if (child.isMesh) {\n                num = num + 1;\n            }\n\n        });\n\n        this.numOfObject = (num - 6);\n        console.log(this.numOfObject)\n    }\n\n    getData() {\n        // To save config to download\n        let model = {};\n        let temp = {};\n        model.sets = [];\n        for (let set of this.sets) {\n            temp.name = set.name;\n            temp.orientationType = set.orientationType;\n            temp.positions = set.positions;\n            temp.orientations = set.orientations;\n            temp.unitBox = set.unitBox;\n            model.sets.push(temp);\n            temp = {};\n        }\n        return model;\n    }\n\n    toggleSidebar() {\n        this.sidebarExpanded = !this.sidebarExpanded;\n        this.updateDimensions();\n        this.updateCamera();\n        console.log(this.sidebarExpanded)\n    }\n\n    toggleAutorotate() {\n        this.controls.autoRotate = !this.controls.autoRotate;\n        this.rotating = !this.rotating;\n    }\n\n    getParameters(val) {\n        return Set.getParameters(val);\n    }\n\n    /* UPDATING SETS FUNCTIONS */\n\n    updateSets(id, params, f) {\n        for (const m of this.sets[id].meshes) {\n            this.scene.remove(m);\n            // m.geometry.dispose();\n            // m.material.dispose();\n            // m.dispose();\n        }\n        f(...params);\n        for (const m of this.sets[id].meshes) {\n            this.scene.add(m);\n        }\n        // let mesh = this.occlusionCulling();\n        // this.scene.add(mesh);\n    }\n\n    updateUserColour(id, colour) {\n        this.updateSets(id, [id, colour], (id, colour) => {\n            this.sets[id].meshes = [];\n            this.sets[id].setUserColour(Model.rgbToHex(colour.r, colour.g, colour.b));\n            this.sets[id].genMeshes();\n        });\n    }\n\n    updateShape(id, shape, parameters) {\n        this.updateSets(id, [id, shape, parameters], (id, shape, parameters) => {\n            this.sets[id].meshes = [];\n            this.sets[id].shapeType = shape;\n            this.sets[id].parameters = parameters.vals;\n            this.sets[id].genMeshes();\n        });\n    }\n\n    toggleWireframe(id, toggle) {\n        this.updateSets(id, [id, toggle], (id, toggle) => {\n            this.sets[id].meshes = [];\n            this.sets[id].wireframe = toggle;\n            this.sets[id].genMeshes();\n        });\n    }\n\n    toggleUserColour(id, toggle) {\n        this.updateSets(id, [id, toggle], (id, toggle) => {\n            this.sets[id].meshes = [];\n            this.sets[id].colourByDirector = toggle;\n            this.sets[id].genMeshes();\n        });\n    }\n\n    genSets(sets) {\n        for (let set of this.sets) {\n            for (const m of set.meshes) {\n                this.scene.remove(m);\n                // m.geometry.dispose();\n                // m.material.dispose();\n                // m.dispose();\n            }\n        }\n        this.sets = [];\n        for (let setData of sets) {\n            this.sets.push(new Set(setData, this.clippingPlanes, this.clippingIntersections));\n        }\n        for (let set of this.sets) {\n            for (const m of set.meshes) {\n                this.scene.add(m);\n            }\n        }\n        this.getRender_Object_number();\n\n    }\n\n    /* LOD FUNCTIONS */\n    updateLOD(val) {\n        this.lod = val;\n        for (let i = 0; i < this.sets.length; i++) {\n            this.updateSets(i, [i, val], (i, val) => {\n                this.sets[i].lod = val;\n                this.sets[i].meshes = [];\n                this.sets[i].genMeshes();\n            });\n        }\n    }\n\n\n    /* CAMERA AND PROJECTION FUNCTIONS */\n\n    updateDimensions() {\n\n        this.height = (window.innerHeight - 56);\n\n        if (this.sidebarExpanded) {\n            this.width = window.innerWidth - 356;\n            console.log('sidebar')\n        } else {\n            this.width = window.innerWidth - 56;\n        }\n        this.renderer.setSize(this.width, this.height);\n    }\n\n    setCamera(type) {\n        console.log('set camera called')\n        if (this.camera) {\n            this.camera = '';\n        }\n        this.cameraType = type;\n        if (type === 'perspective') {\n            this.camera = new PerspectiveCamera(50, this.width / this.height, 0.1, 1000);\n        } else {\n            this.camera = new OrthographicCamera(this.width / -2, this.width / 2, this.height / 2, this.height / -2, -100, 5000);\n        }\n\n        if (this.cameraPosition != null) {\n            this.camera.position.set(...this.cameraPosition);\n        }\n        this.controls = new OrbitControls(this.camera, this.renderer.domElement);\n        this.controls.target = this.lookAt;\n        // this.update();\n\n\n    }\n\n    updateCamera() {\n        if (this.cameraType === 'perspective') {\n            this.camera.aspect = this.width / this.height;\n        } else {\n            this.camera.left = this.width / -2;\n            this.camera.right = this.width / 2;\n            this.camera.top = this.height / 2;\n            this.camera.bottom = this.height / -2;\n        }\n        this.camera.updateProjectionMatrix();\n        this.update();\n    }\n\n    updateCameraZoom(val) {\n        this.camera.zoom = val;\n        this.camera.updateProjectionMatrix();\n    }\n\n    updateCameraPosition(p) {\n        this.cameraPosition = [p.x, p.y, p.z];\n        this.camera.position.set(p.x, p.y, p.z);\n        this.controls.update();\n    }\n\n    updateLookAt(l) {\n        this.lookAt = new Vector3(l.x, l.y, l.z);\n        this.controls.target = this.lookAt;\n        this.controls.update();\n\n    }\n\n    /* AMBIENT AND LIGHT FUNCTIONS */\n\n    updateBg(colour) {\n        this.bgColour = colour;\n        this.renderer.setClearColor(this.bgColour);\n    }\n\n    updateLight(type, colour) {\n        this.lighting[type].updateColour(Model.rgbToHex(colour.r, colour.g, colour.b), colour.i);\n        if (type !== 0) {\n            this.lighting[type].helper.update();\n        }\n    }\n\n    toggleLightHelper(type, toggle) {\n        if (toggle) {\n            if (this.bgColour === '#ffffff' && !this.lightHelperWarningGiven) {\n                Alert.warning('If the background colour and light colour are the same, the light helper may not be visible.');\n                this.lightHelperWarningGiven = true;\n            }\n            this.lighting[type].helper.update();\n            this.scene.add(this.lighting[type].helper);\n        } else {\n            this.scene.remove(this.lighting[type].helper);\n        }\n    }\n\n    updateLightPosition(type, pos) {\n        this.lighting[type].updatePosition(pos.x, pos.y, pos.z);\n        this.lighting[type].helper.update();\n    }\n\n    /* PERIODIC BOUNDING TOOL FUNCTIONS */\n\n    toggleFoldState(id, toggle) {\n        if (toggle === true) {\n            this.updateSets(id, [id], (id) => {\n                this.sets[id].elements = [];\n                this.sets[id].meshes = [];\n                this.sets[id].genFoldedPositionFromUnfold();\n                this.sets[id].genElements();\n                this.sets[id].genMeshes();\n            });\n        } else if (toggle === false) {\n            this.updateSets(id, [id], (id) => {\n                this.sets[id].elements = [];\n                this.sets[id].meshes = [];\n                this.sets[id].Folded_position = [];\n                this.sets[id].genElements();\n                this.sets[id].genMeshes();\n            });\n        }\n    }\n\n    // toggleUnfoldState(id,toggle){\n    //     if(toggle){\n    //         this.updateSets(id, [id], (id) => {\n    //             this.sets[id].elements =[];\n    //             this.sets[id].meshes = [];\n    //             this.sets[id].genUnfoldPosition();\n    //             this.sets[id].genElements();\n    //             this.sets[id].genMeshes();\n    //         });\n    //     }\n    //     else if(toggle == false){\n    //         this.updateSets(id, [id], (id) => {\n    //             this.sets[id].elements =[];\n    //             this.sets[id].meshes = [];\n    //             this.sets[id].genFoldedPositionFromUnfold();\n    //             this.sets[id].genElements();\n    //             this.sets[id].genMeshes();\n    //         });\n    //     }\n    //}\n\n\n    /* REFERENCE TOOLS FUNCTIONS */\n    toggleAxes() {\n        this.axesEnabled = !this.axesEnabled;\n\n        if (this.axesEnabled) {\n            for (let a of this.tools.axes) {\n                this.scene.add(a);\n            }\n        } else {\n            for (let a of this.tools.axes) {\n                this.scene.remove(a);\n            }\n        }\n\n\n    }\n\n    toggle_axes_enabled() {\n        this.axes_enabled = !this.axes_enabled;\n        this.update();\n    }\n\n    toggle_axes_colour() {\n        this.colour_axes = !this.colour_axes;\n        this.update();\n    }\n\n    toggleAxesMulticolour() {\n        let passAxes = false;\n        if (this.axesEnabled) {\n            this.toggleAxes();\n            passAxes = true;\n        }\n        this.tools.toggleMulticolour(this.sets[0].director);\n        if (passAxes) {\n            this.toggleAxes();\n        }\n    }\n\n    updateBoundingShape(type, enabled) {\n        this.boundingShapeEnabled = enabled;\n        this.scene.remove(this.tools.boundingShape);\n        if (enabled) {\n            this.scene.add(this.tools.genBoundingShape(type, this.sets));\n        }\n    }\n\n\n    /* SLICING FUNCTIONS */\n    enableClipping(toggle, id) {\n        if (toggle === true) {\n            this.renderer.localClippingEnabled = true;\n            for (let x = 0; x < this.sets.length; x++) {\n                this.updateSets(x, [x], (x) => {\n                    this.sets[x].elements = [];\n                    this.sets[x].meshes = [];\n                    this.sets[x].setBackFace(true);\n                    this.sets[x].genElements();\n                    this.sets[x].genMeshes();\n                });\n            }\n\n        } else {\n            this.renderer.localClippingEnabled = false;\n\n        }\n\n\n    }\n\n    // disableClipping(){\n    //     this.renderer.localClippingEnabled = false;\n    // }\n\n    initClippers() {\n        this.clippingIntersections = false;\n\n\n        this.clippingPlanes = [new Plane(new Vector3(1, 0, 0), 180), new Plane(new Vector3(-1, 0, 0), 180), new Plane(new Vector3(0, 1, 0), 180), new Plane(new Vector3(0, -1, 0), 180), new Plane(new Vector3(0, 0, 1), 180), new Plane(new Vector3(0, 0, -1), 180)];\n\n        this.clippingHelpers = [new PlaneHelper(this.clippingPlanes[0], 100, 0xff0000), new PlaneHelper(this.clippingPlanes[1], 100, 0xff0000), new PlaneHelper(this.clippingPlanes[2], 100, 0x00ff00), new PlaneHelper(this.clippingPlanes[3], 100, 0x00ff00), new PlaneHelper(this.clippingPlanes[4], 100, 0x0000ff), new PlaneHelper(this.clippingPlanes[5], 100, 0x0000ff)];\n\n        for (let helper of this.clippingHelpers) {\n            helper.visible = false;\n            this.scene.add(helper);\n        }\n\n\n    }\n\n\n    // }\n    toggleHelper(i, toggle) {\n        this.clippingHelpers[2 * i].visible = toggle;\n        this.clippingHelpers[2 * i + 1].visible = toggle;\n    }\n\n    updateSlicer(i, vals) {\n        for (let set of this.sets) {\n            set.updateSlicers(i, vals);\n        }\n    }\n\n    /* Video SUITE */\n    uploadConfig() {\n        return new Promise(async (resolve, reject) => {\n            let fileHandle = [];\n            let lst = [];\n            try {\n                fileHandle = await window.showOpenFilePicker({multiple: true});\n                for (let i = 0; i < fileHandle.length; i++) {\n                    const file = await fileHandle[i].getFile();\n                    lst.push(file);\n                }\n                this.Video_sample_list = lst;\n                resolve(lst);\n            } catch (error) {\n                reject(error);\n            }\n        });\n    }\n\n    notifyFinishUpload() {\n        this.notify('info', `Files loaded successfully`, (<div>\n            <p style={{width: 320}}>\n                Now Select Your Video Viewing configuration!\n                You can show unit box, apply slicing , periodic boundary conditions etc.\n                Please Do not change screen size while generating Video e.g dont click on size bar\n            </p>\n        </div>));\n    }\n\n\n    retrieveVideoSample() {\n        return this.Video_sample_list;\n    }\n\n    /* PERFORMANCE TEST SUITE */\n\n\n    initTesting(step) {\n        // set desirable testing view\n        this.setCamera('orthographic', false);\n        this.updateCameraZoom(8);\n        this.updateLightPosition(2, {x: 50, y: 0, z: 50});\n        this.deleteAllMeshes();\n        this.testMaterial = new MeshPhongMaterial({wireframe: false});\n        // this.testShape = new SHAPE.Preset('Sphere', ...Parameters.Sphere.vals);\n        this.testShape = new SHAPE.Spheroplatelet(0.3, 0.2);\n        console.log('this.genshape');\n        this.testShape.LOD = 2;\n        this.testShape.generate();\n        this.testTotal = 0;\n        this.testLimit = 140001;\n\n        let geoms = [];\n        geoms.push(this.testShape.stripGeometry.clone());\n        this.testGeo = geoms;\n\n        this.translate([Math.random() * 100 - 50, Math.random() * 100 - 50, Math.random() * 100 - 50], geoms);\n\n        this.notify('info', 'Initialising Performance Test', (<p style={{width: 320}}>\n            Test Size: {this.testLimit.toString()} <br/>\n            Step: {step.toString()} <br/>\n            Shape: Spheroplatelet(0.3,0.2) <br/>\n            Level of Detail: {(this.testShape.LOD + 1).toString()} <br/>\n            Material: MeshPhongMaterial\n            <br/> <br/>\n            <b>Please do not change any settings while the performance test is running!</b>\n        </p>));\n\n        console.log('Material: MeshLambertMaterial')\n        console.log('Shape: Spheroplatelet (Default Parameters)')\n        console.log('LOD: ' + (this.testShape.LOD + 1).toString())\n        console.log('Test Size: ' + this.testLimit.toString())\n        console.log('Test Step: ' + step.toString());\n    }\n\n    deleteAllMeshes() {\n        for (const set of this.sets) {\n            console.log(set)\n            for (const m of set.meshes) {\n                this.scene.remove(m);\n                // m.geometry.dispose();\n                // m.material.dispose();\n                // m.dispose();\n            }\n\n        }\n\n    }\n\n    addRandomParticles(n) {\n        this.deleteAllMeshes();\n        console.log('add called')\n        this.testTotal += n;\n\n        if (this.testTotal >= this.testLimit) {\n            return true;\n        }\n        // let m;\n        // for (let i = 0; i < n; i++) {\n        //     for (let g of this.testGeo) {\n        //          m = new Mesh(g, this.testMaterial);\n        //         this.scene.add(m);\n        //     }}\n\n        let InstancedMesh1 = new InstancedMesh(this.testGeo[0], this.testMaterial, n);\n        let InstancedMesh2 = new InstancedMesh(this.testGeo[1], this.testMaterial, n);\n        let InstancedMesh3 = new InstancedMesh(this.testGeo[2], this.testMaterial, n);\n        console.log(InstancedMesh1);\n        for (let i = 0; i < n; i++) {\n            console.log('called')\n            const matrix = new Matrix4();\n            const position = new Vector3();\n            const rotation = new Euler();\n            const quaternion = new Quaternion();\n            const scale = new Vector3();\n            const color = new Color();\n            position.x = Math.random() * 40 - 20;\n            position.y = Math.random() * 40 - 20;\n            position.z = Math.random() * 40 - 20;\n\n            rotation.x = Math.random() * 2 * Math.PI;\n            rotation.y = Math.random() * 2 * Math.PI;\n            rotation.z = Math.random() * 2 * Math.PI;\n\n            quaternion.setFromEuler(rotation);\n\n            scale.x = scale.y = scale.z = Math.random();\n\n            matrix.compose(position, quaternion, scale);\n            InstancedMesh1.setMatrixAt(i, matrix);\n            InstancedMesh2.setMatrixAt(i, matrix);\n            InstancedMesh3.setMatrixAt(i, matrix);\n            InstancedMesh1.setColorAt(i, color.setHex(0xffffff * Math.random()));\n            InstancedMesh2.setColorAt(i, color.setHex(0xffffff * Math.random()));\n            InstancedMesh3.setColorAt(i, color.setHex(0xffffff * Math.random()));\n        }\n        this.scene.add(InstancedMesh1, InstancedMesh2, InstancedMesh3);\n        this.update();\n        return false;\n    }\n\n    translate(pos, geoms) {\n        for (let g of geoms) {\n            g.translate(pos[0], pos[1], pos[2]);\n        }\n    }\n\n}\n\n\nexport default Model;\n","import {ButtonToolbar, Col, Dropdown, InputGroup, InputNumber, RangeSlider, Row, Slider} from 'rsuite';\nimport React, {useState} from \"react\";\n\n\nexport const ParameterSet = (props) => {\n    let set = [];\n\n    for (let i = 0; i < props.titles.length; i++) {\n        set.push(<ParameterInput title={props.titles[i]} values={props.values[i]} numerical f={props.f} index={i}\n                                 step={props.step} positive={props.positive} styling={props.styling}/>);\n    }\n\n    return set;\n}\n\nexport class ParameterInput extends React.Component {\n\n\n    constructor(props) {\n        super();\n        this.styling = props.styling;\n        this.active = props.active;\n        this.f = props.f;\n        this.step = props.step;\n        this.title = props.title;\n        this.values = props.values;\n        this.numerical = props.numerical;\n        this.index = props.index;\n        this.selectingSet = props.selectingSet;\n        this.changeValue = this.changeValue.bind(this);\n\n        if (props.positive) {\n            this.min = 0;\n        }\n    }\n\n    changeValue(value) {\n        this.active = value;\n        this.f(value, this.index);\n    }\n\n    render() {\n        let InputBox;\n        if (this.numerical) {\n            let defaultVal = this.values;\n            InputBox = (<div style={this.styling[0]}>\n                <InputNumber defaultValue={defaultVal} step={this.step} onChange={this.changeValue} min={this.min}/>\n            </div>);\n        } else {\n            let vals = this.values;\n            let active = this.active;\n            let listItems = [];\n            let act;\n\n            for (let val of vals) {\n                (active.localeCompare(val)) ? act = false : act = true;\n                listItems.push(<Dropdown.Item key={val} eventKey={val} active={act}\n                                              onSelect={this.changeValue}>{val}</Dropdown.Item>);\n            }\n\n            listItems.push(<Dropdown.Item key={'panel'} eventKey={'panel'} panel style={{width: 150}}></Dropdown.Item>);\n\n            InputBox = (<ButtonToolbar style={{width: 10, marginLeft: 0}}>\n                <Dropdown style={{width: 100}} title={this.active}>\n                    {listItems}\n                </Dropdown>\n            </ButtonToolbar>);\n\n        }\n\n        return (<div>\n            <Row style={{marginTop: 15}}>\n                <Col md={10}><p style={this.styling[1]}>{this.title}</p></Col>\n                <Col md={10}/>\n                <Col md={14}>{InputBox}</Col>\n            </Row>\n        </div>);\n    }\n}\n\nexport const SliceSlider = (props) => {\n    const [value, setValue] = React.useState(props.vals);\n    let f = props.f;\n    let i = props.index;\n\n    return (<div>\n        <br/>\n        <Row>\n            <Col md={5}>\n                <p style={{marginTop: 10, marginLeft: 30}}>{props.title}</p>\n            </Col>\n            <Col md={1}/>\n            <Col md={16}>\n                <InputGroup>\n                    <InputNumber\n                        min={-100.0}\n                        max={100.0}\n                        value={value[0]}\n                        step={0.1}\n                        onChange={nextValue => {\n                            const end = value[1];\n                            if (!nextValue || isNaN(nextValue)) {\n                                nextValue = 0;\n                            }\n                            if (parseFloat(nextValue) > end) {\n                                return;\n                            }\n                            setValue([parseFloat(nextValue), end]);\n                            f(i, [parseFloat(nextValue), end]);\n                        }}\n                    />\n                    <InputGroup.Addon>to</InputGroup.Addon>\n                    <InputNumber\n                        min={-100.0}\n                        max={100.0}\n                        value={value[1]}\n                        step={0.1}\n                        onChange={(nextValue) => {\n                            if (!nextValue || isNaN(nextValue)) {\n                                nextValue = 0;\n                            }\n                            const start = value[0];\n                            if (start > parseFloat(nextValue)) {\n                                return;\n                            }\n                            setValue([start, parseFloat(nextValue)]);\n                            f(i, [start, parseFloat(nextValue)]);\n                        }}\n                    />\n                </InputGroup>\n            </Col>\n        </Row>\n        <Row>\n            <Col md={21}>\n                <RangeSlider\n                    min={-100.0}\n                    max={100.0}\n                    progress\n                    style={{marginLeft: 35, marginTop: 30}}\n                    value={value}\n                    onChange={value => {\n                        setValue(value);\n                        f(i, value);\n                    }}\n                />\n            </Col>\n\n        </Row>\n    </div>);\n}\n\nexport const CustomSlider = (props) => {\n    let f = props.f;\n    let [value, setValue] = useState(props.val);\n    let type;\n    let disabled = props.disabled;\n    const [min, max] = props.boundaries;\n\n    if (props.type == null) {\n        type = null;\n    } else {\n        type = props.type;\n    }\n\n    return (\n\n        <Row>\n            <Col md={10}>\n                <Slider\n                    style={{marginLeft: 25, marginTop: 16, width: 170}}\n                    value={parseInt(value)}\n                    min={min}\n                    max={max}\n                    disabled={disabled}\n                    onChange={value => {\n                        setValue(value);\n                        f(value, type);\n                    }}\n                />\n            </Col>\n            <Col md={4}>\n                <InputNumber\n                    style={{marginLeft: 80, marginTop: 3, marginBottom: 3, width: 65, height: 35}}\n                    min={min}\n                    max={max}\n                    value={value}\n                    disabled={disabled}\n                    onChange={value => {\n                        if (!value || isNaN(value)) {\n                            value = 0;\n                        }\n                        setValue(value);\n                        f(value, props.type)\n                    }}\n                />\n            </Col>\n        </Row>);\n}","import {\n    Alert,\n    Button,\n    ButtonToolbar,\n    ControlLabel,\n    Drawer,\n    Dropdown,\n    Form,\n    FormGroup,\n    Header,\n    Icon,\n    Nav,\n    Navbar,\n    Slider,\n    Tooltip,\n    Whisper\n} from 'rsuite';\nimport {ParameterSet} from './Tools';\nimport React from \"react\";\nimport {Shape} from \"../Model/Shapes\";\n\n\nclass ExportDropdown extends React.Component {\n\n    constructor(props) {\n        super();\n        this.dimensions = [1000, 1000];\n        this.resolution = [10];\n        this.f = props.f;\n        this.setResolution = this.setResolution.bind(this);\n        this.setDimensions = this.setDimensions.bind(this);\n        this.export = this.export.bind(this);\n    }\n\n    setDimensions(val, index) {\n        this.dimensions[index] = parseInt(val);\n    }\n\n    setResolution(val) {\n        this.resolution[0] = parseInt(val);\n    }\n\n    export() {\n        this.f(...this.dimensions.concat(this.resolution));\n    }\n\n    render() {\n        return (<Dropdown title=\"Export\" trigger='click' placement=\"bottomEnd\" icon={<Icon icon=\"export\"/>}>\n\n            <ParameterSet f={this.setDimensions} titles={['Height', 'Width']} values={this.dimensions} step={5} positive\n                          styling={[{marginRight: 25}, {marginTop: 18, marginLeft: 35}]}/>\n            <ParameterSet f={this.setResolution} titles={['Resolution']} values={this.resolution} step={1} positive\n                          styling={[{marginRight: 25}, {marginTop: 18, marginLeft: 35}]}/>\n\n            <Button style={{width: 180, marginLeft: 25, marginRight: 25, marginTop: 15, marginBottom: 15}}\n                    appearance='primary' onClick={this.export}> Export </Button>\n        </Dropdown>);\n    }\n\n}\n\nclass LibraryDropdown extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.model = props.model;\n        this.state = {active: 2};\n        this.f = props.f;\n        this.toggler = props.toggler;\n    }\n\n    render() {\n        return (<Dropdown\n            title=\"Library\"\n            trigger='click'\n            placement=\"bottomEnd\"\n            icon={<Icon icon=\"database\"/>}\n            appearance='subtle'\n            onSelect={(eventKey) => {\n                this.f(eventKey);\n            }}>\n\n            <Dropdown.Menu title=\"Samples\">\n                <Dropdown.Item eventKey={14}>Single Molecule</Dropdown.Item>\n                <Dropdown.Item eventKey={15}>QMGA Geometries</Dropdown.Item>\n                <Dropdown.Item eventKey={1}>Unit Vector Orientations</Dropdown.Item>\n                <Dropdown.Item eventKey={2}>Quaternion Orientations</Dropdown.Item>\n            </Dropdown.Menu>\n            <Dropdown.Menu title=\"Unfolded Samples\">\n                <Dropdown.Item eventKey={17}>Unfolded SC4 Nematic</Dropdown.Item>\n                <Dropdown.Item eventKey={18}>Unfolded E3 Chiral Nematic</Dropdown.Item>\n            </Dropdown.Menu>\n            <Dropdown.Menu title=\"Spherocylinders\">\n                <Dropdown.Item eventKey={3}>SC4 Isotropic</Dropdown.Item>\n                <Dropdown.Item eventKey={4}>SC4 Nematic</Dropdown.Item>\n                <Dropdown.Item eventKey={5}>SC4 Smectic</Dropdown.Item>\n            </Dropdown.Menu>\n            <Dropdown.Menu title=\"Prolate and Oblate Ellipsoids\">\n                <Dropdown.Item eventKey={12}>E3 Chiral Nematic</Dropdown.Item>\n                <Dropdown.Item eventKey={6}>E5 Isotropic</Dropdown.Item>\n                <Dropdown.Item eventKey={7}>E5 Nematic</Dropdown.Item>\n                <Dropdown.Item eventKey={8}>O5 Isotropic</Dropdown.Item>\n                <Dropdown.Item eventKey={9}>O5 Nematic</Dropdown.Item>\n            </Dropdown.Menu>\n            <Dropdown.Menu title=\"Dense Packings\">\n                <Dropdown.Item eventKey={10}>Biaxial Crystal (Small)</Dropdown.Item>\n                <Dropdown.Item eventKey={11}>Biaxial Crystal (Large)</Dropdown.Item>\n                <Dropdown.Item eventKey={13}>HBC (in Cylinder)</Dropdown.Item>\n            </Dropdown.Menu>\n            <Dropdown.Item panel style={{width: 120}}></Dropdown.Item>\n        </Dropdown>);\n\n    }\n}\n\nclass PerformanceDropdown extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.model = props.model;\n        this.state = {val: props.model.lod + 1};\n        this.updateVal = this.updateVal.bind(this);\n    }\n\n    updateVal(val) {\n        this.setState({\n            val: val\n        });\n    }\n\n    render() {\n        const lod = this.state.val;\n        return (<Dropdown title=\"Level of Detail\" trigger='click' placement=\"bottomEnd\" icon={<Icon icon=\"sliders\"/>}>\n            <Form style={{marginLeft: 20, marginTop: 20}} layout=\"inline\">\n                <FormGroup>\n                    <ControlLabel>Adjust LOD</ControlLabel>\n                    <Whisper placement=\"bottom\" trigger=\"hover\" speaker={<Tooltip>\n                        Decreasing LOD will increase rendering speed.\n                    </Tooltip>}>\n                        <Icon icon=\"question-circle\" size=\"lg\"/>\n                    </Whisper>\n                </FormGroup>\n            </Form>\n\n            <Slider\n                min={1}\n                step={1}\n                max={Shape.complexity_count}\n                value={lod}\n                graduated\n                progress\n                style={{width: 200, marginLeft: 30, marginRight: 30, marginBottom: 20}}\n                onChange={(value) => {\n                    this.model.updateLOD(value - 1);\n                    this.updateVal(value);\n                    this.model.update();\n                }}\n\n            />\n            <br/>\n        </Dropdown>);\n    }\n\n}\n\n\nclass GeneralMenu extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.model = props.model;\n        this.functions = props.functions;\n        this.toggler = props.toggler;\n        this.state = {fps: 0, showDrawer: false, rotating: false, numOfRender: this.model.numOfObject};\n        this.updateFPS = this.updateFPS.bind(this);\n        this.toggleDrawer = this.toggleDrawer.bind(this);\n        this.toggleAutorotate = this.toggleAutorotate.bind(this);\n        this.runPerformanceTest = this.runPerformanceTest.bind(this);\n\n\n        this.chronometer = props.chronometer;\n        this.chronometer.f = this.updateFPS;\n\n\n        this.toggler.autorotate = () => {\n            this.toggleAutorotate();\n        }\n\n\n    }\n\n    toggleAutorotate() {\n        this.setState({\n            rotating: !this.state.rotating\n        });\n        this.model.toggleAutorotate();\n        if (this.model.rotating) {\n            this.toggler.closeSidemenu();\n        }\n        this.continuousRender();\n    }\n\n    runPerformanceTest() {\n        Alert.info(\"To modify testing parameters, see 'initTesting()' in Model class.\");\n\n        this.model.initTesting(this.chronometer.step);\n\n        if (!this.state.rotating) {\n            this.toggleAutorotate();\n        }\n\n        this.chronometer.testing = true;\n    }\n\n    continuousRender = () => {\n        this.model.update();\n        this.chronometer.click();\n        this.model.controls.update();\n        if (this.model.rotating) {\n            requestAnimationFrame(this.continuousRender);\n        }\n    }\n\n\n    toggleDrawer() {\n        this.setState({\n            showDrawer: !this.state.showDrawer\n        });\n    }\n\n    updateFPS(fps) {\n        this.setState({\n            fps: fps.toFixed(2), numOfRender: this.model.numOfObject\n        });\n    }\n\n    render() {\n        const num = this.state.numOfRender;\n        const fps = this.state.fps;\n        const showDrawer = this.state.showDrawer;\n        const rotating = this.state.rotating;\n        return (<div>\n            <Header style={{height: 56}}>\n                <Navbar>\n                    <Navbar.Body>\n                        <Nav pullRight>\n                            <ButtonToolbar>\n\n                                <Nav.Item active>fps: {fps}</Nav.Item>\n                                <Nav.Item active>Draw calls made: {num}</Nav.Item>\n                                <Nav.Item onClick={this.runPerformanceTest} appearance=\"active\"\n                                          icon={<Icon icon=\"dashboard\"/>}>Run Performance Test</Nav.Item>\n\n                                <Nav.Item active={rotating} onClick={this.toggleAutorotate} appearance=\"subtle\"\n                                          icon={<Icon icon=\"refresh\" spin={rotating}/>}>Autorotate</Nav.Item>\n\n\n                                <PerformanceDropdown model={this.model}/>\n                                <LibraryDropdown f={this.functions[3]}/>\n                                <Nav.Item onClick={this.toggleDrawer} appearance=\"subtle\"\n                                          icon={<Icon icon=\"info\"/>}>About</Nav.Item>\n                                <ExportDropdown f={this.functions[2]}/>\n                                <Nav.Item appearance=\"subtle\" icon={<Icon icon=\"file-download\"/>}\n                                          onSelect={this.functions[0]}>Save</Nav.Item>\n                                <input type=\"file\"\n                                       id=\"upload-btn\"\n                                       style={{display: 'none'}}\n                                       className='input-file'\n                                       accept='.json,.webmga'\n                                       onChange={e => this.functions[1](e.target.files[0])}/>\n                                <label htmlFor=\"upload-btn\">\n                                    <Nav.Item icon={<Icon icon=\"file-upload\"/>}>Upload</Nav.Item>\n                                </label>\n\n                            </ButtonToolbar>\n\n                        </Nav>\n                        <Nav>\n                            <h6 style={{padding: 20}}> WebMGA</h6>\n                        </Nav>\n                    </Navbar.Body>\n                </Navbar>\n            </Header>\n            <Drawer\n                size={'sm'}\n                placement={'right'}\n                show={showDrawer}\n                onHide={this.toggleDrawer}\n                backdrop={false}\n            >\n                <Drawer.Header>\n                    <Drawer.Title>About</Drawer.Title>\n                    <br/>\n                    <ButtonToolbar>\n                        <Button color=\"cyan\" href=\"http://students.cs.ucl.ac.uk/2019/group3/WebMGA/notes.pdf\"\n                                target=\"_blank\" rel=\"noopener noreferrer\">\n                            <Icon icon=\"mortar-board\"/> Liquid Crystals\n                        </Button>\n                        <Button key=\"man\" color=\"cyan\"\n                                href=\"http://students.cs.ucl.ac.uk/2019/group3/WebMGA/manual.txt\" target=\"_blank\"\n                                rel=\"noopener noreferrer\">\n                            <Icon icon=\"info-circle\"/> User Manual\n                        </Button>\n                        <Button color=\"cyan\" href=\"dissertations/2021.pdf\"\n                                target=\"_blank\" rel=\"noopener noreferrer\">\n                            <Icon icon=\"book\"/> Dissertation 2021\n                        </Button>\n                        <Button color=\"cyan\" href=\"dissertations/2023.pdf\"\n                                target=\"_blank\" rel=\"noopener noreferrer\">\n                            <Icon icon=\"book\"/> Dissertation 2023\n                        </Button>\n                        <Button color=\"cyan\" href=\"https://github.com/joe-down/WebMGA-3\" target=\"_blank\"\n                                rel=\"noopener noreferrer\">\n                            <Icon icon=\"github\"/> Github\n                        </Button>\n                    </ButtonToolbar>\n                    <br/>\n                    <p><i>See 'Liquid Crystals' for a scientific explanation of the liquid crystal configurations\n                        included in the library.</i></p>\n\n                    <p><i>For information on how to upload a custom configuration or how to cite WebMGA in a\n                        scientific publication, see 'User Manual'.</i></p>\n\n                </Drawer.Header>\n\n                <div style={{margin: 25}}>\n                    <h2>WebMGA </h2>\n                    <br/>\n                    WebMGA was developed by Eduardo Battistini in 2020-21 for his final project within the BSc\n                    Computer Science at University College London, supervised by Guido Germano, Michael P. Allen,\n                    and Tobias Ritschel.\n                    <br/><br/>\n                    The WebGL Molecular Graphics Application, or WebMGA, is a web-based visualisation tool for\n                    coarse-grained molecular models that utilises prolated and elongated convex bodies as the\n                    elementary units of simulation.\n                    <br/><br/>\n                    Given the prevalence of said geometries in the modelling of liquid crystal systems and the lack\n                    of available visualisation platforms suitable for this niche, WebMGA provides a unique,\n                    out-of-the-box solution for researchers and educators to generate, stylise, and interact with\n                    three-dimensional renders of molecular simulations.\n                    <br/><br/>\n                    WebMGA is written in Javascript, and implements the graphics library <a\n                    href=\"https://threejs.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Threejs</a> for rendering\n                    images and the <a href=\"https://rsuitejs.com/\" target=\"_blank\"\n                                      rel=\"noopener noreferrer\">rSuite</a> library to provide a sleek user interface\n                    that is intuitively compartmentalised and easy to learn.\n                    <br/><br/>\n                    WebMGA is an evolution of <a href=\"http://qmga.sourceforge.net/\" target=\"_blank\"\n                                                 rel=\"noopener noreferrer\">QMGA</a>, an OpenGL and Qt3 based\n                    application written in C++ that filled this gap in molecular graphics in 2008.\n\n                </div>\n            </Drawer>\n        </div>);\n    }\n}\n\nexport default GeneralMenu;","\nimport { Nav, Divider, Checkbox, FormGroup, RadioGroup, Radio, Grid, Row, Col, Alert, Whisper, Tooltip, Icon,Input } from 'rsuite';\nimport React from \"react\";\nimport { SliceSlider, ParameterInput, ParameterSet, CustomSlider } from './Tools'\nimport {View} from './View'\n\nimport ccapture from \"ccapture.js-npmfixed\";\nimport { Scrollbars } from 'rc-scrollbars';\n\nconst TITLE_LEFT_MARGIN = 30;\nconst dividerStyle = {\n    color: '#A4A9A3'\n}\n\nconst submenuParameterSetStyling = [\n    { width: 130, marginLeft: 10 },\n    { marginTop: 10, marginLeft: 30 }\n];\n\nexport class ModelsOptions extends React.Component {\n\n    constructor(props) {\n        super();\n        this.state = View.state.model;\n        this.model = props.model;\n        this.model.deleteAllMeshes();\n        this.selectShape = this.selectShape.bind(this);\n        this.selectSet = this.selectSet.bind(this);\n        this.updateParameter = this.updateParameter.bind(this);\n        this.toggleWireframe = this.toggleWireframe.bind(this);\n        this.toggleColour = this.toggleColour.bind(this);\n        this.updateUserColour = this.updateUserColour.bind(this);\n    }\n\n\n    updateUserColour(val, type) {\n        let colour = this.state.configurations[this.state.active].colour;\n\n        switch (type) {\n            case 'r':\n                colour.r = parseInt(val);\n                break;\n            case 'g':\n                colour.g =  parseInt(val);\n                break;\n            case 'b':\n                colour.b =  parseInt(val);\n                break;\n            default:\n                Alert.error('Error: Unexpected RGB Identifier');\n        }\n        this.model.updateUserColour(this.state.active, colour);\n        this.model.update();\n        View.state.model.configurations[this.state.active].colour = colour;\n    }\n\n    toggleColour() {\n        let toggle = !this.state.configurations[this.state.active].colourFromDirector;\n        this.setState({\n            colourFromDirector: toggle\n        });\n        View.state.model.configurations[this.state.active].colourFromDirector = toggle;\n        this.model.toggleUserColour(this.state.active, toggle);\n        this.model.update();\n    }\n\n    toggleWireframe() {\n        let toggle = !this.state.configurations[this.state.active].displayAsWireframe;\n        this.setState({\n            displayAsWireframe: toggle\n        });\n        View.state.model.configurations[this.state.active].displayAsWireframe = toggle;\n        this.model.toggleWireframe(this.state.active, toggle);\n        this.model.update();\n    }\n\n    updateParameter(val, i) {\n        if (isNaN(val) ||!val) {\n            val =0\n        }\n        const parameter = parseFloat(val);\n        let globalState = View.state.model.configurations[this.state.active];\n        globalState.parameters.vals[i] = parameter;\n\n        let configs = this.state.configurations;\n        configs[this.state.active].parameters.vals[i] = parameter;\n\n        this.setState({\n            configurations: configs\n        });\n\n        this.model.updateShape(this.state.active, globalState.shape, globalState.parameters);\n        this.model.update();\n        this.reset();\n    }\n\n    reset() {\n        let i;\n        if (this.state.reset > 50) {\n            i = 0;\n        } else {\n            i = this.state.reset;\n        }\n        this.setState(\n            {\n                reset: ++i\n            }\n        );\n    }\n\n    selectSet(val) {\n        for (let i = 0; i < this.state.sets.length; i++) {\n            if (this.state.sets[i].localeCompare(val) === 0) {\n                this.setState({\n                    active: i\n                })\n                View.state.model.active = i;\n                break;\n            }\n        }\n        this.reset();\n    }\n\n    selectShape(val) {\n        let parameters = this.model.getParameters(val);\n        this.setState(\n            {\n                shape: val,\n                parameters: parameters\n            }\n        );\n        this.reset();\n        View.state.model.configurations[this.state.active].shape = val;\n        View.state.model.configurations[this.state.active].parameters = parameters;\n        this.model.updateShape(this.state.active, val, parameters);\n        this.model.update();\n    }\n\n    render() {\n        const configState = this.state.configurations[this.state.active];\n        const reset = this.state.reset;\n        const title = configState.title;\n        const shapes = [\"Sphere\", \"Ellipsoid\", \"Spherocylinder\", \"Spheroplatelet\", \"Cut Sphere\", \"Double Cut Sphere\", \"Cap\", \"Lens\", \"Thick Lens\", \"Cinacchi Lens\"];\n        const sets = this.state.sets;\n\n        return (\n            <Scrollbars  style={{height:800}}>\n            <div key={reset} >\n                <Divider><strong style={dividerStyle}> Configuration</strong></Divider>\n                <ParameterInput key ={5}f={this.selectSet} selectingSet title=\"Set\" values={sets} active={title} styling={submenuParameterSetStyling} />\n                <ParameterInput key ={6}f={this.selectShape} title=\"Shape\" values={shapes} active={configState.shape} styling={submenuParameterSetStyling} />\n                <ParameterSet f={this.updateParameter} titles={configState.parameters.names} values={configState.parameters.vals} step={0.1} positive styling={submenuParameterSetStyling} />\n                <br />\n                <Divider><strong style={dividerStyle}>  Material </strong></Divider>\n\n                <Row className=\"show-grid\">\n                    <Col xs={1} />\n                    <Col xs={20}>\n                        <Checkbox checked={configState.displayAsWireframe} onClick={this.toggleWireframe}> Display as Wireframe </Checkbox>\n                        <Checkbox checked={configState.colourFromDirector} onClick={this.toggleColour}> Colour from Director </Checkbox>\n                        <br />\n                    </Col>\n                </Row>\n\n                <p style={{ marginLeft: TITLE_LEFT_MARGIN }}> RGB </p>\n                <CustomSlider f={this.updateUserColour} disabled={configState.colourFromDirector} boundaries={[0, 255]} val={configState.colour.r} type={'r'} />\n                <CustomSlider f={this.updateUserColour} disabled={configState.colourFromDirector} boundaries={[0, 255]} val={configState.colour.g} type={'g'} />\n                <CustomSlider f={this.updateUserColour} disabled={configState.colourFromDirector} boundaries={[0, 255]} val={configState.colour.b} type={'b'} />\n            </div>\n            </Scrollbars>\n        );\n    }\n}\n\nexport class VideoOptions extends React.Component{\n    constructor(props){\n        super();\n        this.model = props.model;\n        this.state =View.state.reference;\n        this.functions = props.functions;\n        this.toggler = props.toggler;\n        this.setfps = this.setfps.bind(this);\n        this.UploadFiles = this.UploadFiles.bind(this);\n        this.RealTimeVideo = this.RealTimeVideo.bind(this);\n        this.VideoToggle = this.VideoToggle.bind(this);\n        this.setVideoState = this.setVideoState.bind(this);\n        this.state.filename = 'WebMGA-Video.webm';\n        this.setFileName = this.setFileName.bind(this);\n\n    }\n    setFileName (val){\n        this.setState({\n            filename:val\n        })\n    }\n    setfps(val){\n     this.setState({\n        fps:val\n     })\n     View.state.reference.fps = val;\n    }\n    UploadFiles(){\n        let toggle = ! this.state.uploaded;\n        this.setState({\n            uploaded: toggle\n        })\n        if (toggle === true){\n            async function runAfterUpload(model, functions) {\n                const lst = await model.uploadConfig();\n                functions[1](lst[0],true,0);\n            }\n            runAfterUpload(this.model,this.functions).then(()=>{\n                this.model.notifyFinishUpload();\n            })\n        }\n        else{\n            this.model.Video_sample_list =[];\n        }\n\n        View.state.reference.uploaded= !View.state.reference.uploaded;\n    }\n    setVideoState(){\n        var data = this.functions[5]();\n        this.state.vidstate  = data;\n        let toggle = ! this.state.loadVideoState\n        this.setState({\n            loadVideoState :toggle\n        })\n        View.state.reference.loadVideoState =!View.state.reference.loadVideoState;\n    }\n    VideoToggle(){\n        console.log(this.state.video);\n        let toggle = !this.state.video;\n        this.setState({\n            video:toggle\n        })\n        this.state.video = toggle;\n        console.log(toggle)\n        if(toggle ===true){\n            this.toggler.closeSidemenu();\n            const samples = this.model.retrieveVideoSample();\n            const max_iter = samples.length;\n            var capturer = new ccapture( { format: 'webm',framerate:this.state.fps,quality:100});\n            this.RealTimeVideo(0,samples,max_iter,capturer,this.state.vidstate ,this.state.filename);\n\n        }\n        View.state.reference.video = !View.state.reference.video\n    }\n\n    RealTimeVideo(i,samples,max_iter,capturer,vidState,filename){\n        if(i ===0){\n            capturer.start();\n            capturer.capture(this.model.renderer.domElement);\n        }\n        if(i<max_iter){\n            this.functions[1].bind(this)(samples[i],i,vidState);\n            capturer.capture( this.model.renderer.domElement )\n            console.log('running animation',i)\n            if(this.state.video === true ){\n                requestAnimationFrame( ()=> this.RealTimeVideo(i+1,samples,max_iter,capturer,vidState,filename));\n            };\n        }\n        if (i === max_iter){\n                capturer.stop();\n                capturer.save(function( blob ) {\n                    console.log(blob);\n                    var url = URL.createObjectURL(blob);\n                    var link = document.createElement('a');\n                    link.href = url;\n                    console.log(filename)\n                    link.download = filename + '.webm';\n                    document.body.appendChild(link);\n                    link.click();\n                    document.body.removeChild(link);\n                });\n                View.state.reference.video =false;\n                View.state.reference.setVideoState = false;\n\n        }}\n\n\n    render(){\n        const video = this.state.video;\n        const upload = this.state.uploaded;\n        const setVideoState = this.state.loadVideoState;\n        const fps = this.state.fps;\n        return(\n            <div>\n                <Grid fluid>\n                    <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                            <br />\n                            <p><b> Load Configurations </b></p>\n                        </Col>\n                    </Row>\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox checked={upload} onClick={this.UploadFiles} > Load </Checkbox>\n                        </Col>\n                    </Row>\n\n                    <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                            <br />\n                            <p><b> Set Frame Rate</b></p>\n                        </Col>\n                    </Row>\n                    <CustomSlider boundaries={[1,60]} val={fps} f={this.setfps}type={'fps'} />\n                    <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                            <br />\n                            <p><b> Enviroment set up  </b></p>\n                        </Col>\n                    </Row>\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox onClick={this.setVideoState} checked={setVideoState}>Apply </Checkbox>\n                        </Col>\n                        <Col xs={1}>\n                            <Whisper placement=\"bottom\" trigger=\"hover\" speaker={\n                                <Tooltip>\n                                    Modify enviromental set ups such as show unit box at other menus.\n                                    Toggle Apply to apply settings to Video.\n                            </Tooltip>\n                            }>\n                                <Icon style={{ marginTop: 8 }} icon=\"question-circle\" size=\"lg\" />\n                            </Whisper>\n                        </Col>\n                    </Row>\n\n                    <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                            <br />\n                            <p><b> Create Video </b></p>\n                        </Col>\n                    </Row>\n                    <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                        <p>Input File name:</p>\n                        <Input style={{ width:150,height:30,marginLeft: 20 }} placeholder=\"New_Video\"\n                            onChange={(filename) => this.setFileName(filename)}/>\n                        </Col>\n                    </Row>\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox onClick={this.VideoToggle} checked={video} disabled={!upload||!setVideoState}> Create </Checkbox>\n                        </Col>\n                   </Row>\n\n                </Grid>\n                <br />\n                <br />\n            </div>\n\n        )\n    }\n}\n\n\n\nexport class CameraOptions extends React.Component {\n\n    constructor(props) {\n        super();\n        this.state = View.state.camera;\n        this.model = props.model;\n        this.toggler = props.toggler;\n        this.selectType = this.selectType.bind(this);\n        this.updateLookat = this.updateLookat.bind(this);\n        this.updatePosition = this.updatePosition.bind(this);\n        this.updateZoom = this.updateZoom.bind(this);\n        this.updateState = this.updateState.bind(this);\n\n        this.toggler.updateCamera = () => {\n            this.updateState()\n        }\n    }\n\n    updateState(){\n        this.setState(View.state.camera);\n    }\n\n    updateZoom(val) {\n        this.setState({\n            zoom: val\n        });\n        this.model.updateCameraZoom(parseInt(val));\n        this.model.update();\n        View.state.camera.zoom = val;\n    }\n\n    selectType(val) {\n        this.setState({\n            type: val\n        });\n        View.state.camera.type = val;\n        this.model.setCamera(val,false);\n        if (val === \"orthographic\") {\n            this.updateZoom(50);\n        } else {\n            this.updateZoom(1);\n        }\n\n    }\n\n    updatePosition(val, type) {\n        let position = this.state.position;\n        if (val != isNaN && val != null) {\n            switch (type) {\n                case 'x':\n                    position.x = parseInt(val);\n                    break;\n                case 'y':\n                    position.y = parseInt(val);\n                    break;\n                case 'z':\n                    position.z = parseInt(val);\n                    break;\n                default:\n                    Alert.error('Error: Unexpected Camera Position Input');\n                    return;\n            }\n        }\n\n        this.model.updateCameraPosition(position);\n        this.model.update();\n        View.state.camera.position = position;\n    }\n\n    updateLookat(val, type) {\n        let lookAt = this.state.lookAt;\n\n        if (isNaN(val) ||!val) {\n            val =0\n        }\n        switch (type) {\n            case 0:\n                lookAt.x = parseFloat(val);\n                break;\n            case 1:\n                lookAt.y = parseFloat(val);\n                break;\n            case 2:\n                lookAt.z = parseFloat(val);\n                break;\n            default:\n                Alert.error('Error: Unexpected Look At Input');\n                return;\n        }\n\n        this.model.updateLookAt(lookAt);\n        this.model.update();\n        View.state.camera.lookAt = lookAt;\n    }\n\n\n    render() {\n        const cameraType = this.state.type;\n        const zoom = this.state.zoom;\n        const lookAt = [this.state.lookAt.x, this.state.lookAt.y, this.state.lookAt.z];\n        const cameraPosition = this.state.position;\n\n\n        return (\n            <div key={JSON.stringify(this.state)}>\n                <br />\n                <Row className=\"show-grid\">\n                    <Col xs={2} />\n                    <Col xs={12}>\n\n                        <FormGroup controlId=\"radioList\">\n                            <RadioGroup name=\"radioList\" value={cameraType} onChange={this.selectType}>\n                                <p><b>Type</b></p>\n                                <Radio value=\"perspective\">Perspective </Radio>\n                                <Radio value=\"orthographic\">Orthographic </Radio>\n                            </RadioGroup>\n                        </FormGroup>\n\n                    </Col>\n                </Row>\n\n                <Grid fluid>\n\n                    <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                            <br />\n                            <p><b> Position</b></p>\n                        </Col>\n                    </Row>\n\n                    <CustomSlider boundaries={[-50, 50]} val={cameraPosition.x} f={this.updatePosition} type={'x'} />\n                    <CustomSlider boundaries={[-50, 50]} val={cameraPosition.y} f={this.updatePosition} type={'y'} />\n                    <CustomSlider boundaries={[-50, 50]} val={cameraPosition.z} f={this.updatePosition} type={'z'} />\n                    <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                            <br />\n                            <p><b> Zoom </b></p>\n                        </Col>\n                    </Row>\n                    <CustomSlider key={cameraType} boundaries={[1, 100]} val={zoom} f={this.updateZoom} />\n                    <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                            <br />\n                            <p><b> Look at</b></p>\n                        </Col>\n                    </Row>\n                    <ParameterSet titles={[\"x\", \"y\", \"z\"]} values={lookAt} f={this.updateLookat} step={0.5} styling={submenuParameterSetStyling} />\n\n                </Grid>\n                <br />\n\n\n\n            </div>);\n    }\n}\n\nexport class SlicingOptions extends React.Component {\n\n    constructor(props) {\n        super();\n        this.state = View.state.slicing\n        this.model = props.model;\n        this.toggleSlicer = this.toggleSlicer.bind(this);\n        this.toggleHelperX = this.toggleHelperX.bind(this);\n        this.toggleHelperY = this.toggleHelperY.bind(this);\n        this.toggleHelperZ = this.toggleHelperZ.bind(this);\n        this.updateHelpers = this.updateHelpers.bind(this);\n        this.updateSlicer = this.updateSlicer.bind(this);\n        console.log(this.state,View.state.slicing);\n    }\n\n    toggleSlicer(){\n        let toggle = !this.state.slicing_enabled;\n        this.model.enableClipping(toggle,View.state.model.active);\n        this.setState({\n            slicing_enabled :toggle\n        })\n        View.state.slicing.slicing_enabled = toggle\n        console.log(this.state,View.state.slicing);\n    }\n\n    updateHelpers(helpers) {\n        this.setState(\n            {\n                helpers: helpers\n            }\n        );\n        View.state.slicing.helpers = helpers;\n    }\n\n    toggleHelperX() {\n        let helpers = this.state.helpers;\n        let toggle = !helpers[0];\n        helpers[0] = toggle;\n        this.updateHelpers(helpers);\n        this.model.toggleHelper(0, toggle);\n        this.model.update();\n    }\n\n    toggleHelperY() {\n        let helpers = this.state.helpers;\n        let toggle = !helpers[1];\n        helpers[1] = toggle;\n        this.updateHelpers(helpers);\n        this.model.toggleHelper(1, toggle);\n        this.model.update();\n    }\n\n    toggleHelperZ() {\n        let helpers = this.state.helpers;\n        let toggle = !helpers[2];\n        helpers[2] = toggle;\n        this.updateHelpers(helpers);\n        this.model.toggleHelper(2, toggle);\n        this.model.update();\n    }\n\n    updateSlicer(i, val) {\n\n        switch (i) {\n            case 0:\n                this.setState(\n                    {\n                        x:val\n                    }\n                );\n                View.state.slicing.x = val;\n                break;\n            case 1:\n                this.setState(\n                    {\n                        y:val\n                    }\n                );\n                View.state.slicing.ty = val;\n                break;\n            case 2:\n                this.setState(\n                    {\n                        z:val\n                    }\n                );\n                View.state.slicing.z = val;\n                break;\n            default:\n                Alert.error('Error: Unexpected Slicing Identifier');\n        }\n\n\n\n        this.model.updateSlicer(i, val);\n        this.model.update();\n    }\n    render() {\n        const state = this.state;\n        const slicing_enabled = this.state.slicing_enabled;\n        return (\n            <div>\n                <br />\n                <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                            <br />\n                            <p><b> Enable Slicing</b></p>\n                        </Col>\n                    </Row>\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox style={{ marginLeft: 12 }} checked={slicing_enabled}onClick={this.toggleSlicer}> enable </Checkbox>\n                        </Col>\n                    </Row>\n                <SliceSlider title=\"X : \" f={this.updateSlicer} index={0} vals={state.x} disabled={!slicing_enabled}/>\n                <br />\n                <Grid fluid>\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox checked={state.helpers[0]} onClick={this.toggleHelperX}> Show Helper</Checkbox>\n                        </Col>\n                    </Row>\n                </Grid>\n                <SliceSlider title=\"Y : \" f={this.updateSlicer} index={1} vals={state.y} />\n                <br />\n                <Grid fluid>\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox checked={state.helpers[1]} onClick={this.toggleHelperY}> Show Helper</Checkbox>\n                        </Col>\n                    </Row>\n                </Grid>\n                <SliceSlider title=\"Z : \" f={this.updateSlicer} index={2} vals={state.z} />\n                <br />\n                <Grid fluid>\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox checked={state.helpers[2]} onClick={this.toggleHelperZ}> Show Helper</Checkbox>\n                        </Col>\n                    </Row>\n                </Grid>\n            </div>\n        );\n    }\n\n}\n\n\n\n\n\nexport const AdditionalLightsNav = ({ active, onSelect }) => {\n    return (\n        <Nav activeKey={active} onSelect={onSelect} style={{ margin: 10, width: 280 }} justified appearance=\"tabs\">\n            <Nav.Item eventKey=\"point\">Point</Nav.Item>\n            <Nav.Item eventKey=\"directional\">Directional</Nav.Item>\n        </Nav>\n    );\n};\n\nexport class AdditionalLightOptions extends React.Component {\n\n    constructor(props) {\n        super();\n        this.state = View.state.pointLight;\n        this.model = props.model;\n        this.reset = 0;\n        this.handleSelect = this.handleSelect.bind(this);\n        this.updateColour = this.updateColour.bind(this);\n        this.updatePosition = this.updatePosition.bind(this);\n        this.toggleLightEnabled = this.toggleLightEnabled.bind(this);\n        this.toggleHelper = this.toggleHelper.bind(this);\n\n    }\n    handleSelect() {\n        if (this.state.active.localeCompare('point') === 0) {\n            this.setState(View.state.directionalLight);\n        } else {\n            this.setState(View.state.pointLight);\n        }\n        if (this.reset > 5) {\n            this.reset = 0;\n        }\n\n        this.setState({ reset: ++this.reset });\n    }\n\n    toggleHelper() {\n        let helper = !this.state.helper;\n        this.setState({\n            helper: helper\n        });\n\n        if (this.state.active.localeCompare('point') === 0) {\n            View.state.pointLight.helper = helper;\n            this.model.toggleLightHelper(2, helper);\n            this.model.update();\n        } else {\n            View.state.directionalLight.helper = helper;\n            this.model.toggleLightHelper(1, helper);\n            this.model.update();\n        }\n    }\n\n    toggleLightEnabled() {\n        let enabled = !this.state.enabled;\n        this.setState({\n            enabled: enabled\n        });\n        let intensity;\n        if (this.state.active.localeCompare('point') === 0) {\n            View.state.pointLight.enabled = enabled;\n            intensity = View.state.pointLight.colour.i;\n        } else {\n            View.state.directionalLight.enabled = enabled;\n            intensity = View.state.directionalLight.colour.i;\n        }\n\n        if (enabled) {\n            this.updateColour(intensity, 'i');\n        } else {\n            this.updateColour(0, 'i');\n        }\n        this.setState({ reset: ++this.reset });\n\n        if (this.state.active.localeCompare('point') === 0) {\n            View.state.pointLight.colour.i = intensity;\n        } else {\n            View.state.directionalLight.colour.i = intensity;\n        }\n    }\n\n    updateColour(val, type) {\n        let colour = this.state.colour;\n\n        switch (type) {\n            case 'r':\n                colour.r = val;\n                break;\n            case 'g':\n                colour.g = val;\n                break;\n            case 'b':\n                colour.b = val;\n                break;\n            case 'i':\n                colour.i = val;\n                break;\n            default:\n                Alert.error('Error: Unexpected RGB Identifier');\n        }\n\n        if (this.state.active.localeCompare('point') === 0) {\n            this.model.updateLight(2, colour);\n            View.state.pointLight.colour = colour;\n        } else {\n            this.model.updateLight(1, colour);\n            View.state.directionalLight.colour = colour;\n        }\n        this.model.update();\n    }\n    updatePosition(val, type) {\n        let position = this.state.position;\n\n        switch (type) {\n            case 'x':\n                position.x = val;\n                break;\n            case 'y':\n                position.y = val;\n                break;\n            case 'z':\n                position.z = val;\n                break;\n            default:\n                Alert.error('Error: Unexpected Position Identifier');\n        }\n\n        if (this.state.active.localeCompare('point') === 0) {\n            this.model.updateLightPosition(2, position);\n            View.state.pointLight.position = position;\n        } else {\n            this.model.updateLightPosition(1, position);\n            View.state.directionalLight.position = position;\n        }\n        this.model.update();\n    }\n\n    render() {\n        const active = this.state.active;\n        const lightState = this.state;\n        return (\n            <div key={lightState.reset}>\n                <br />\n                <AdditionalLightsNav active={active} onSelect={this.handleSelect} />\n                <br />\n                <Grid fluid>\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox checked={lightState.enabled} onClick={this.toggleLightEnabled}> <strong>Enabled </strong> </Checkbox>\n                            <Checkbox checked={lightState.helper} onClick={this.toggleHelper}> <strong>Show Helper </strong> </Checkbox>\n                            <br />\n                        </Col>\n                    </Row>\n                </Grid>\n                <p style={{ marginLeft: TITLE_LEFT_MARGIN }}> RGB </p>\n                <CustomSlider disabled={!lightState.enabled} boundaries={[0, 255]} val={lightState.colour.r} f={this.updateColour} type={'r'} />\n                <CustomSlider disabled={!lightState.enabled} boundaries={[0, 255]} val={lightState.colour.g} f={this.updateColour} type={'g'} />\n                <CustomSlider disabled={!lightState.enabled} boundaries={[0, 255]} val={lightState.colour.b} f={this.updateColour} type={'b'} />\n                <p style={{ marginLeft: TITLE_LEFT_MARGIN }}> Intensity </p>\n                <CustomSlider disabled={!lightState.enabled} boundaries={[0, 100]} val={lightState.colour.i} f={this.updateColour} type={'i'} />\n                <p style={{ marginLeft: TITLE_LEFT_MARGIN }}> Position XYZ </p>\n                <CustomSlider disabled={!lightState.enabled} boundaries={[-50, 50]} val={lightState.position.x} f={this.updatePosition} type={'x'} />\n                <CustomSlider disabled={!lightState.enabled} boundaries={[-50, 50]} val={lightState.position.y} f={this.updatePosition} type={'y'} />\n                <CustomSlider disabled={!lightState.enabled} boundaries={[-50, 50]} val={lightState.position.z} f={this.updatePosition} type={'z'} />\n            </div>\n        );\n    }\n}\n\nexport class AmbientLightOptions extends React.Component {\n    constructor(props) {\n        super();\n\n        this.state = View.state.ambientLight;\n\n        this.model = props.model;\n\n        this.updateColour = this.updateColour.bind(this);\n        this.updateBg = this.updateBg.bind(this);\n    }\n    updateColour(val, i) {\n        let colour = this.state.ambientLightColour;\n\n        switch (i) {\n            case 'r':\n                colour.r = val;\n                break;\n            case 'g':\n                colour.g = val;\n                break;\n            case 'b':\n                colour.b = val;\n                break;\n            case 'i':\n                colour.i = val;\n                break;\n            default:\n                Alert.error('Error: Unexpected RGB Identifier');\n        }\n        this.model.updateLight(0, colour);\n        this.model.update();\n        View.state.ambientLight.ambientLightColour = colour;\n    }\n    updateBg() {\n        console.log(this.state.darkBackGround)\n        let toggle = !this.state.darkBackGround;\n        this.setState({\n            darkBackGround:toggle\n        })\n        console.log(this.state.darkBackGround)\n        if (toggle === true){\n            this.model.updateBg(\"#000000\");\n        }\n        else{\n            this.model.updateBg('#FFFFFF');\n        }\n        this.model.update();\n        View.state.ambientLight.darkBackGround = !View.state.ambientLight.darkBackGround;\n\n    }\n    render() {\n        const ambientLightColour = this.state.ambientLightColour;\n        const backgroundColour = this.state.darkBackGround;\n        return (\n            <div>\n                <Divider><strong style={dividerStyle}> Ambient Light </strong></Divider>\n                <p style={{ marginLeft: TITLE_LEFT_MARGIN }}> RGB </p>\n                <CustomSlider disabled={false} boundaries={[0, 255]} val={ambientLightColour.r} f={this.updateColour} type={'r'} />\n                <CustomSlider disabled={false} boundaries={[0, 255]} val={ambientLightColour.g} f={this.updateColour} type={'g'} />\n                <CustomSlider disabled={false} boundaries={[0, 255]} val={ambientLightColour.b} f={this.updateColour} type={'b'} />\n                <p style={{ marginLeft: TITLE_LEFT_MARGIN }}> Intensity </p>\n                <CustomSlider disabled={false} boundaries={[0, 100]} val={ambientLightColour.i} f={this.updateColour} type={'i'} />\n                <Divider><strong style={dividerStyle}> Background Colour</strong></Divider>\n                <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox style={{ marginLeft: 12 }} checked ={backgroundColour} onClick={this.updateBg}> Dark Mode</Checkbox>\n                        </Col>\n                </Row>\n            </div>\n        );\n    }\n}\n\nexport class ReferenceOptions extends React.Component {\n    constructor(props) {\n        super();\n        this.state = View.state.reference;\n        this.state.model = View.state.model;\n        this.model = props.model;\n        this.toggleFold = this.toggleFold.bind(this);\n        this.toggleBoundingShapeEnabled= this.toggleBoundingShapeEnabled.bind(this);\n        this.toggleAxes = this.toggleAxes.bind(this);\n\n        this.toggleMulticolour = this.toggleMulticolour.bind(this);\n        this.toggle_axes_enabled = this.toggle_axes_enabled.bind(this)\n        this.toggle_axes_colour = this.toggle_axes_colour.bind(this)\n\n    }\n\n    toggleFold() {\n        let toggle = !this.state.model.configurations[this.state.model.active].displayFoldState;\n        this.setState({\n            displayFoldState: toggle\n        });\n        console.log(this.state.model);\n        View.state.model.configurations[this.state.model.active].displayFoldState = toggle;\n        this.model.toggleFoldState(this.state.model.active,toggle);\n        this.model.update();\n    }\n\n    toggleBoundingShapeEnabled() {\n        let toggle = !this.state.boundingShapeEnabled;\n        this.setState({\n            boundingShapeEnabled: toggle\n        });\n        this.model.updateBoundingShape(View.state.reference.activeShape, toggle);\n        this.model.update();\n        View.state.reference.boundingShapeEnabled = ! View.state.reference.boundingShapeEnabled;\n    }\n\n    toggle_axes_enabled() {\n        this.model.toggle_axes_enabled();\n        this.setState({axesEnabled: !this.model.axes_enabled});\n    }\n\n    toggle_axes_colour() {\n        this.model.toggle_axes_colour();\n        this.setState({multicolour: !this.model.colour_axes});\n    }\n\n    toggleMulticolour() {\n        this.setState({\n            multicolour: !this.state.multicolour\n        });\n        this.model.toggleAxesMulticolour();\n        this.model.update();\n        View.state.reference.multicolour = !View.state.reference.multicolour;\n    }\n    toggleAxes() {\n        this.setState({\n            showAxes: !this.state.showAxes\n        });\n        this.model.toggleAxes();\n        this.model.update();\n\n        View.state.reference.showAxes = !View.state.reference.showAxes;\n    }\n\n\n    render() {\n        const configState = this.state.model.configurations[this.state.model.active];\n        const enabled = this.state.boundingShapeEnabled;\n        const showAxes = this.model.axes_enabled;\n        const multicolour = this.model.colour_axes;\n        return (\n            <div>\n\n                <Grid fluid>\n                <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                            <br />\n                            <p><b> Unit Box </b></p>\n                        </Col>\n                    </Row>\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox style={{ marginLeft: 12 }} checked={enabled}onClick={this.toggleBoundingShapeEnabled}>  Show </Checkbox>\n                        </Col>\n                    </Row>\n                    <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                            <br />\n                            <p><b> Periodic Boundary Conditions  </b></p>\n                        </Col>\n                    </Row>\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox style={{ marginLeft: 12 }} checked={configState.displayFoldState} onClick={this.toggleFold}> Fold</Checkbox>\n                        </Col>\n                    </Row>\n                    <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                            <br />\n                            <p><b> Axes </b></p>\n                        </Col>\n                    </Row>\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox style={{marginLeft: 12}} checked={showAxes}\n                                      onClick={this.toggle_axes_enabled}> Show</Checkbox>\n\n                        </Col>\n                    </Row>\n\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n\n                            <Checkbox style={{marginLeft: 12}} checked={multicolour}\n                                      onClick={this.toggle_axes_colour}> Multi-Colour</Checkbox>\n\n                        </Col>\n                        <Col xs={4}>\n                            <Whisper placement=\"bottom\" trigger=\"hover\" speaker={\n                                <Tooltip>\n                                    X : RED <br /> Y : GREEN <br /> Z : BLUE\n                            </Tooltip>\n                            }>\n                                <Icon style={{ marginTop: 8 }} icon=\"question-circle\" size=\"lg\" />\n                            </Whisper>\n                        </Col>\n                    </Row>\n\n\n\n                </Grid>\n\n            </div>\n        );\n    }\n}\n","import {Alert, Container, Content, Icon, IconButton, Nav, Navbar, Sidebar} from 'rsuite';\nimport React, {Component} from \"react\";\nimport {\n    AdditionalLightOptions,\n    AmbientLightOptions,\n    CameraOptions,\n    ModelsOptions,\n    ReferenceOptions,\n    SlicingOptions,\n    VideoOptions\n} from './SubMenus'\n\n\nconst NavToggle = ({expand, onChange}) => {\n    return (<Navbar appearance=\"subtle\" className=\"nav-toggle\">\n        <Navbar.Body>\n            <Nav pullRight>\n                <IconButton\n                    circle\n                    style={{textAlign: 'center', margin: 10}}\n                    onClick={onChange}\n                    appearance=\"default\"\n                    icon={<Icon icon={expand ? 'angle-left' : 'angle-right'}/>}/>\n            </Nav>\n        </Navbar.Body>\n    </Navbar>);\n};\n\nconst navItemStyle = {margin: 6.5};\n\nlet sidebarHeight = window.innerHeight - 56;\n\nconst CustomNav = ({active, onSelect, ...props}) => {\n    return (<div>\n        <Nav {...props} activeKey={active} onSelect={onSelect}\n             style={{backgroundColor: '#101010', height: sidebarHeight}}>\n            <Nav.Item title=\"Models\" eventKey=\"Models\" icon={<Icon style={navItemStyle} size=\"lg\" icon=\"shapes\"/>}>\n            </Nav.Item>\n            {/* <Whisper placement=\"right\" trigger=\"hover\" speaker={(<Tooltip>Slicing</Tooltip>)}> */}\n            <Nav.Item title=\"Slicing\" eventKey=\"Slicing\" icon={<Icon style={navItemStyle} size=\"lg\" icon=\"cut\"/>}/>\n            {/* </Whisper> */}\n            {/* <Whisper placement=\"right\" trigger=\"hover\" speaker={(<Tooltip>Slicing</Tooltip>)}> */}\n            <Nav.Item title=\"Video Rendering\" eventKey=\"Video Rendering\"\n                      icon={<Icon style={navItemStyle} size=\"lg\" icon=\"film\"/>}/>\n            {/* </Whisper> */}\n            {/* <Whisper placement=\"right\" trigger=\"hover\" speaker={(<Tooltip>View</Tooltip>)}> */}\n            <Nav.Item title=\"Camera\" eventKey=\"Camera\" icon={<Icon style={navItemStyle} size=\"lg\" icon=\"eye\"/>}/>\n            {/* </Whisper> */}\n            {/* <Whisper placement=\"right\" trigger=\"hover\" speaker={(<Tooltip>Ambient Light</Tooltip>)}> */}\n            <Nav.Item title=\"Ambient\" eventKey=\"Ambient\"\n                      icon={<Icon style={navItemStyle} size=\"lg\" icon=\"sun-o\"/>}/>\n            {/* </Whisper> */}\n            {/* <Whisper placement=\"right\" trigger=\"hover\" speaker={(<Tooltip>Other Lighting</Tooltip>)}> */}\n            <Nav.Item title=\"Lighting\" eventKey=\"Lighting\"\n                      icon={<Icon style={navItemStyle} size=\"lg\" icon=\"creative\"/>}/>\n            {/* </Whisper> */}\n            {/* <Whisper placement=\"right\" trigger=\"hover\" speaker={(<Tooltip>Reference Frame Frame</Tooltip>)}> */}\n            <Nav.Item title=\"Reference\" eventKey=\"Reference\"\n                      icon={<Icon style={navItemStyle} size=\"lg\" icon=\"cube\"/>}/>\n            {/* </Whisper> */}\n\n        </Nav>\n    </div>);\n};\n\nconst MenuContent = ({active, expand, onChange, model, toggler, functions}) => {\n\n    let menuContent = [];\n\n    if (!expand) {\n        menuContent.push(<NavToggle expand={expand} onChange={onChange}/>);\n    } else {\n        menuContent.push(<div style={{backgroundColor: '#0F131B'}}>\n            <Nav>\n                <Navbar appearance=\"subtle\">\n                    <Nav>\n                        <h3 style={{marginTop: 15, marginLeft: 30}}>{active}</h3>\n                    </Nav>\n                    <Nav pullRight>\n                        <NavToggle expand={expand} onChange={onChange}/>\n                    </Nav>\n                </Navbar>\n\n            </Nav>\n        </div>);\n    }\n\n    if (expand) {\n        switch (active) {\n            case \"Models\":\n                menuContent.push(<ModelsOptions key={active} model={model}/>);\n                break;\n            case \"Camera\":\n                menuContent.push(<CameraOptions key={active} model={model} toggler={toggler}/>);\n                break;\n            case \"Ambient\":\n                menuContent.push(<AmbientLightOptions key={active} model={model}/>);\n                break;\n            case \"Lighting\":\n                menuContent.push(<AdditionalLightOptions key={active} model={model}/>);\n                break;\n            case \"Slicing\":\n                menuContent.push(<SlicingOptions key={active} model={model}/>);\n                break;\n            case \"Reference\":\n                menuContent.push(<ReferenceOptions key={active} model={model}/>);\n                break;\n            case \"Video Rendering\":\n                menuContent.push(<VideoOptions key={active} model={model} functions={functions} toggler={toggler}/>);\n                break;\n            default:\n                Alert.error('Error: Unknown Submenu Identifier');\n        }\n    }\n\n    return menuContent;\n\n}\n\nclass VisualisationMenu extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            expand: props.sidebarExpanded, active: 'Models'\n        };\n        this.functions = props.functions;\n        this.model = props.model;\n        this.handleToggle = this.handleToggle.bind(this);\n        this.handleSelect = this.handleSelect.bind(this);\n        this.toggler = props.toggler;\n\n        this.toggler.closeSidemenu = () => {\n            if (this.state.expand) {\n                this.handleToggle();\n            }\n        }\n    }\n\n    handleToggle() {\n        this.setState({\n            expand: !this.state.expand\n        });\n        this.model.toggleSidebar();\n    }\n\n    handleSelect(activeKey) {\n        this.setState({\n            active: activeKey\n        });\n\n        if (!this.state.expand) {\n            this.handleToggle();\n        }\n\n    }\n\n    render() {\n        const {expand} = this.state;\n        const {active} = this.state;\n        return (<div>\n                <Sidebar\n                    style={{display: 'flex', flexDirection: 'column'}}\n                    width={expand ? 356 : 56}\n                    collapsible\n                    appearance=\"default\"\n                >\n                    <Container>\n                        <Sidebar width={56}>\n                            <CustomNav vertical appearance=\"subtle\" active={active} onSelect={this.handleSelect}/>\n                        </Sidebar>\n                        <Content>\n                            <MenuContent key={10} active={active} expand={expand} onChange={this.handleToggle}\n                                         model={this.model} toggler={this.toggler} functions={this.functions}/>\n                        </Content>\n\n                    </Container>\n\n                </Sidebar>\n            </div>\n\n        );\n    }\n}\n\n\nexport default VisualisationMenu;","import React from \"react\";\nimport GeneralMenu from './GeneralMenu';\nimport VisualisationMenu from './VisualisationMenu';\n\nexport class View {\n    static state;\n    header;\n    sidebar;\n    model;\n    expanded;\n    ModelDefaultState = {\n        active: 0, reset: 0, sets: [], configurations: [],\n    }\n    SlicingDefaultState = {\n        clipIntersection: false,\n        slicing_enabled: false,\n        helpers: [false, false, false],\n        x: [-80, 80],\n        y: [-80, 80],\n        z: [-80, 80]\n    }\n    ConfigurationDefaultState = {\n        title: '', shape: 'Ellipsoid', parameters: {\n            names: ['X', 'Y', 'Z'], vals: [1, 1, 0.2]\n        }, colour: {\n            r: 255, g: 255, b: 255\n        }, colourFromDirector: true, displayAsWireframe: false\n    }\n    CameraDefaultState = {\n        type: 'orthographic', lookAt: {\n            x: 0, y: 0, z: 0\n        }, position: {\n            x: 0, y: 0, z: -15\n        }, zoom: 50\n    }\n    PointLightDefaultState = {\n        reset: 0, active: 'point', enabled: true, helper: false, colour: {\n            r: 255, g: 255, b: 255, i: 60\n        }, position: {\n            x: 5, y: 0, z: 5\n        }\n    }\n    DirectionalLightDefaultState = {\n        reset: 0, active: 'directional', enabled: true, helper: false, colour: {\n            r: 255, g: 255, b: 255, i: 50\n        }, position: {\n            x: -5, y: 0, z: -5\n        }\n\n    }\n    ReferenceDefaultState = {\n        boundingShapeEnabled: false,\n        activeShape: 'box',\n        showAxes: false,\n        multicolour: true,\n        size: 50,\n        fps: 24,\n        uploaded: true,\n        video: false,\n        loadVideoState: false\n    }\n    AmbientLightDefaultState = {\n        ambientLightColour: {\n            r: 255, g: 255, b: 255, i: 40\n        }, darkBackGround: true\n    }\n\n    constructor(m, io, chrono, toggler) {\n        View.state = {}\n        this.expanded = false;\n        this.model = m;\n        this.header = <GeneralMenu chronometer={chrono} functions={io} model={this.model} toggler={toggler}/>;\n        this.sidebar =\n            <VisualisationMenu model={this.model} functions={io} sidebarExpanded={this.expanded} toggler={toggler}/>;\n    }\n\n    getData() {\n        return View.state;\n    }\n\n    setState(state, vid) {\n        View.state = state;\n        if (!vid) {\n            this.loadLightingAndCamera(state, vid);\n        }\n        this.loadReferenceAndSlicing(state);\n        this.loadModel(state);\n    }\n\n    loadModel(state) {\n        let substate;\n        for (let i in state.model.configurations) {\n            substate = state.model.configurations[i];\n            this.model.updateUserColour(i, substate.colour);\n            this.model.toggleUserColour(i, substate.colourFromDirector);\n            this.model.toggleWireframe(i, substate.displayAsWireframe);\n            this.model.toggleFoldState(i, substate.displayFoldState);\n            this.model.updateShape(i, substate.shape, substate.parameters);\n        }\n        this.model.updateBoundingShape(state.reference.activeShape, state.reference.boundingShapeEnabled)\n    }\n\n    loadState(state, vid) {\n        if (!vid) {\n            this.loadLightingAndCamera(state, vid);\n        }\n        this.loadReferenceAndSlicing(state);\n\n    }\n\n    loadReferenceAndSlicing(state) {\n        if (this.xor(this.model.axesEnabled, state.reference.showAxes)) {\n            this.model.toggleAxes();\n        }\n        this.model.toggleFoldState(0, state.boundingShapeEnabled);\n        this.model.enableClipping(state.slicing.slicing_enabled);\n        this.model.toggleHelper(0, state.slicing.helpers[0]);\n        this.model.toggleHelper(1, state.slicing.helpers[1]);\n        this.model.toggleHelper(2, state.slicing.helpers[2]);\n        this.model.updateSlicer(0, state.slicing.x);\n        this.model.updateSlicer(1, state.slicing.y);\n        this.model.updateSlicer(2, state.slicing.z);\n\n    }\n\n    loadLightingAndCamera(state, vid) {\n        console.log('called load light')\n        let directionalLightColour = JSON.parse(JSON.stringify(state.directionalLight.colour));\n        let pointLightColour = JSON.parse(JSON.stringify(state.pointLight.colour));\n\n        if (!state.directionalLight.enabled) {\n            directionalLightColour.i = 0;\n        }\n        if (!state.pointLight.enabled) {\n            pointLightColour.i = 0;\n        }\n        if (state.ambientLight.darkBackGround) {\n            this.model.updateBg(\"#000000\");\n        }\n        if (!state.ambientLight.darkBackGround) {\n            this.model.updateBg('#FFFFFF');\n        }\n        this.model.updateLight(0, state.ambientLight.ambientLightColour);\n        this.model.updateLight(1, directionalLightColour);\n        this.model.updateLight(2, pointLightColour);\n        this.model.updateLightPosition(1, state.directionalLight.position);\n        this.model.updateLightPosition(2, state.pointLight.position);\n        this.model.toggleLightHelper(1, state.directionalLight.helper);\n        this.model.toggleLightHelper(2, state.pointLight.helper);\n        if (!vid) {\n            this.model.setCamera(state.camera.type, false);\n            this.model.updateCameraPosition(state.camera.position);\n        }\n        this.model.updateLookAt(state.camera.lookAt);\n        this.model.updateCameraZoom(state.camera.zoom);\n    }\n\n    setDefaultState(init, vid) {\n        View.state = {};\n        View.state.reference = this.ReferenceDefaultState;\n        View.state.ambientLight = this.AmbientLightDefaultState;\n        View.state.pointLight = this.PointLightDefaultState;\n        View.state.directionalLight = this.DirectionalLightDefaultState;\n        View.state.camera = this.CameraDefaultState;\n        View.state.slicing = this.SlicingDefaultState;\n        View.state.model = this.ModelDefaultState;\n        View.state.model.configurations = [];\n        View.state.model.sets = [];\n\n        for (let i in this.model.sets) {\n            let set = JSON.parse(JSON.stringify(this.ConfigurationDefaultState));\n            set.title = this.model.sets[i].name;\n            View.state.model.sets.push(set.title);\n            View.state.model.configurations.push(set);\n        }\n\n        this.loadState(View.state, vid);\n\n        if (!init) {\n            this.loadModel(View.state);\n        }\n    }\n\n    xor(a, b) {\n        return (a && !b) || (!a && b);\n    }\n\n}\n\nexport default View;","import Model from \"./Model/Model\";\nimport View from \"./View/View\"\nimport 'rsuite/dist/styles/rsuite-dark.css';\nimport {mean, std} from 'mathjs';\nimport unfolded_sample1 from './Samples/UnfoldedSC4.json';\nimport unfolded_sample2 from './Samples/UnfoldedE3.json';\nimport sample1 from './Samples/dummy-vector.json';\nimport sample2 from './Samples/dummy-quaternion.json';\nimport sample3 from './Samples/sc4-isotropic.json';\nimport sample4 from './Samples/sc4-nematic.json';\nimport sample5 from './Samples/sc4-smectic.json';\nimport sample6 from './Samples/e5-isotropic.json';\nimport sample7 from './Samples/e5-nematic.json';\nimport sample8 from './Samples/o5-isotropic.json';\nimport sample9 from './Samples/o5-nematic.json';\nimport sample10 from './Samples/bx-crystal.json';\nimport sample11 from './Samples/bx-crystal-2.json';\nimport sample12 from './Samples/fig1.json';\nimport sample13 from './Samples/hbc.json';\nimport sample14 from './Samples/single.json'\nimport sample15 from './Samples/qmga-shapes.json'\n\nimport {Alert, Notification} from 'rsuite'\n\n\nclass Controller {\n    model;\n    view;\n    io;\n    ExternalToggle = class ExternalToggle {\n        // these functions are defined within their respective React components\n        closeSidemenu = () => {\n        }\n        autorotate = () => {\n        }\n        updateCamera = () => {\n        }\n\n    }\n    Chronometer = class Chronometer {\n\n        constructor(notify, externalToggle) {\n            this.fps = 0;\n            this.frames = 0;\n            this.prevTime = null;\n            this.model = null;\n\n            this.notify = notify;\n            this.externalToggle = externalToggle;\n\n            this.step = 5000;\n            this.tick = 12;\n            this.testing = false;\n            this.counter = 0;\n            this.rawPerformanceData = [];\n            this.avgPerformanceData = [];\n            this.stdPerformanceData = [];\n        }\n\n        f = (n) => {\n            //is initialised in Header React Component\n        }\n\n        fps = () => {\n            return this.fps;\n        }\n\n        logPerformance = () => {\n            this.rawPerformanceData.push(this.fps);\n            if (this.counter === this.tick) {\n                this.avgPerformanceData.push(mean(this.rawPerformanceData));\n                this.stdPerformanceData.push(std(this.rawPerformanceData));\n                this.rawPerformanceData = [];\n                this.counter = 0;\n\n                this.notify('info', ' Test Update (' + this.model.testTotal.toString() + ' Molecules)', (\n                    <p style={{width: 320}}>\n                        <b>FPS</b> <br/>\n                        Average: {this.avgPerformanceData[this.avgPerformanceData.length - 1].toString()} <br/>\n                        Standard Deviation: {this.stdPerformanceData[this.stdPerformanceData.length - 1].toString()}\n                        <br/>\n                    </p>));\n\n                console.log('# of Molecules: ' + this.model.testTotal.toString() + ' FPS - Avg:  ' + this.avgPerformanceData[this.avgPerformanceData.length - 1].toString() + 'Std: ' + this.stdPerformanceData[this.stdPerformanceData.length - 1].toString())\n\n                if (this.model.addRandomParticles(this.step)) {\n                    this.testing = false;\n                    this.model.deleteAllMeshes();\n                    console.log('Average FPS');\n                    console.log(this.avgPerformanceData);\n                    console.log('Std FPS');\n                    console.log(this.stdPerformanceData);\n                    this.externalToggle.autorotate();\n                    this.notify('success', 'Test Completed Succesfully', (<p style={{width: 320}}>\n                        All molecules deleted. Please see console output for a list of average FPS and standard\n                        deviations.\n                    </p>));\n\n                }\n            }\n            this.counter++;\n        }\n\n\n        click = () => {\n            this.frames++;\n\n            if (this.prevTime === null) {\n                this.prevTime = Date.now();\n            }\n\n            let time = Date.now();\n\n\n            if (time > this.prevTime + 1000) {\n                this.fps = (this.frames * 1000) / (time - this.prevTime);\n\n                if (this.testing) {\n                    this.logPerformance();\n                }\n\n                this.prevTime = time;\n                this.frames = 0;\n                this.f(this.fps);\n\n\n            }\n        }\n    };\n\n    constructor() {\n\n        this.io = [this.save, this.load, this.export, this.loadSample, this.toggleAutorotate, this.saveVideoState];\n        this.externalToggle = new this.ExternalToggle();\n        this.chronometer = new this.Chronometer(this.notify, this.externalToggle);\n\n        this.model = new Model(this.chronometer, this.notify);\n        this.view = new View(this.model, this.io, this.chronometer, this.externalToggle);\n\n        Alert.config(({\n            top: 70, duration: 8000\n        }));\n\n    }\n\n    start = () => {\n        this.chronometer.model = this.model;\n        this.generate(sample2, true, false);\n        // this.model.occlusionCulling();\n        this.addListeners();\n        this.notify('info', `Welcome to WebMGA`, (<div>\n            <p style={{width: 320}}>\n                Check out the liquid crystal configurations in the Library, and head to the About section to\n                learn more!\n\n            </p>\n            <p style={{width: 320}}>\n                This application works best on the Chrome browser.\n            </p></div>));\n        // this.loadVideoSample();\n    }\n\n\n    notify(type, title, description) {\n        Notification[type]({\n            title: title, placement: 'bottomEnd', duration: 7000, description: description\n        });\n    }\n\n    //from stackoverflow\n    download = (data, filename, type) => {\n        let file = new Blob([data], {type: type});\n        if (window.navigator.msSaveOrOpenBlob) // IE10+\n            window.navigator.msSaveOrOpenBlob(file, filename); else { // Others\n            let a = document.createElement(\"a\"), url = URL.createObjectURL(file);\n            a.href = url;\n            a.download = filename;\n            document.body.appendChild(a);\n            a.click();\n            setTimeout(function () {\n                document.body.removeChild(a);\n                window.URL.revokeObjectURL(url);\n            }, 0);\n        }\n    }\n\n    save = () => {\n        let data = {};\n        data.model = this.model.getData();\n        data.state = this.view.getData();\n        this.download(JSON.stringify(data), 'visualisation.webmga', 'application/json');\n    }\n\n    saveVideoState = () => {\n        let data = {};\n        data.state = this.view.getData();\n        console.log('get state');\n        return JSON.stringify(data);\n\n    }\n\n    generate = (data, starting, vidstate) => {\n        this.model.genSets(data.model.sets);\n        if (data.state == null) {\n            if (vidstate) {\n                this.view.setState((JSON.parse(vidstate)).state, true);\n            } else {\n                this.view.setDefaultState(starting, false);\n                Alert.info(\"Setting default viewing state.\");\n            }\n        } else {\n            this.view.setState(data.state, false);\n        }\n        this.model.update();\n        this.externalToggle.closeSidemenu();\n    }\n\n    load = (file, VIDEO, vidstate) => {\n        let fileReader = new FileReader();\n        fileReader.onloadend = () => {\n            let data;\n            if (file.type === \"application/json\") {\n                data = JSON.parse(fileReader.result);\n            } else if (file.name.split(\".\").pop().toLowerCase() === \"qmga\") {\n                data = this.qmga_to_json(fileReader.result);\n            } else {\n                data = this.cnf_to_json(fileReader.result);\n            }\n            try {\n                console.log(vidstate);\n                this.generate(data, false, vidstate);\n                if (VIDEO === false) {\n                    Alert.success('File loaded successfully.');\n                }\n            } catch {\n                Alert.error('Error: Please review uploaded file. See manual for help.');\n            }\n        };\n        fileReader.readAsText(file);\n    }\n\n    qmga_to_json(data) {\n        let set = {name: \"Molecules\", orientationType: \"v\"}\n        let split_data = data.trim().split(\"\\n\")\n        let unit_box = split_data[0].split(/ +/)\n        set.unitBox = [parseFloat(unit_box[0]) / 2, parseFloat(unit_box[1]) / 2, parseFloat(unit_box[2]) / 2]\n        let molecule_count = split_data.length - 1\n        set.positions = new Array(molecule_count)\n        set.orientations = new Array(molecule_count)\n        for (let molecule_number = 0; molecule_number < molecule_count; ++molecule_number) {\n            let molecule_data = split_data[molecule_number + 1].trim().split(/ +/)\n            //TODO need to implement scale at position 0\n            set.positions[molecule_number] = molecule_data.slice(1, 4).map(value => parseFloat(value))\n            set.orientations[molecule_number] = molecule_data.slice(4, 7).map(value => parseFloat(value))\n        }\n        return {model: {sets: [set]}, state: null}\n    }\n\n    cnf_to_json(data) {\n        let set = {name: \"Molecules\", orientationType: \"v\"}\n        let split_data = data.trim().split(\"\\n\")\n        set.unitBox = [parseFloat(split_data[1]), parseFloat(split_data[2]), parseFloat(split_data[3])]\n        let molecule_count = parseInt(split_data[0])\n        set.positions = new Array(molecule_count)\n        set.orientations = new Array(molecule_count)\n        for (let molecule of split_data.slice(5)) {\n            let molecule_data = molecule.trim().split(/ +/)\n            let molecule_number = parseInt(molecule_data[12]) - 1\n            set.positions[molecule_number] = molecule_data.slice(0, 3).map(value => parseFloat(value))\n            set.orientations[molecule_number] = molecule_data.slice(6, 9).map(value => parseFloat(value))\n        }\n        return {model: {sets: [set]}, state: null}\n    }\n\n\n    loadSample = (id) => {\n        let sample;\n\n        switch (id) {\n            case 1:\n                sample = sample1;\n                break;\n            case 2:\n                sample = sample2;\n                break;\n            case 3:\n                sample = sample3;\n                break;\n            case 4:\n                sample = sample4;\n                break;\n            case 5:\n                sample = sample5;\n                break;\n            case 6:\n                sample = sample6;\n                break;\n            case 7:\n                sample = sample7;\n                break;\n            case 8:\n                sample = sample8;\n                break;\n            case 9:\n                sample = sample9;\n                break;\n            case 10:\n                sample = sample10;\n                break;\n            case 11:\n                sample = sample11;\n                break;\n            case 12:\n                sample = sample12;\n                break;\n            case 13:\n                sample = sample13;\n                break;\n            case 14:\n                sample = sample14;\n                break;\n            case 15:\n                sample = sample15;\n                break;\n            case 17:\n                sample = unfolded_sample1;\n                break;\n            case 18:\n                sample = unfolded_sample2;\n                break;\n            default:\n                Alert.error('Error: File does not exist');\n                return;\n        }\n\n        this.generate(sample, false, false);\n\n\n        Alert.success('File loaded successfully.');\n\n    }\n    export = (height, width, resolution) => {\n        // fix orthographic projection\n        this.model.height = height;\n        this.model.width = width;\n        this.model.updateCamera();\n\n        this.model.renderer.setSize(width, height);\n\n        this.model.renderer.render(this.model.scene, this.model.camera);\n\n        const dataURL = this.model.renderer.domElement.toDataURL(\"image/jpeg\", resolution / 10);\n\n        let link = document.createElement('a');\n        link.download = \"WebMGA Visualisation.jpeg\";\n        link.href = dataURL;\n        link.click();\n\n        this.model.updateDimensions();\n        this.model.updateCamera();\n\n\n        this.notify('success', `Thank you!`, (<div>\n            Image exported successfully.\n        </div>));\n    }\n\n    getHeader = () => {\n        return this.view.header;\n    }\n\n    getSidebar = () => {\n        return this.view.sidebar;\n    }\n\n\n    getDomElement = () => {\n        return this.model.renderer.domElement;\n    }\n\n    updateCamera = () => {\n        View.state.camera.position.x = Math.round(this.model.camera.position.x * 100) / 100;\n        View.state.camera.position.y = Math.round(this.model.camera.position.y * 100) / 100;\n        View.state.camera.position.z = Math.round(this.model.camera.position.z * 100) / 100;\n\n        View.state.camera.lookAt.x = Math.round(this.model.controls.target.x * 100) / 100;\n        View.state.camera.lookAt.y = Math.round(this.model.controls.target.y * 100) / 100;\n        View.state.camera.lookAt.z = Math.round(this.model.controls.target.z * 100) / 100;\n\n        View.state.camera.zoom = this.model.camera.zoom;\n\n\n        this.externalToggle.updateCamera();\n    }\n\n    render = () => {\n        this.model.update();\n        this.updateCamera();\n    }\n\n    addListeners = () => {\n        this.model.controls.addEventListener('change', this.render);\n\n        document.body.style.overflow = \"hidden\";\n\n        window.addEventListener('resize', () => {\n            this.model.updateDimensions();\n            this.model.updateCamera();\n        });\n\n        document.addEventListener('fullscreenchange', () => {\n            this.model.updateDimensions();\n            this.model.updateCamera();\n        });\n\n\n        document.body.onkeydown = (e) => {\n            switch (e.code) {\n                case 'Space':\n                    this.externalToggle.autorotate();\n                    if (this.chronometer.testing) {\n                        this.chronometer.testing = false;\n                    }\n                    break;\n                case  'KeyA':\n                    console.log(this.model.camera.position);\n                    break;\n            }\n\n            // //g\n            // if (key == 71) {\n            //     this.model.toggleGrid();\n            // }\n            // if (key == 69) {\n            //     this.view.toggleSidebar();\n            // }\n        }\n    }\n}\n\nexport default Controller;","import React, {Component} from \"react\";\nimport 'rsuite/dist/styles/rsuite-dark.css';\nimport {Container, Content} from 'rsuite';\nimport Controller from \"./Controller\";\n\nclass App extends Component {\n    controller;\n\n    constructor(props) {\n        super(props);\n        this.controller = new Controller();\n\n        this.state = {\n            header: this.controller.getHeader(), sidebar: this.controller.getSidebar()\n        };\n    }\n\n    componentDidMount() {\n        this.mount.appendChild(this.controller.getDomElement());\n        this.controller.start();\n    }\n\n    render() {\n        const header = this.state.header;\n        const sidebar = this.state.sidebar;\n\n        return (<div>\n            <Container>\n                {header}\n                <Container>\n                    {sidebar}\n                    <Content>\n                        <div ref={ref => (this.mount = ref)}/>\n                    </Content>\n                </Container>\n\n            </Container>\n\n        </div>)\n    }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(<React.StrictMode> <App/> </React.StrictMode>, document.getElementById('root'));\n"],"sourceRoot":""}