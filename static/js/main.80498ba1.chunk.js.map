{"version":3,"sources":["Model/Shapes.ts","Model/Light.ts","Model/Parameters.js","Model/Set.js","Model/ReferenceTools.js","Model/Model.tsx","View/Tools.js","View/GeneralMenu.js","View/SubMenus.js","View/VisualisationMenu.js","View/View.js","Controller.js","App.js","index.js"],"names":["linspace","start","stop","number","increment","values","i","push","base","Shape","LOD","parameters","stripGeometry","this","arguments","default_lod","undefined","lod","vertices","offset","length","cut","math","roll_row","slice","concat","section","map","row","row_index","complexity_count","complexity","value","LightTypes","Sphere","radius","vertical_sample_scale","samples","vertical_samples","update_samples","Math","max","genGeometries","theta","phi","sin_phi","sin","cos","thetas","phis","offset_thetas","PI","result","entries","phi_index","abc","sample_sphere","vertex_row","vertex","floor","phi_offset","spherical_vertices","quarter_thetas","bottom_half","rolled_vertices","roll_offset","toReversed","build_quarters","quarter_sphere_vertices","roll_vertices","build_halves","half_sphere_vertices","positions","row_column","position_components","to_triangles","geometry","BufferGeometry","setAttribute","BufferAttribute","Float32Array","BufferGeometryUtils","mergeVertices","computeVertexNormals","normalizeNormals","sub_geometries","generate_vertices","sub_vertices","geometry_from_vertices","a","mergeBufferGeometries","console","log","genGeometriesBase","top","bottom","acos","angle","Spherocylinder","length_scaling_vector","sphere","ceil","connect_halves","Spheroplatelet","circle_radius","row_count","column_count","column","circle_angles","radius_vector","norm","face_circle_angles","x","normalised_radius_vector","Ellipsoid","y","z","scale","CapCutSphereBase","cut_radius","z_cut","flat_top","end_source_index","xs","ys","zs","end","Array","fill","CutSphere","DoubleCutSphere","angle_cut","partial_vertices","index","Cap","BaseLens","radius_2","top_shape","bottom_cap","bottom_shape","set_lod","reverse","pole_offset","reverse_vertices","distance","ThickLens","thickness","cos_theta","RadiusOnlyLens","BiconvexLens","separation","shape_halves","part","item","side_top_row","side_bottom_row","Parameters","names","vals","Lens","Set","data","cp","ci","Folded_position","orientations","elements","meshes","Element","p","q","position","orientation","quaternionToUnitVector","euler","Euler","setFromQuaternion","colourIndex","quaternion","w","geoms","geometries","name","orientationType","unitBox","clippingPlanes","clipIntersection","setDefaults","shapeType","genSet","b","c","validateData","genElements","genMeshes","Error","toString","defaultParameters","getParameters","userColour","Color","colourByDirector","wireframe","renderBackFace","constant","isFoldedTest","pos","rnd1","random","rnd2","rnd3","Alert","info","lx","ly","lz","rx","ry","rz","round","bool","num","geometry_distances","distance_index","new_gen_geometries","rgb","colourMap","Model","rgbToHex","mat","MeshPhongMaterial","side","THREE","clipShadows","color","matrix2","ori","compose","lod_mesh","addLevel","applyMatrix4","getRotations","calculateDirector","elem","setColourIndex","calculateColourIndex","shape","SHAPE","generate","translate","type","rot","Quaternion","orientationVector","Vector3","normalize","setFromUnitVectors","set","setFromAxisAngle","e","fromArray","setFromEuler","n","orderTensor","factor","eigen","eigs","reduce","iMax","arr","director","vectors","sqrt","isNaN","error","element","scalarProduct","abs","hex","val","LightNew","lightType","light","helper","setLight","setHelper","AMBIENT","AmbientLight","DIRECTIONAL","DirectionalLight","POINT","PointLight","RangeError","DirectionalLightHelper","PointLightHelper","setHex","parseInt","substring","intensity","light_types","ReferenceTools","s","axes","size","colour","material","LineBasicMaterial","linewidth","multicolour","genMulticolourAxes","genSubgrid","R","G","B","director_colour","boundingShapeType","setsGeometry","sets","boundingShape","genUnitBox","box","Box3","setFromCenterAndSize","Box3Helper","genAxes","subGrid","GridHelper","axesSize","origin","Line","setFromPoints","director_vector","clone","multiplyScalar","mat1","mat2","mat3","mat4","updateColour","chronometer","notify","scene","camera","lighting","bgColour","controls","lookAt","tools","renderer","height","width","axesEnabled","sidebarExpanded","cameraType","cameraPosition","selectedSet","clippingHelpers","numOfObject","axes_enabled","colour_axes","repeats_x","repeats_y","repeats_z","molecules","onBeforeRender","set_axes","setDefault","WebGLRenderer","antialias","powerPreference","preserveDrawingBuffer","setPixelRatio","window","devicePixelRatio","rotating","lightHelperWarningGiven","Video_sample_list","initClippers","updateDimensions","setCamera","setClearColor","l","add","enabled","axes_origin","assert","zoom","axis","remove","divideScalar","world_axes_origin","localToWorld","axis_line_ends","director_line_ends","line_ends","line_materials","line_end","colour_from_director","line_geometry","vector","enable_colour","palette_start","palette_range","hue","lightness","min","dot","setHSL","render","click","traverse","child","isMesh","model","temp","updateCamera","autoRotate","molecule","pop","forEach","mesh","new_mesh","id","params","f","m","updateSets","setUserColour","r","g","toggle","setData","clippingIntersections","getRender_Object_number","innerHeight","innerWidth","setSize","PerspectiveCamera","OrthographicCamera","OrbitControls","domElement","target","aspect","left","right","updateProjectionMatrix","update","warning","updatePosition","genFoldedPositionFromUnfold","passAxes","toggleAxes","toggleMulticolour","boundingShapeEnabled","genBoundingShape","localClippingEnabled","setBackFace","Plane","PlaneHelper","visible","updateSlicers","Promise","resolve","reject","fileHandle","lst","showOpenFilePicker","multiple","getFile","file","style","step","updateCameraZoom","updateLightPosition","deleteAllMeshes","testMaterial","testShape","testTotal","testLimit","testGeo","InstancedMesh1","InstancedMesh","InstancedMesh2","InstancedMesh3","matrix","Matrix4","rotation","setMatrixAt","setColorAt","componentToHex","Scene","ParameterSet","props","titles","title","numerical","positive","styling","ParameterInput","active","selectingSet","changeValue","bind","InputBox","defaultVal","InputNumber","defaultValue","onChange","act","listItems","localeCompare","Dropdown","Item","eventKey","onSelect","panel","ButtonToolbar","marginLeft","Row","marginTop","Col","md","React","Component","SliceSlider","useState","setValue","InputGroup","nextValue","parseFloat","Addon","RangeSlider","progress","CustomSlider","disabled","boundaries","Slider","marginBottom","ExportDropdown","dimensions","resolution","setResolution","setDimensions","export","trigger","placement","icon","Icon","marginRight","Button","appearance","onClick","LibraryDropdown","state","toggler","Menu","PerformanceDropdown","updateVal","setState","Form","layout","FormGroup","ControlLabel","Whisper","speaker","Tooltip","graduated","updateLOD","GeneralMenu","continuousRender","requestAnimationFrame","functions","fps","showDrawer","numOfRender","updateFPS","toggleDrawer","toggleAutorotate","runPerformanceTest","autorotate","closeSidemenu","initTesting","testing","toFixed","Header","Navbar","Body","Nav","pullRight","spin","display","className","accept","files","htmlFor","padding","Drawer","show","onHide","backdrop","Title","href","rel","margin","TITLE_LEFT_MARGIN","dividerStyle","submenuParameterSetStyling","ModelsOptions","View","selectShape","selectSet","updateParameter","toggleWireframe","toggleColour","updateUserColour","configurations","colourFromDirector","toggleUserColour","displayAsWireframe","parameter","globalState","configs","updateShape","reset","configState","Divider","Checkbox","checked","VideoOptions","reference","setfps","UploadFiles","RealTimeVideo","VideoToggle","setVideoState","filename","setFileName","uploaded","runAfterUpload","uploadConfig","then","notifyFinishUpload","vidstate","loadVideoState","video","retrieveVideoSample","max_iter","capturer","ccapture","format","framerate","quality","vidState","capture","save","blob","url","URL","createObjectURL","link","document","createElement","download","body","appendChild","removeChild","upload","Grid","fluid","Input","placeholder","CameraOptions","selectType","updateLookat","updateZoom","updateState","updateCameraPosition","updateLookAt","controlId","RadioGroup","Radio","JSON","stringify","SlicingOptions","slicing","toggleSlicer","toggleHelperX","toggleHelperY","toggleHelperZ","updateHelpers","updateSlicer","slicing_enabled","enableClipping","helpers","toggleHelper","ty","AdditionalLightsNav","activeKey","justified","AdditionalLightOptions","pointLight","handleSelect","toggleLightEnabled","directionalLight","toggleLightHelper","updateLight","lightState","AmbientLightOptions","ambientLight","updateBg","ambientLightColour","darkBackGround","backgroundColour","ReferenceOptions","toggleFold","toggleBoundingShapeEnabled","update_repeats","toggle_axes_enabled","toggle_axes_colour","displayFoldState","toggleFoldState","updateBoundingShape","activeShape","toggleAxesMulticolour","showAxes","repeats","NavToggle","expand","IconButton","circle","textAlign","navItemStyle","sidebarHeight","CustomNav","backgroundColor","MenuContent","menuContent","VisualisationMenu","handleToggle","toggleSidebar","Sidebar","flexDirection","collapsible","Container","vertical","Content","io","chrono","ModelDefaultState","SlicingDefaultState","ConfigurationDefaultState","CameraDefaultState","PointLightDefaultState","DirectionalLightDefaultState","ReferenceDefaultState","AmbientLightDefaultState","expanded","header","sidebar","vid","loadLightingAndCamera","loadReferenceAndSlicing","loadModel","substate","xor","directionalLightColour","parse","pointLightColour","init","loadState","Controller","ExternalToggle","Chronometer","externalToggle","logPerformance","rawPerformanceData","counter","tick","avgPerformanceData","mean","stdPerformanceData","std","addRandomParticles","frames","prevTime","Date","now","time","sample2","addListeners","Blob","navigator","msSaveOrOpenBlob","setTimeout","revokeObjectURL","getData","view","saveVideoState","starting","genSets","setDefaultState","load","VIDEO","fileReader","FileReader","onloadend","split","toLowerCase","qmga_to_json","cnf_to_json","success","readAsText","loadSample","sample","sample1","sample3","sample4","sample5","sample6","sample7","sample8","sample9","sample10","sample11","sample12","sample13","sample14","sample15","unfolded_sample1","unfolded_sample2","dataURL","toDataURL","getHeader","getSidebar","getDomElement","addEventListener","overflow","onkeydown","code","config","duration","description","Notification","split_data","trim","unit_box","molecule_count","molecule_number","molecule_data","App","controller","mount","ref","ReactDOM","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.80498ba1.chunk.js","sourcesContent":["import {BufferAttribute, BufferGeometry} from 'three';\nimport {BufferGeometryUtils} from 'three/examples/jsm/utils/BufferGeometryUtils';\nimport * as math from \"mathjs\";\n\nfunction linspace(start: number, stop: number, number: number): number[] {\n    let increment: number = (stop - start) / (number - 1)\n    let values: number[] = []\n    for (let i: number = 0; i < number; ++i) {\n        values.push(start + i * increment)\n    }\n    return values\n}\n\nfunction logspace(start: number, stop: number, number: number, base: number): number[] {\n    return linspace(start, stop, number).map(value => base ** value)\n}\n\nexport class Shape {\n\n    //complexity attributes\n    LOD;\n    static default_lod: number = 5\n    static complexity_count: number = 10\n    static complexity: number[] = math.multiply(math.round(math.divide(logspace(3, 7, Shape.complexity_count, 2), 2)), 2);\n\n    //shape model attributes\n    parameters;\n\n    //graphics components\n    stripGeometry?: BufferGeometry;\n\n    constructor() {\n        this.parameters = arguments[0];\n        this.LOD = Shape.default_lod;\n        this.stripGeometry = undefined;\n    }\n\n    set_lod(lod: number) {\n        this.LOD = lod\n    }\n\n    roll_vertices(vertices: number[][][], offset: boolean = false) {\n        for (let i = 0; i < vertices.length; ++i) {\n            let cut = math.ceil((i + (offset ? 1 : 0)) / 2)\n            vertices[i] = this.roll_row(vertices[i], cut)\n        }\n        return vertices\n    }\n\n    roll_row(vertices: number[][], cut: number) {\n        return vertices.slice(-cut).concat(vertices.slice(0, -cut))\n    }\n\n    reverse_vertices(section: number[][][]): number[][][] {\n        return section.map((row, row_index) => row.slice(-row_index).concat(row.slice(0, -row_index)))\n    }\n}\n\nexport class Sphere extends Shape {\n    radius: number\n    samples: number = Sphere.complexity[this.LOD]\n    vertical_samples: number = this.samples\n    vertical_sample_scale: number\n\n    constructor(radius: number, vertical_sample_scale: number = 1) {\n        super();\n        this.radius = radius\n        this.vertical_sample_scale = vertical_sample_scale\n        this.update_samples()\n    }\n\n    update_samples(): void {\n        this.samples = Math.max(4, Sphere.complexity[this.LOD])\n        this.vertical_samples = Math.max(4, this.samples * this.vertical_sample_scale)\n        if (this.vertical_samples % 2 == 1) {\n            ++this.vertical_samples\n        }\n    }\n\n    set_lod(lod: number) {\n        super.set_lod(lod);\n        this.update_samples();\n    }\n\n    generate(): void {\n        this.update_samples();\n        this.genGeometries();\n    }\n\n    sample_sphere(radius: number, theta: number, phi: number): number[] {\n        let sin_phi: number = Math.sin(phi);\n        return math.multiply(radius, [sin_phi * Math.cos(theta), sin_phi * Math.sin(theta), Math.cos(phi)])\n    }\n\n    spherical_vertices(radius: number, thetas: math.MathArray, phis: math.MathArray, samples: number): number[][] {\n        let offset_thetas: math.MathType = math.add(thetas, math.divide(Math.PI, samples))\n        let result = []\n        for (let [phi_index, phi] of phis.entries()) {\n            let abc = []\n            for (let theta of ((phi_index % 2 == 0) ? thetas : offset_thetas)) {\n                abc.push(this.sample_sphere(radius, theta, phi))\n            }\n            result.push(abc)\n        }\n        return result\n    }\n\n    build_quarters(vertices: number[][][]): math.MathType {\n        return math.concat(vertices, vertices.map(vertex_row => vertex_row.map(vertex => [-vertex[0], -vertex[1], vertex[2]])), 1)\n    }\n\n    quarter_thetas(samples: number): number[] {\n        return linspace(0, Math.PI, Math.floor(samples / 2) + 1).slice(0, -1)\n    }\n\n    quarter_sphere_vertices(radius: number, samples: number, phi_offset: number, vertical_samples: number = samples): math.MathArray {\n        let phis: number[] = linspace(0, Math.PI / 2, Math.floor(vertical_samples / 2) - phi_offset)\n        return this.spherical_vertices(radius, this.quarter_thetas(samples), phis, samples)\n    }\n\n    build_halves(vertices: number[][][]): math.MathType {\n        return math.concat(vertices, this.bottom_half(vertices), 0)\n    }\n\n    bottom_half(vertices: math.MathArray): math.MathArray {\n        //Initially I used .reverse which broke stuff as it's in-place\n        let rolled_vertices = []\n        let roll_offset = math.floor(vertices[0].length / 2)\n        for (let vertex_row of vertices) {\n            rolled_vertices.push(vertex_row.slice(roll_offset).concat(vertex_row.slice(0, roll_offset)))\n        }\n        return math.multiply(rolled_vertices.toReversed(), -1).slice(1)\n    }\n\n    half_sphere_vertices(radius: number, samples: number, vertical_samples: number = samples): math.MathType {\n        return this.build_quarters(this.quarter_sphere_vertices(radius, samples, 0, vertical_samples))\n    }\n\n    generate_vertices(): number[][][][] {\n        return [this.roll_vertices(this.build_halves(this.half_sphere_vertices(this.radius, this.samples, this.vertical_samples)))]\n    }\n\n    to_triangles(vertices: number[][][]) {\n        let positions: number[] = []\n        for (let row = 0; row < vertices.length; ++row) {\n            for (let row_column = 0; row_column < vertices[row].length; ++row_column) {\n                if (row > 0) {\n                    positions = positions.concat(vertices[row][row_column])\n                    positions = positions.concat(vertices[row][(row_column + 1) % vertices[row].length])\n                    positions = positions.concat(vertices[row - 1][(row_column) % vertices[row - 1].length])\n                }\n                //\n                if (row < vertices.length - 1) {\n                    positions = positions.concat(vertices[row][row_column])\n                    positions = positions.concat(vertices[row + 1][(row_column + 1) % vertices[row + 1].length])\n                    positions = positions.concat(vertices[row][(row_column + 1) % vertices[row].length])\n                }\n            }\n        }\n        return positions\n    }\n\n    geometry_from_vertices(vertices: number[][][], position_components: number): BufferGeometry {\n        let positions: number[] = this.to_triangles(vertices)\n        let geometry: BufferGeometry = new BufferGeometry();\n        geometry.setAttribute('position', new BufferAttribute(new Float32Array(positions), position_components));\n        geometry = BufferGeometryUtils.mergeVertices(geometry)\n        geometry.computeVertexNormals();\n        geometry.normalizeNormals();\n        return geometry\n    }\n\n    genGeometriesBase(position_components: number): BufferGeometry {\n        let sub_geometries = this.generate_vertices().map(sub_vertices => this.geometry_from_vertices(sub_vertices, position_components))\n        let a = BufferGeometryUtils.mergeBufferGeometries(sub_geometries);\n        console.log(\"a\",a)\n        return BufferGeometryUtils.mergeBufferGeometries(sub_geometries)\n    }\n\n    genGeometries(): void {\n        const positionNumComponents: number = 3;\n        this.stripGeometry = this.genGeometriesBase(positionNumComponents)\n    }\n\n    connect_halves(top: number[][], bottom: number[][], radius: number) {\n        let offset = Math.acos(bottom[0][0] / radius)\n        let new_row = linspace(0 + offset, Math.PI * 2 + offset, top.length + 1).slice(0, -1).map(angle => this.sample_sphere(radius, angle, Math.PI / 2))\n        return [bottom, new_row, top]\n    }\n}\n\n//Spherocylinder mesh generator\nexport class Spherocylinder extends Sphere {\n    //Scaling vector (either side of centre) to stretch sphere into spherocylinder ([0, 0, length / 2])\n    length_scaling_vector: number[];\n\n    constructor(radius: number, length: number) {\n        //Derive from origin centred sphere of chosen radius\n        super(radius);\n        this.length_scaling_vector = [0, 0, length / 2];\n    }\n\n    // //Samples from spherocylinder instead of sphere\n    // sample_sphere(radius: number, theta: number, phi: number): number[] {\n    //     let sphere_coordinate: number[] = super.sample_sphere(radius, theta, phi);\n    //     //Stretch point in z direction by scale vector, matching stretch direction to sign of original vertex z\n    //     return sphere_coordinate[2] >= 0 ? math.add(sphere_coordinate, this.length_scaling_vector) : math.subtract(sphere_coordinate, this.length_scaling_vector);\n    // }\n    generate_vertices(): number[][][][] {\n        let sphere = super.generate_vertices()[0];\n        let top = sphere.slice(0, Math.ceil(sphere.length / 2)).map(row => row.map(vertex => math.add(vertex, this.length_scaling_vector)))\n        let bottom = sphere.slice(Math.floor(sphere.length / 2)).map(row => row.map(vertex => math.subtract(vertex, this.length_scaling_vector)))\n        let connector = this.connect_halves(this.roll_row(bottom[0], bottom[0].length / 2), this.roll_row(top[top.length - 1], top[top.length - 1].length / 2), this.radius)\n        return [top, connector, bottom]\n    }\n}\n\nexport class Spheroplatelet extends Sphere {\n    circle_radius: number\n\n    constructor(radius: number, circle_radius: number) {\n        super(radius);\n        this.circle_radius = circle_radius\n    }\n\n    generate_vertices(): math.MathType {\n        let vertices = super.generate_vertices()[0]\n        let row_count = math.size(vertices)[0]\n        let column_count = math.size(vertices)[1]\n        let top = [vertices[0].map(column => column.map(vertex => vertex))]\n        let bottom = [vertices[row_count - 1].map(column => column.map(vertex => vertex))]\n        let circle_angles = linspace(0, 2 * Math.PI, column_count + 1).slice(0, -1)\n        for (let row = 0; row < row_count; ++row) {\n            for (let column = 0; column < column_count; ++column) {\n                let radius_vector = vertices[row][column].slice(0, 2)\n                let norm = math.norm(radius_vector)\n                if (row == 0 || row == row_count - 1) {\n                    let face_circle_angles = circle_angles\n                    if (row == row_count - 1) {\n                        let offset = math.floor(row / 2) + 2\n                        face_circle_angles = circle_angles.slice(offset).concat(circle_angles.slice(0, offset))\n                    }\n                    let x = face_circle_angles[column]\n                    radius_vector = [math.cos(x), math.sin(x)]\n                    norm = 1\n                }\n                let normalised_radius_vector = math.multiply(this.circle_radius, math.divide(radius_vector, norm))\n                vertices[row][column][0] += normalised_radius_vector[0]\n                vertices[row][column][1] += normalised_radius_vector[1]\n            }\n        }\n        return [top.concat(vertices.slice(0, 1)), vertices, vertices.slice(-1).concat(bottom)]\n    }\n}\n\n//Ellipsoid mesh generator\nexport class Ellipsoid extends Sphere {\n    //Scale factor in [x, y, z] directions\n    scale: number[];\n\n    constructor(x: number, y: number, z: number) {\n        //Derive from origin centred sphere of radius 1\n        super(1);\n        this.scale = [x, y, z];\n    }\n\n    //Samples from ellipsoid instead of sphere\n    sample_sphere(radius: number, theta: number, phi: number): number[] {\n        //Multiply origin centred sphere coordinates by scale vector\n        return math.dotMultiply(super.sample_sphere(radius, theta, phi), this.scale);\n    }\n}\n\nexport class CapCutSphereBase extends Sphere {\n    cut_radius: number\n\n    constructor(radius: number, cut_radius: number, vertical_sample_scale: number = 1, z_cut: boolean = true) {\n        super(radius, vertical_sample_scale);\n        this.cut_radius = z_cut ? math.sqrt(math.square(radius) - math.square(cut_radius)) : cut_radius\n    }\n\n    base(phis: number[], flat_top: boolean) {\n        let vertices = this.roll_vertices(this.build_quarters(this.spherical_vertices(this.radius, this.quarter_thetas(this.samples), phis, this.samples)))\n        let end_source_index = flat_top ? 0 : vertices.length - 1\n        let xs = vertices[end_source_index].map(vertex => vertex[0])\n        let ys = vertices[end_source_index].map(vertex => vertex[1])\n        let zs = vertices[end_source_index].map(vertex => vertex[2])\n        let end = [new Array(math.size(vertices)[1]).fill([math.mean(xs), math.mean(ys), math.mean(zs)])]\n        return [vertices, flat_top ? end.concat(vertices.slice(0, 1)) : vertices.slice(-1).concat(end)]\n    }\n}\n\nexport class CutSphere extends CapCutSphereBase {\n    generate_vertices() {\n        let phis = linspace(math.asin(this.cut_radius / this.radius), Math.PI, this.vertical_samples - 1)\n        return super.base(phis, true)\n    }\n}\n\nexport class DoubleCutSphere extends CapCutSphereBase {\n    generate_vertices() {\n        let angle_cut = math.asin(this.cut_radius / this.radius)\n        let phis = linspace(angle_cut, Math.PI - angle_cut, this.vertical_samples - 2)\n        let partial_vertices = super.base(phis, true)\n        let index = partial_vertices[0].length - 1\n        let xs = partial_vertices[0][index].map(vertex => vertex[0])\n        let ys = partial_vertices[0][index].map(vertex => vertex[1])\n        let zs = partial_vertices[0][index].map(vertex => vertex[2])\n        let end = [new Array(math.size(partial_vertices[0])[1]).fill([math.mean(xs), math.mean(ys), math.mean(zs)])]\n        partial_vertices.push(end.concat([partial_vertices[0][index].toReversed()]))\n        return partial_vertices\n    }\n}\n\nexport class Cap extends CapCutSphereBase {\n    generate_vertices() {\n        let phis = linspace(0, math.asin(this.cut_radius / this.radius), this.vertical_samples - 1)\n        return super.base(phis, false)\n    }\n}\n\nexport class BaseLens extends Sphere {\n    radius_2: number\n    angle: number\n    cut_radius: number\n\n    constructor(radius: number, radius_2: number, angle: number) {\n        super(radius);\n        this.radius_2 = radius_2\n        this.angle = Math.PI - angle\n        this.cut_radius = this.radius * Math.sin(this.angle)\n    }\n\n    generate_vertices(): math.MathType {\n        if (this.angle == 0) {\n            return super.generate_vertices()\n        }\n        let cut_radius = this.cut_radius\n        let top_proportion = 0.5\n        let bottom_proportion = 0.5\n        let top_shape = new Cap(this.radius_2, cut_radius, top_proportion, false)\n        let bottom_cap = this.angle > Math.PI / 2\n        let bottom_shape = bottom_cap ? new Cap(this.radius, cut_radius, bottom_proportion, false) : new CutSphere(this.radius, cut_radius, bottom_proportion, false)\n        top_shape.set_lod(this.LOD)\n        bottom_shape.set_lod(this.LOD)\n        let top = math.multiply(top_shape.generate_vertices()[0], -1)\n        let bottom = bottom_shape.generate_vertices()[0]\n        if (bottom_cap) {\n            bottom.reverse()\n            for (let row = 0; row < math.size(bottom)[0]; ++row) {\n                bottom[row].reverse()\n                for (let column = 0; column < math.size(bottom)[1]; ++column) {\n                    bottom[row][column][1] *= -1\n                    bottom[row][column][2] *= -1\n                }\n            }\n        }\n        let pole_offset = bottom[bottom.length - 1][0][2]\n        bottom = this.reverse_vertices(bottom.map(row => row.map(vertex => math.multiply(math.subtract(vertex, [0, 0, pole_offset]), -1))).reverse())\n        let distance = bottom[bottom.length - 1][0][2] + top[top.length - 1][0][2]\n        top = this.reverse_vertices(top.map(row => row.map(vertex => math.add(math.multiply(vertex, -1), [0, 0, distance]))).reverse())\n        return [top, bottom]\n    }\n}\n\nexport class ThickLens extends BaseLens {\n    constructor(radius: number, thickness: number, angle: number) {\n        let cos_theta = Math.cos(Math.PI - angle)\n        let radius_2 = (2 * radius ** 2 * cos_theta + 2 * radius ** 2 - 2 * radius * thickness * cos_theta - 2 * radius * thickness + thickness ** 2) / (2 * (radius * cos_theta + radius - thickness))\n        super(radius, radius_2, angle);\n    }\n}\n\nexport class Lens extends BaseLens {\n    constructor(radius: number, angle: number) {\n        super(radius, radius, angle);\n    }\n}\n\nexport class RadiusOnlyLens extends BaseLens {\n    constructor(radius: number) {\n        let angle = Math.acos(1 - 1 / (2 * Math.PI * radius ** 2));\n        super(radius / 2, radius / 2, angle);\n    }\n}\n\nexport class BiconvexLens extends BaseLens {\n    constructor(radius: number, angle: number, separation: number) {\n        super(radius, -radius, angle);\n        this.separation = separation;\n    }\n\n    generate_vertices(): math.MathType {\n        let shape_halves = super.generate_vertices();\n        let offset = -(shape_halves[0][shape_halves[0].length - 1][0][2] + shape_halves[1][0][0][2]) / 2;\n        shape_halves = shape_halves.map(part => part.map(row => row.map(item => math.add(item, [0, 0, offset]))));\n        shape_halves[0] = shape_halves[0].map(row => row.map(item => math.subtract(item, [0, 0, this.separation / 2])));\n        shape_halves[1] = shape_halves[1].map(row => row.map(item => math.add(item, [0, 0, this.separation / 2])));\n        let side_top_row = this.roll_row(shape_halves[0][0], shape_halves[0][0].length / 2 - 1);\n        let side_bottom_row = shape_halves[1][shape_halves[1].length - 1];\n        shape_halves.push(this.connect_halves(side_top_row, side_bottom_row, this.cut_radius))\n        return shape_halves;\n    }\n}","import {Alert} from 'rsuite';\nimport {AmbientLight, DirectionalLight, DirectionalLightHelper, Light, PointLight, PointLightHelper} from 'three';\n\nenum LightTypes {\n    AMBIENT = 0,\n    DIRECTIONAL,\n    POINT\n}\n\nexport class LightNew {\n    static light_types = LightTypes;\n    light: Light;\n    helper: DirectionalLightHelper | PointLightHelper | undefined;\n\n    constructor(lightType: LightTypes) {\n        this.light = this.setLight(lightType);\n        this.helper = this.setHelper();\n    }\n\n    setLight(lightType: LightTypes) {\n        let light;\n        switch (lightType) {\n            case LightTypes.AMBIENT:\n                light = new AmbientLight(\"#ffffff\", 0.4);\n                break;\n            case LightTypes.DIRECTIONAL:\n                light = new DirectionalLight(\"#ffffff\", 0.5);\n                light.position.set(-5, 0, -5);\n                break;\n            case LightTypes.POINT:\n                light = new PointLight(\"#ffffff\", 0.6);\n                light.position.set(5, 0, 5);\n                break;\n            default:\n                Alert.error(\"Error: null light type selected\");\n                throw RangeError;\n        }\n        return light\n    }\n\n    setHelper() {\n        let helper;\n        if (this.light instanceof DirectionalLight) {\n            helper = new DirectionalLightHelper(this.light, 10);\n        }\n        if (this.light instanceof PointLight) {\n            helper = new PointLightHelper(this.light, 10);\n        }\n        return helper;\n    }\n\n    updatePosition(x: number, y: number, z: number) {\n        this.light.position.set(x, y, z);\n    }\n\n    updateColour(c: string, i: number) {\n        this.light.color.setHex(parseInt(c.substring(1), 16));\n        this.light.intensity = i * 0.01;\n    }\n}\n\nexport default LightNew;","export var Parameters = {\n    Ellipsoid: {\n        names: ['X', 'Y', 'Z'], vals: [1.0, 1.0, 0.2]\n    }, Spherocylinder: {\n        names: ['Radius', 'Length'], vals: [0.5, 0.7]\n    }, Spheroplatelet: {\n        names: ['RadSphere', 'RadCircle'], vals: [0.3, 0.2]\n    }, CutSphere: {\n        names: ['Radius', 'zCut'], vals: [0.8, 0.7]\n    }, Sphere: {\n        names: ['Radius'], vals: [0.6]\n    }, Cap: {\n        names: ['Radius', 'zCut'], vals: [0.8, 0.7]\n    }, Lens: {\n        names: ['Radius', 'Angle'], vals: [1, 0.7]\n    }, ThickLens: {\n        names: ['Radius', 'Thickness', 'Angle'], vals: [1, 0, 0.7]\n    }, RadiusOnlyLens: {\n        names: ['Radius'], vals: [0.5]\n    }, BiconvexLens: {\n        names: ['Radius', 'Angle', \"Separation\"], vals: [1, 0.7, 0]\n    }, DoubleCutSphere: {\n        names: ['Radius', 'zCut'], vals: [0.8, 0.7]\n\n    }\n}\n\nexport default Parameters;","import * as THREE from 'three';\nimport {Color, Euler, LOD, MeshPhongMaterial, Quaternion, Vector3} from 'three';\nimport {eigs} from 'mathjs';\nimport * as SHAPE from './Shapes';\nimport {Shape} from './Shapes';\nimport Model from './Model';\nimport Parameters from './Parameters';\nimport {Alert} from 'rsuite';\nimport colourMap from './ColourMap.json';\n\nexport class Set {\n    name;\n    shapeType;\n    parameters;\n    shape;\n    orientationType;\n    wireframe;\n    userColour;\n    colourByDirector;\n    lod;\n    clippingPlanes;\n    clipIntersection;\n    unitBox;\n\n\n    positions = [];\n    Folded_position = []\n    orientations = [];\n    elements = [];\n    meshes = [];\n// materials =[];\n    Element = class Element {\n        geometries;\n        orientation;\n        position;\n        colourIndex;\n        euler;\n        quaternion;\n\n        constructor(p, q) {\n            this.position = p;\n            this.orientation = this.quaternionToUnitVector(q);\n            this.euler = new Euler();\n            this.euler.setFromQuaternion(q);\n            this.colourIndex = 0;\n            this.quaternion = q\n        }\n\n        quaternionToUnitVector(q) {\n            let a = (2 * (q.w * q.y + q.x * q.z));\n            let b = (2 * (-q.w * q.x + q.y * q.z));\n            let c = (1 - 2 * (q.x ** 2 + q.y ** 2));\n            return [a, b, c];\n        }\n\n        setColourIndex(i) {\n            this.colourIndex = i;\n        }\n\n        setGeometries(geoms) {\n            this.geometries = geoms;\n        }\n\n    }\n\n    constructor(data, cp, ci) {\n        this.name = data.name;\n        this.orientationType = data.orientationType;\n        this.positions = data.positions;\n        this.orientations = data.orientations;\n        this.unitBox = data.unitBox;\n        this.clippingPlanes = cp;\n        this.clipIntersection = ci;\n        this.setDefaults();\n\n        if (data.shapeType != null) {\n            this.shapeType = data.shapeType;\n        }\n        if (data.parameters != null) {\n            this.shapeType = data.parameters;\n        }\n        if (this.name === null) {\n            this.name = this.shapeType;\n        }\n        this.genSet();\n    }\n\n    static getParameters(val) {\n        let parameters;\n\n        switch (val) {\n            case 'Ellipsoid':\n                parameters = Parameters.Ellipsoid;\n                break;\n            case 'Spherocylinder':\n                parameters = Parameters.Spherocylinder;\n                break;\n            case 'Spheroplatelet':\n                parameters = Parameters.Spheroplatelet;\n                break;\n            case 'Cut Sphere':\n                parameters = Parameters.CutSphere;\n                break;\n            case 'Sphere':\n                parameters = Parameters.Sphere;\n                break;\n            case 'Cap':\n                parameters = Parameters.Cap;\n                break;\n            case 'Lens':\n                parameters = Parameters.ThickLens;\n                break;\n            case 'Cinacchi Lens':\n                parameters = Parameters.RadiusOnlyLens;\n                break;\n            case 'Biconvex Lens':\n                parameters = Parameters.BiconvexLens;\n                break;\n            case 'Double Cut Sphere':\n                parameters = Parameters.DoubleCutSphere;\n                break;\n            default:\n                Alert.error('Error: Unexpected shape identifier');\n        }\n\n        return parameters;\n    }\n\n    isFoldedTest() {\n        let x = this.unitBox[0] / 2;\n        let y = this.unitBox[1] / 2;\n        let z = this.unitBox[2] / 2;\n\n        for (let i = 0; i < this.positions.length; i++) {\n            let a = this.positions[i][0];\n            let b = this.positions[i][1];\n            let c = this.positions[i][2];\n            if (a >= x || a <= -x) {\n                return false\n            }\n            if (b >= y || b <= -y) {\n                return false\n            }\n            if (c >= z || c <= -z) {\n                return false\n            }\n\n        }\n        return true;\n    }\n\n    genSet() {\n        this.validateData();\n        this.genElements();\n        this.genMeshes();\n        // this.genListBoundingBox();\n    }\n\n    validateData() {\n        if (this.positions.length !== this.orientations.length) {\n            throw new Error('Error: Position data does not correspond to orientation data. \\n Total positions: ' + this.positions.length + '\\n Total rotations: ' + this.orientations.length);\n        }\n\n        for (let p in this.parameters) {\n            if (p < 0) {\n                throw new Error('Error: Invalid parameter ' + p.toString() + ' for ' + this.name + '\\n Must be positive.');\n            }\n        }\n\n        let defaultParameters = Set.getParameters(this.shapeType);\n        if (this.parameters.length !== defaultParameters.vals.length) {\n            throw new Error('Error: Wrong number of parameters specified for ' + this.name + '. \\n Required: ' + defaultParameters.names);\n        }\n    }\n\n    setDefaults() {\n        this.userColour = new Color(\"#FFFFFF\");\n        this.colourByDirector = true;\n        this.wireframe = true;\n        this.renderBackFace = false;\n        this.lod = Shape.default_lod;\n        this.shapeType = 'Ellipsoid';\n        this.parameters = Parameters.Ellipsoid.vals;\n    }\n\n    updateSlicers(i, vals) {\n        this.clippingPlanes[2 * i + 1].constant = vals[1];\n        this.clippingPlanes[2 * i].constant = -vals[0];\n    }\n\n    genUnitBox() {\n        // This is the user input unit box of whole\n        return this.unitBox;\n\n    }\n\n    genUnfoldPosition() {\n        // Place holder function to generate Psedo unfolded configuration\n        if (this.isFoldedTest() === false) {\n            Alert.info('Model is already unfolded');\n            return\n        }\n        let pos = [];\n        let x = this.unitBox[0];\n        let y = this.unitBox[1];\n        let z = this.unitBox[2];\n\n        for (let i = 0; i < this.positions.length; i++) {\n            let rnd1 = (Math.random() * (2) - 1)\n            let rnd2 = (Math.random() * (2) - 1)\n            let rnd3 = (Math.random() * (2) - 1)\n            pos.push([this.positions[i][0] + rnd1 * x, this.positions[i][1] + rnd2 * y, this.positions[i][2] + rnd3 * z])\n        }\n        this.positions = pos;\n\n    }\n\n    genFoldedPositionFromUnfold() {\n        if (this.isFoldedTest() === true) {\n            Alert.info('Model is already folded');\n            return\n        }\n        let pos = [];\n        let lx = this.unitBox[0];\n        let ly = this.unitBox[1];\n        let lz = this.unitBox[2];\n\n        for (let i = 0; i < this.positions.length; i++) {\n            let rx = this.positions[i][0];\n            let ry = this.positions[i][1];\n            let rz = this.positions[i][2];\n\n            rx = rx - lx * Math.round(rx / lx);\n            ry = ry - ly * Math.round(ry / ly);\n            rz = rz - lz * Math.round(rz / lz);\n\n            pos.push([rx, ry, rz])\n        }\n        this.Folded_position = pos;\n\n    }\n\n    setBackFace(bool) {\n        this.renderBackFace = bool;\n    }\n\n    genMeshes() {\n        let num = this.elements.length;\n\n        let c = '#FFFFFF'\n        let geometry_distances = [0, 0.05, 0.1, 0.2]\n        let geometries = geometry_distances.map((distance, distance_index) => this.new_gen_geometries(Math.max(0, this.lod - distance_index)))\n        for (let i = 0; i < num; i++) {\n            if (this.colourByDirector) {\n                let rgb = colourMap.values[this.elements[i].colourIndex];\n                c = new Color(Model.rgbToHex(...rgb));\n            } else {\n                c = this.userColour;\n            }\n            let mat = new MeshPhongMaterial({\n                side: this.renderBackFace ? THREE.DoubleSide : THREE.FrontSide,\n                clipShadows: true,\n                clippingPlanes: this.clippingPlanes,\n                wireframe: this.wireframe,\n                color: c,\n            });\n            let matrix2 = new THREE.Matrix4();\n            const position = new THREE.Vector3();\n            position.x = this.elements[i].position[0];\n            position.y = this.elements[i].position[1];\n            position.z = this.elements[i].position[2];\n            let ori = this.elements[i].quaternion\n            matrix2.compose(position, ori, new THREE.Vector3(0.5, 0.5, 0.5));\n            let meshes = geometries.map(geometry => new THREE.Mesh(geometry, mat))\n            let lod_mesh = new LOD()\n            for (let i = 0; i < meshes.length; ++i) {\n                lod_mesh.addLevel(meshes[i], geometry_distances[i])\n            }\n            lod_mesh.applyMatrix4(matrix2)\n            this.meshes.push(lod_mesh);\n        }\n    }\n\n    genElements() {\n        let pos = this.positions\n        if (this.Folded_position.length > 0) {\n            pos = this.Folded_position;\n        }\n        for (let i = 0; i < pos.length; i++) {\n            this.elements.push(new this.Element(pos[i], this.getRotations(this.orientationType, this.orientations[i])));\n        }\n        this.calculateDirector();\n        for (let elem of this.elements) {\n            elem.setColourIndex(this.calculateColourIndex(elem));\n        }\n    }\n\n    new_gen_geometries(lod) {\n        let shape\n        switch (this.shapeType) {\n            case 'Ellipsoid':\n                shape = new SHAPE.Ellipsoid(...this.parameters);\n                break;\n            case 'Spherocylinder':\n                shape = new SHAPE.Spherocylinder(...this.parameters);\n                break;\n            case 'Spheroplatelet':\n                shape = new SHAPE.Spheroplatelet(...this.parameters);\n                break;\n            case 'Cut Sphere':\n                shape = new SHAPE.CutSphere(...this.parameters);\n                break;\n            case 'Sphere':\n                shape = new SHAPE.Sphere(...this.parameters);\n                break;\n            case 'Cap':\n                shape = new SHAPE.Cap(...this.parameters);\n                break;\n            case 'Lens':\n                shape = new SHAPE.ThickLens(...this.parameters);\n                break;\n            case 'Cinacchi Lens':\n                shape = new SHAPE.RadiusOnlyLens(...this.parameters);\n                break;\n            case 'Biconvex Lens':\n                shape = new SHAPE.BiconvexLens(...this.parameters);\n                break;\n            case 'Double Cut Sphere':\n                shape = new SHAPE.DoubleCutSphere(...this.parameters);\n                break;\n            default:\n                throw new Error('Error: unexpected shape identifier. \\n Found: ' + this.shapeType);\n        }\n        shape.LOD = lod\n        shape.generate();\n        return shape.stripGeometry\n    }\n\n    translate(pos, geoms) {\n        for (let g of geoms) {\n            g.translate(2 * pos[0], 2 * pos[1], 2 * pos[2]);\n        }\n    }\n\n    getRotations(type, rot) {\n        let q = new Quaternion();\n        switch (type) {\n            case 'v':\n                let orientationVector = new Vector3(rot[0], rot[1], rot[2])\n                orientationVector.normalize();\n                q.setFromUnitVectors(new Vector3(0, 0, 1), orientationVector);\n                break;\n            case 'q':\n                q.set(rot[1], rot[2], rot[3], rot[0]);\n                break;\n            case 'a':\n                q.setFromAxisAngle(new Vector3(rot[0], rot[1], rot[2]), rot[3]);\n                break;\n            case 'e':\n                let e = new Euler();\n                e.fromArray(rot);\n                q.setFromEuler(e)\n                break;\n            default:\n                throw new Error('Error: Unexpected rotation type value. \\n Found: ' + type + '\\n Expected: v | q | a | e');\n        }\n\n        q.normalize();\n\n        return q;\n\n    }\n\n    calculateDirector() {\n        let n = this.elements.length;\n\n        if (this.elements.length === 0) {\n            Alert.error('Error: No elements in set, director calculation failed.');\n            return;\n        }\n\n        let orderTensor = [[0, 0, 0], [0, 0, 0], [0, 0, 0]];\n        //let eigenvectorsInColumns = new Matrix3();\n\n        let factor = 3 / (2 * n);\n        let constant = 0.5;\n\n        let orientation;\n\n        // loop over all molecules and calculate order tensor\n        for (let i = 0; i < n; ++i) {\n            orientation = this.elements[i].orientation;\n            orderTensor[0][0] += orientation[0] ** 2;\n            orderTensor[0][1] += orientation[0] * orientation[1];\n            orderTensor[0][2] += orientation[0] * orientation[2];\n            orderTensor[1][1] += orientation[1] ** 2;\n            orderTensor[1][2] += orientation[1] * orientation[2];\n            orderTensor[2][2] += orientation[2] ** 2;\n        }\n\n        // multiply each tensor value with \"factor\" and afterwards subtract \"subtract\" from diagonal elements\n        orderTensor[0][0] *= factor;\n        orderTensor[0][0] -= constant;\n        orderTensor[0][1] *= factor;\n        orderTensor[0][2] *= factor;\n        orderTensor[1][1] *= factor;\n        orderTensor[1][1] -= constant;\n        orderTensor[1][2] *= factor;\n        orderTensor[2][2] *= factor;\n        orderTensor[2][2] -= constant;\n\n        // mirror matrix to make it symmetric\n        orderTensor[1][0] = orderTensor[0][1];\n        orderTensor[2][0] = orderTensor[0][2];\n        orderTensor[2][1] = orderTensor[1][2];\n\n        let eigen = eigs(orderTensor);\n\n        //returns index of max eigenvalue\n        //this line of code is a bit dodgy\n        let index = eigen.values.reduce((iMax, x, i, arr) => x > arr[iMax] ? i : iMax, 0);\n\n        this.director = eigen.vectors[index];\n\n        let norm = Math.sqrt(this.director[0] ** 2 + this.director[1] ** 2 + this.director[2] ** 2);\n\n        if (norm === 0 || norm === isNaN || norm === undefined) {\n            this.director = [0, 0, 1];\n        } else {\n            this.director[0] /= norm;\n            this.director[1] /= norm;\n            this.director[2] /= norm;\n        }\n\n        // TEST!\n    }\n\n    calculateColourIndex(element) {\n        let n = colourMap.values.length - 1;\n\n        let scalarProduct = Math.abs(element.orientation[0] * this.director[0] + element.orientation[1] * this.director[1] + element.orientation[2] * this.director[2]);\n        if (this.orientationType === 'v') {\n            scalarProduct = Math.abs(element.orientation[1] * this.director[0] + element.orientation[0] * this.director[1] + element.orientation[2] * this.director[2]);\n        }\n        if (scalarProduct > 1) {\n            scalarProduct = 1;\n        }\n\n        return Math.round(Math.acos(scalarProduct) / Math.PI * 2 * (n));\n\n    }\n\n    setUserColour(hex) {\n        this.userColour = new Color(hex);\n    }\n}\n\nexport default Set;","import {Box3, Box3Helper, BufferGeometry, Color, GridHelper, Line, LineBasicMaterial, Vector3} from 'three';\nimport {Alert} from 'rsuite';\n\nexport class ReferenceTools {\n    subGrid;\n    axes = [];\n    // boundingShape;\n    // boundingShapeType;\n    setsGeometry;\n    size;\n    colour;\n    material;\n    R;\n    G;\n    B;\n    director_colour;\n\n    constructor(s, c) {\n        this.size = s;\n        this.colour = c;\n\n        this.material = new LineBasicMaterial({\n            color: this.colour, linewidth: 3\n        });\n\n        this.multicolour = true;\n        this.genMulticolourAxes(undefined);\n        this.genSubgrid();\n\n        this.R = new Color(\"rgb(255, 0, 0)\");\n        this.G = new Color(\"rgb(0, 255, 0)\");\n        this.B = new Color(\"rgb(0, 0, 255)\");\n        this.director_colour = new Color(\"rgb(255, 0, 255)\");\n\n        this.boundingShapeType = 'box';\n        this.setsGeometry = null;\n\n    }\n\n    genBoundingShape(type, sets) {\n        this.boundingShapeType = type;\n        let b = null;\n        this.boundingShape = null;\n\n        for (let set of sets) {\n            if (b != null) {\n                break\n            }\n            b = set.genUnitBox()\n\n        }\n\n        switch (type) {\n            case 'box':\n                let box = new Box3();\n                box.setFromCenterAndSize(new Vector3(0, 0, 0), new Vector3(b[0], b[1], b[2]));\n                this.boundingShape = new Box3Helper(box, this.colour);\n\n                break;\n            default:\n                Alert.error('Error: Unknown bounding shape identifier');\n\n\n        }\n\n\n        return this.boundingShape;\n\n    }\n\n\n    updateColour(colour, director) {\n        this.colour = colour;\n        this.material = new LineBasicMaterial({\n            color: this.colour, linewidth: 5\n        });\n        if (!this.multicolour) {\n            this.genAxes(director);\n        }\n        this.genSubgrid();\n    }\n\n    genSubgrid() {\n        this.subGrid = new GridHelper(this.size, this.size, this.colour, this.colour);\n    }\n\n    genAxes(director) {\n        console.log(\"director\", director)\n        this.axes = [];\n        let axesSize = this.size / 2;\n        let origin = new Vector3(0, 0, 0);\n        this.axes.push(new Line(new BufferGeometry().setFromPoints([origin, new Vector3(axesSize, 0, 0)]), this.material));\n        this.axes.push(new Line(new BufferGeometry().setFromPoints([origin, new Vector3(0, axesSize, 0)]), this.material));\n        let director_vector = new Vector3(director[0], director[1], -director[2]);\n        this.axes.push(new Line(new BufferGeometry().setFromPoints([origin, director_vector.clone().multiplyScalar(axesSize)]), this.material));\n        this.axes.push(new Line(new BufferGeometry().setFromPoints([origin, new Vector3(0, 0, axesSize)]), this.material));\n    }\n\n    genMulticolourAxes(director) {\n        this.axes = [];\n        let axesSize = this.size / 2;\n        let origin = new Vector3(0, 0, 0);\n        let mat1, mat2, mat3;\n        mat1 = new LineBasicMaterial({\n            color: this.R, linewidth: 5\n        });\n        this.axes.push(new Line(new BufferGeometry().setFromPoints([origin, new Vector3(axesSize, 0, 0)]), mat1));\n        mat2 = this.material = new LineBasicMaterial({\n            color: this.G, linewidth: 5\n        });\n        this.axes.push(new Line(new BufferGeometry().setFromPoints([origin, new Vector3(0, axesSize, 0)]), mat2));\n        mat3 = this.material = new LineBasicMaterial({\n            color: this.B, linewidth: 5\n        });\n        this.axes.push(new Line(new BufferGeometry().setFromPoints([origin, new Vector3(0, 0, axesSize)]), mat3));\n        if (typeof director !== typeof undefined) {\n            let director_vector = new Vector3(director[0], director[1], -director[2]);\n            let mat4 = this.material = new LineBasicMaterial({color: this.director_colour, linewidth: 5});\n            this.axes.push(new Line(new BufferGeometry().setFromPoints([origin, director_vector.clone().multiplyScalar(axesSize)]), mat4));\n        }\n    }\n\n    toggleMulticolour(director) {\n        this.multicolour = !this.multicolour;\n        if (this.multicolour) {\n            this.genMulticolourAxes(director);\n        } else {\n            this.updateColour(this.colour, director);\n            this.genAxes(director);\n        }\n    }\n\n\n}\n\nexport default ReferenceTools;","import {\n    BufferGeometry,\n    Color,\n    Euler,\n    InstancedMesh,\n    Line,\n    LineBasicMaterial,\n    Matrix4,\n    MeshPhongMaterial,\n    Object3D,\n    OrthographicCamera,\n    PerspectiveCamera,\n    Plane,\n    PlaneHelper,\n    Quaternion,\n    Scene,\n    Vector3,\n    WebGLRenderer\n} from 'three';\nimport {OrbitControls} from 'three/examples/jsm/controls/OrbitControls';\nimport Set from './Set'\nimport LightNew from './Light'\nimport ReferenceTools from './ReferenceTools'\nimport {Alert} from 'rsuite'\nimport * as SHAPE from './Shapes';\n\n\nexport class Model extends Scene {\n    sets: Set[] = [];\n\n    scene;\n    camera;\n    lighting;\n    bgColour;\n    controls;\n    lookAt;\n    tools;\n    renderer;\n\n    height;\n    width;\n    axesEnabled = false;\n\n\n    sidebarExpanded = false;\n\n    cameraType = 'perspective';\n    cameraPosition;\n\n    selectedSet;\n    clippingPlanes;\n    clippingHelpers;\n    numOfObject;\n    axes: Line[] = [];\n    axes_enabled: boolean = false;\n    colour_axes: boolean = true;\n    lod: number = SHAPE.Shape.default_lod;\n    repeats_x: number = 0;\n    repeats_y: number = 0;\n    repeats_z: number = 0;\n    molecules: Object3D[] = [];\n\n    constructor(chronometer, notify) {\n        super();\n        this.scene = this;\n        this.chronometer = chronometer;\n        this.setDefault();\n        this.notify = notify;\n\n    }\n\n    onBeforeRender = () => {\n        this.set_axes();\n    };\n\n    /* GENERAL FUNCTIONS */\n\n    static rgbToHex(r, g, b) {\n        function componentToHex(c) {\n            let hex = c.toString(16);\n            return hex.length === 1 ? \"0\" + hex : hex;\n        }\n\n        return \"#\" + componentToHex(r) + componentToHex(g) + componentToHex(b);\n    }\n\n    setDefault() {\n\n        this.renderer = new WebGLRenderer({\n            antialias: false, powerPreference: \"high-performance\", preserveDrawingBuffer: true\n        });\n        this.renderer.setPixelRatio(window.devicePixelRatio);\n        this.rotating = false;\n        this.lightHelperWarningGiven = false;\n        this.selectedSet = 0;\n        this.Video_sample_list = [];\n        this.initClippers();\n        this.lookAt = new Vector3(0, 0, 0);\n        this.updateDimensions();\n        this.setCamera(this.cameraType, true);\n        this.lighting = [new LightNew(LightNew.light_types.AMBIENT), new LightNew(LightNew.light_types.DIRECTIONAL), new LightNew(LightNew.light_types.POINT)];\n\n        this.tools = new ReferenceTools(50, 0xffffff);\n        this.bgColour = \"#000000\";\n        this.renderer.setClearColor(this.bgColour);\n\n        for (let l of this.lighting) {\n            this.scene.add(l.light);\n        }\n        this.scene.add(this.camera);\n        this.lod = SHAPE.Shape.default_lod;\n    }\n\n    set_axes(enabled: boolean = this.axes_enabled, scale: number = 200, camera: PerspectiveCamera | OrthographicCamera = this.camera, sets: Set[] = this.sets, axes_origin: Vector3 = new Vector3(450, -250, 0), scene: Scene = this.scene, colour_axes: boolean = this.colour_axes): void {\n        console.assert(scale > 0)\n        console.log(camera.zoom)\n        //Remove existing lines from scene\n        if (typeof this.axes !== typeof undefined) {\n            for (let axis of this.axes) {\n                scene.remove(axis);\n            }\n        }\n        if (!enabled) {\n            return;\n        }\n        scale /= camera.zoom;\n        axes_origin.divideScalar(camera.zoom);\n        //Construct line parameters\n        let world_axes_origin: Vector3 = camera.localToWorld(axes_origin);\n        let axis_line_ends: Vector3[] = [new Vector3(1, 0, 0), new Vector3(0, 1, 0), new Vector3(0, 0, 1)];\n        let director_line_ends: Vector3[] = sets.map(set => set.director).map(director => new Vector3(director[0], director[1], -director[2]));\n        let line_ends: Vector3[] = axis_line_ends.concat(director_line_ends);\n        //Build line materials\n        let line_materials: LineBasicMaterial[] = line_ends.map(line_end => new LineBasicMaterial({color: this.colour_from_director(line_end, colour_axes)}));\n        //Build line geometries\n        let line_geometries: BufferGeometry[] = line_ends.map(line_end => new BufferGeometry().setFromPoints([world_axes_origin, world_axes_origin.clone().add(line_end.multiplyScalar(scale))]));\n        //Build line objects\n        let axes: Line[] = line_geometries.map((line_geometry, i) => new Line(line_geometry, line_materials[i]));\n        //Add lines to scene\n        for (let axis of axes) {\n            scene.add(axis);\n        }\n        //Store lines\n        this.axes = axes;\n    }\n\n    colour_from_director(vector: Vector3, enable_colour: boolean = true, palette_start: number = 4 * Math.PI / 3, palette_range: number = -2 / 3, sets: Set[] = this.sets): Color {\n        console.assert(0 <= palette_start && palette_start < 2 * Math.PI);\n        console.assert(-1 <= palette_range && palette_range <= 1);\n        console.assert(sets.length > 0);\n        let hue: number = 0;\n        let lightness: number = 1;\n        //Update hue if director present\n        if (enable_colour && sets.length > 0) {\n            //TODO handle multiple directors and director should be stored as vec3 in first place\n            let director: number[] = sets[0].director;\n            let director_vector: Vector3 = new Vector3(director[0], director[1], -director[2]);\n            //Set hue based on angle between director and vector\n            //TODO properly check rather than min\n            let angle: number = Math.acos(Math.min(director_vector.dot(vector.normalize()), 1));\n            console.assert(0 <= angle && angle <= Math.PI);\n            if (angle > Math.PI / 2) {\n                angle = Math.PI - angle;\n            }\n            console.assert(0 <= angle && angle <= Math.PI / 2);\n            hue = (palette_start + (angle * 4) * palette_range) % (2 * Math.PI) / (2 * Math.PI);\n            lightness = 0.5;\n        }\n        console.assert(0 <= hue && hue <= 1);\n        console.assert(0 <= lightness && lightness <= 1);\n        return new Color().setHSL(hue, 1, lightness);\n    }\n\n    update() {\n        console.log('update called');\n        this.renderer.render(this.scene, this.camera);\n        if (!this.rotating) {\n            this.chronometer.click();\n        }\n\n    }\n\n    // occlusionCulling(){\n\n    // const renderer = new WebGLRenderer();\n    // const gl = renderer.getContext();\n    // console.log(gl)\n    // const scene = new Scene();\n    // const mesh1 = new Mesh(new BoxGeometry( 1, 1, 1 ), new MeshBasicMaterial( {color: 0x00ff00}));\n    // const mesh2 = new Mesh(new BoxGeometry( 1, 1, 1 ), new MeshBasicMaterial( {color: 0x00ff00}));\n    // scene.add(mesh1, mesh2);\n    // var query = gl.createQuery();\n    // const camera = this.camera = new PerspectiveCamera(50, this.width / this.height, 0.1, 1000);\n\n    // camera.position.z = 5;\n    // for (let l of this.lighting) {\n    //     scene.add(l.light);}\n    // gl.beginQuery(gl.ANY_SAMPLES_PASSED,query);\n    // renderer.render(scene, camera);\n    // gl.endQuery(gl.ANY_SAMPLES_PASSED,query);\n    // var result = gl.getQueryParameter(query,gl.QUERY_RESULT);\n    // console.log(Number(result));\n    // console.log(result)\n\n    getRender_Object_number() {\n        let num = 0;\n        this.scene.traverse(function (child) {\n            //@ts-ignore\n            if (child.isMesh) {\n                num = num + 1;\n            }\n\n        });\n\n        this.numOfObject = (num - 6);\n        console.log(this.numOfObject)\n    }\n\n    getData() {\n        // To save config to download\n        let model = {};\n        let temp = {};\n        model.sets = [];\n        for (let set of this.sets) {\n            temp.name = set.name;\n            temp.orientationType = set.orientationType;\n            temp.positions = set.positions;\n            temp.orientations = set.orientations;\n            temp.unitBox = set.unitBox;\n            model.sets.push(temp);\n            temp = {};\n        }\n        return model;\n    }\n\n    toggleSidebar() {\n        this.sidebarExpanded = !this.sidebarExpanded;\n        this.updateDimensions();\n        this.updateCamera();\n        console.log(this.sidebarExpanded)\n    }\n\n    toggleAutorotate() {\n        this.controls.autoRotate = !this.controls.autoRotate;\n        this.rotating = !this.rotating;\n    }\n\n    update_repeats(x: number = this.repeats_x, y: number = this.repeats_y, z: number = this.repeats_z) {\n        this.repeats_x = x\n        this.repeats_y = y\n        this.repeats_z = z\n        while (true) {\n            let molecule = this.molecules.pop();\n            if (molecule == undefined) {\n                break;\n            }\n            this.scene.remove(molecule);\n        }\n        this.sets.forEach(set => {\n            set.meshes.forEach(mesh => {\n                for (let x = -this.repeats_x; x < this.repeats_x + 1; ++x) {\n                    for (let y = -this.repeats_y; y < this.repeats_y + 1; ++y) {\n                        for (let z = -this.repeats_z; z < this.repeats_z + 1; ++z) {\n                            let new_mesh: Object3D = mesh.clone();\n                            new_mesh.position.x += set.unitBox[0] * x;\n                            new_mesh.position.y += set.unitBox[1] * y;\n                            new_mesh.position.z += set.unitBox[2] * z;\n                            this.molecules.push(new_mesh);\n                            this.scene.add(new_mesh);\n                        }\n                    }\n                }\n            })\n        });\n    }\n\n    getParameters(val) {\n        return Set.getParameters(val);\n    }\n\n    /* UPDATING SETS FUNCTIONS */\n\n    updateSets(id, params, f) {\n        for (const m of this.sets[id].meshes) {\n            this.scene.remove(m);\n            // m.geometry.dispose();\n            // m.material.dispose();\n            // m.dispose();\n        }\n        f(...params);\n        for (const m of this.sets[id].meshes) {\n            this.scene.add(m);\n        }\n        // let mesh = this.occlusionCulling();\n        // this.scene.add(mesh);\n    }\n\n    updateUserColour(id, colour) {\n        this.updateSets(id, [id, colour], (id, colour) => {\n            this.sets[id].meshes = [];\n            this.sets[id].setUserColour(Model.rgbToHex(colour.r, colour.g, colour.b));\n            this.sets[id].genMeshes();\n        });\n    }\n\n    updateShape(id, shape, parameters) {\n        this.updateSets(id, [id, shape, parameters], (id, shape, parameters) => {\n            this.sets[id].meshes = [];\n            this.sets[id].shapeType = shape;\n            this.sets[id].parameters = parameters.vals;\n            this.sets[id].genMeshes();\n        });\n    }\n\n    toggleWireframe(id, toggle) {\n        this.updateSets(id, [id, toggle], (id, toggle) => {\n            this.sets[id].meshes = [];\n            this.sets[id].wireframe = toggle;\n            this.sets[id].genMeshes();\n        });\n    }\n\n    toggleUserColour(id, toggle) {\n        this.updateSets(id, [id, toggle], (id, toggle) => {\n            this.sets[id].meshes = [];\n            this.sets[id].colourByDirector = toggle;\n            this.sets[id].genMeshes();\n        });\n    }\n\n    genSets(sets) {\n        for (let set of this.sets) {\n            for (const m of set.meshes) {\n                this.scene.remove(m);\n                // m.geometry.dispose();\n                // m.material.dispose();\n                // m.dispose();\n            }\n        }\n        this.sets = [];\n        for (let setData of sets) {\n            this.sets.push(new Set(setData, this.clippingPlanes, this.clippingIntersections));\n        }\n        for (let set of this.sets) {\n            for (const m of set.meshes) {\n                this.scene.add(m);\n            }\n        }\n        this.getRender_Object_number();\n\n    }\n\n    /* LOD FUNCTIONS */\n    updateLOD(val) {\n        this.lod = val;\n        for (let i = 0; i < this.sets.length; i++) {\n            this.updateSets(i, [i, val], (i, val) => {\n                this.sets[i].lod = val;\n                this.sets[i].meshes = [];\n                this.sets[i].genMeshes();\n            });\n        }\n    }\n\n\n    /* CAMERA AND PROJECTION FUNCTIONS */\n\n    updateDimensions() {\n\n        this.height = (window.innerHeight - 56);\n\n        if (this.sidebarExpanded) {\n            this.width = window.innerWidth - 356;\n            console.log('sidebar')\n        } else {\n            this.width = window.innerWidth - 56;\n        }\n        this.renderer.setSize(this.width, this.height);\n    }\n\n    setCamera(type) {\n        console.log('set camera called')\n        if (this.camera) {\n            this.camera = '';\n        }\n        this.cameraType = type;\n        if (type === 'perspective') {\n            this.camera = new PerspectiveCamera(50, this.width / this.height, 0.1, 1000);\n        } else {\n            this.camera = new OrthographicCamera(this.width / -2, this.width / 2, this.height / 2, this.height / -2, -100, 5000);\n        }\n\n        if (this.cameraPosition != null) {\n            this.camera.position.set(...this.cameraPosition);\n        }\n        this.controls = new OrbitControls(this.camera, this.renderer.domElement);\n        this.controls.target = this.lookAt;\n        // this.update();\n\n\n    }\n\n    updateCamera() {\n        if (this.cameraType === 'perspective') {\n            this.camera.aspect = this.width / this.height;\n        } else {\n            this.camera.left = this.width / -2;\n            this.camera.right = this.width / 2;\n            this.camera.top = this.height / 2;\n            this.camera.bottom = this.height / -2;\n        }\n        this.camera.updateProjectionMatrix();\n        this.update();\n    }\n\n    updateCameraZoom(val) {\n        this.camera.zoom = val;\n        this.camera.updateProjectionMatrix();\n    }\n\n    updateCameraPosition(p) {\n        this.cameraPosition = [p.x, p.y, p.z];\n        this.camera.position.set(p.x, p.y, p.z);\n        this.controls.update();\n    }\n\n    updateLookAt(l) {\n        this.lookAt = new Vector3(l.x, l.y, l.z);\n        this.controls.target = this.lookAt;\n        this.controls.update();\n\n    }\n\n    /* AMBIENT AND LIGHT FUNCTIONS */\n\n    updateBg(colour) {\n        this.bgColour = colour;\n        this.renderer.setClearColor(this.bgColour);\n    }\n\n    updateLight(type, colour) {\n        this.lighting[type].updateColour(Model.rgbToHex(colour.r, colour.g, colour.b), colour.i);\n        if (type !== 0) {\n            this.lighting[type].helper.update();\n        }\n    }\n\n    toggleLightHelper(type, toggle) {\n        if (toggle) {\n            if (this.bgColour === '#ffffff' && !this.lightHelperWarningGiven) {\n                Alert.warning('If the background colour and light colour are the same, the light helper may not be visible.');\n                this.lightHelperWarningGiven = true;\n            }\n            this.lighting[type].helper.update();\n            this.scene.add(this.lighting[type].helper);\n        } else {\n            this.scene.remove(this.lighting[type].helper);\n        }\n    }\n\n    updateLightPosition(type, pos) {\n        this.lighting[type].updatePosition(pos.x, pos.y, pos.z);\n        this.lighting[type].helper.update();\n    }\n\n    /* PERIODIC BOUNDING TOOL FUNCTIONS */\n\n    toggleFoldState(id, toggle) {\n        if (toggle === true) {\n            this.updateSets(id, [id], (id) => {\n                this.sets[id].elements = [];\n                this.sets[id].meshes = [];\n                this.sets[id].genFoldedPositionFromUnfold();\n                this.sets[id].genElements();\n                this.sets[id].genMeshes();\n            });\n        } else if (toggle === false) {\n            this.updateSets(id, [id], (id) => {\n                this.sets[id].elements = [];\n                this.sets[id].meshes = [];\n                this.sets[id].Folded_position = [];\n                this.sets[id].genElements();\n                this.sets[id].genMeshes();\n            });\n        }\n    }\n\n    // toggleUnfoldState(id,toggle){\n    //     if(toggle){\n    //         this.updateSets(id, [id], (id) => {\n    //             this.sets[id].elements =[];\n    //             this.sets[id].meshes = [];\n    //             this.sets[id].genUnfoldPosition();\n    //             this.sets[id].genElements();\n    //             this.sets[id].genMeshes();\n    //         });\n    //     }\n    //     else if(toggle == false){\n    //         this.updateSets(id, [id], (id) => {\n    //             this.sets[id].elements =[];\n    //             this.sets[id].meshes = [];\n    //             this.sets[id].genFoldedPositionFromUnfold();\n    //             this.sets[id].genElements();\n    //             this.sets[id].genMeshes();\n    //         });\n    //     }\n    //}\n\n\n    /* REFERENCE TOOLS FUNCTIONS */\n    toggleAxes() {\n        this.axesEnabled = !this.axesEnabled;\n\n        if (this.axesEnabled) {\n            for (let a of this.tools.axes) {\n                this.scene.add(a);\n            }\n        } else {\n            for (let a of this.tools.axes) {\n                this.scene.remove(a);\n            }\n        }\n\n\n    }\n\n    toggle_axes_enabled() {\n        this.axes_enabled = !this.axes_enabled;\n        this.update();\n    }\n\n    toggle_axes_colour() {\n        this.colour_axes = !this.colour_axes;\n        this.update();\n    }\n\n    toggleAxesMulticolour() {\n        let passAxes = false;\n        if (this.axesEnabled) {\n            this.toggleAxes();\n            passAxes = true;\n        }\n        this.tools.toggleMulticolour(this.sets[0].director);\n        if (passAxes) {\n            this.toggleAxes();\n        }\n    }\n\n    updateBoundingShape(type, enabled) {\n        this.boundingShapeEnabled = enabled;\n        this.scene.remove(this.tools.boundingShape);\n        if (enabled) {\n            this.scene.add(this.tools.genBoundingShape(type, this.sets));\n        }\n    }\n\n\n    /* SLICING FUNCTIONS */\n    enableClipping(toggle, id) {\n        if (toggle === true) {\n            this.renderer.localClippingEnabled = true;\n            for (let x = 0; x < this.sets.length; x++) {\n                this.updateSets(x, [x], (x) => {\n                    this.sets[x].elements = [];\n                    this.sets[x].meshes = [];\n                    this.sets[x].setBackFace(true);\n                    this.sets[x].genElements();\n                    this.sets[x].genMeshes();\n                });\n            }\n\n        } else {\n            this.renderer.localClippingEnabled = false;\n\n        }\n\n\n    }\n\n    // disableClipping(){\n    //     this.renderer.localClippingEnabled = false;\n    // }\n\n    initClippers() {\n        this.clippingIntersections = false;\n\n\n        this.clippingPlanes = [new Plane(new Vector3(1, 0, 0), 180), new Plane(new Vector3(-1, 0, 0), 180), new Plane(new Vector3(0, 1, 0), 180), new Plane(new Vector3(0, -1, 0), 180), new Plane(new Vector3(0, 0, 1), 180), new Plane(new Vector3(0, 0, -1), 180)];\n\n        this.clippingHelpers = [new PlaneHelper(this.clippingPlanes[0], 100, 0xff0000), new PlaneHelper(this.clippingPlanes[1], 100, 0xff0000), new PlaneHelper(this.clippingPlanes[2], 100, 0x00ff00), new PlaneHelper(this.clippingPlanes[3], 100, 0x00ff00), new PlaneHelper(this.clippingPlanes[4], 100, 0x0000ff), new PlaneHelper(this.clippingPlanes[5], 100, 0x0000ff)];\n\n        for (let helper of this.clippingHelpers) {\n            helper.visible = false;\n            this.scene.add(helper);\n        }\n\n\n    }\n\n\n    // }\n    toggleHelper(i, toggle) {\n        this.clippingHelpers[2 * i].visible = toggle;\n        this.clippingHelpers[2 * i + 1].visible = toggle;\n    }\n\n    updateSlicer(i, vals) {\n        for (let set of this.sets) {\n            set.updateSlicers(i, vals);\n        }\n    }\n\n    /* Video SUITE */\n    uploadConfig() {\n        return new Promise(async (resolve, reject) => {\n            let fileHandle = [];\n            let lst = [];\n            try {\n                fileHandle = await window.showOpenFilePicker({multiple: true});\n                for (let i = 0; i < fileHandle.length; i++) {\n                    const file = await fileHandle[i].getFile();\n                    lst.push(file);\n                }\n                this.Video_sample_list = lst;\n                resolve(lst);\n            } catch (error) {\n                reject(error);\n            }\n        });\n    }\n\n    notifyFinishUpload() {\n        this.notify('info', `Files loaded successfully`, (<div>\n            <p style={{width: 320}}>\n                Now Select Your Video Viewing configuration!\n                You can show unit box, apply slicing , periodic boundary conditions etc.\n                Please Do not change screen size while generating Video e.g dont click on size bar\n            </p>\n        </div>));\n    }\n\n\n    retrieveVideoSample() {\n        return this.Video_sample_list;\n    }\n\n    /* PERFORMANCE TEST SUITE */\n\n\n    initTesting(step) {\n        // set desirable testing view\n        this.setCamera('orthographic', false);\n        this.updateCameraZoom(8);\n        this.updateLightPosition(2, {x: 50, y: 0, z: 50});\n        this.deleteAllMeshes();\n        this.testMaterial = new MeshPhongMaterial({wireframe: false});\n        // this.testShape = new SHAPE.Preset('Sphere', ...Parameters.Sphere.vals);\n        this.testShape = new SHAPE.Spheroplatelet(0.3, 0.2);\n        console.log('this.genshape');\n        this.testShape.LOD = 2;\n        this.testShape.generate();\n        this.testTotal = 0;\n        this.testLimit = 140001;\n\n        let geoms = [];\n        geoms.push(this.testShape.stripGeometry.clone());\n        this.testGeo = geoms;\n\n        this.translate([Math.random() * 100 - 50, Math.random() * 100 - 50, Math.random() * 100 - 50], geoms);\n\n        this.notify('info', 'Initialising Performance Test', (<p style={{width: 320}}>\n            Test Size: {this.testLimit.toString()} <br/>\n            Step: {step.toString()} <br/>\n            Shape: Spheroplatelet(0.3,0.2) <br/>\n            Level of Detail: {(this.testShape.LOD + 1).toString()} <br/>\n            Material: MeshPhongMaterial\n            <br/> <br/>\n            <b>Please do not change any settings while the performance test is running!</b>\n        </p>));\n\n        console.log('Material: MeshLambertMaterial')\n        console.log('Shape: Spheroplatelet (Default Parameters)')\n        console.log('LOD: ' + (this.testShape.LOD + 1).toString())\n        console.log('Test Size: ' + this.testLimit.toString())\n        console.log('Test Step: ' + step.toString());\n    }\n\n    deleteAllMeshes() {\n        for (const set of this.sets) {\n            console.log(set)\n            for (const m of set.meshes) {\n                this.scene.remove(m);\n                // m.geometry.dispose();\n                // m.material.dispose();\n                // m.dispose();\n            }\n\n        }\n\n    }\n\n    addRandomParticles(n) {\n        this.deleteAllMeshes();\n        console.log('add called')\n        this.testTotal += n;\n\n        if (this.testTotal >= this.testLimit) {\n            return true;\n        }\n        // let m;\n        // for (let i = 0; i < n; i++) {\n        //     for (let g of this.testGeo) {\n        //          m = new Mesh(g, this.testMaterial);\n        //         this.scene.add(m);\n        //     }}\n\n        let InstancedMesh1 = new InstancedMesh(this.testGeo[0], this.testMaterial, n);\n        let InstancedMesh2 = new InstancedMesh(this.testGeo[1], this.testMaterial, n);\n        let InstancedMesh3 = new InstancedMesh(this.testGeo[2], this.testMaterial, n);\n        console.log(InstancedMesh1);\n        for (let i = 0; i < n; i++) {\n            console.log('called')\n            const matrix = new Matrix4();\n            const position = new Vector3();\n            const rotation = new Euler();\n            const quaternion = new Quaternion();\n            const scale = new Vector3();\n            const color = new Color();\n            position.x = Math.random() * 40 - 20;\n            position.y = Math.random() * 40 - 20;\n            position.z = Math.random() * 40 - 20;\n\n            rotation.x = Math.random() * 2 * Math.PI;\n            rotation.y = Math.random() * 2 * Math.PI;\n            rotation.z = Math.random() * 2 * Math.PI;\n\n            quaternion.setFromEuler(rotation);\n\n            scale.x = scale.y = scale.z = Math.random();\n\n            matrix.compose(position, quaternion, scale);\n            InstancedMesh1.setMatrixAt(i, matrix);\n            InstancedMesh2.setMatrixAt(i, matrix);\n            InstancedMesh3.setMatrixAt(i, matrix);\n            InstancedMesh1.setColorAt(i, color.setHex(0xffffff * Math.random()));\n            InstancedMesh2.setColorAt(i, color.setHex(0xffffff * Math.random()));\n            InstancedMesh3.setColorAt(i, color.setHex(0xffffff * Math.random()));\n        }\n        this.scene.add(InstancedMesh1, InstancedMesh2, InstancedMesh3);\n        this.update();\n        return false;\n    }\n\n    translate(pos, geoms) {\n        for (let g of geoms) {\n            g.translate(pos[0], pos[1], pos[2]);\n        }\n    }\n\n}\n\n\nexport default Model;\n","import {ButtonToolbar, Col, Dropdown, InputGroup, InputNumber, RangeSlider, Row, Slider} from 'rsuite';\nimport React, {useState} from \"react\";\n\n\nexport const ParameterSet = (props) => {\n    let set = [];\n\n    for (let i = 0; i < props.titles.length; i++) {\n        set.push(<ParameterInput title={props.titles[i]} values={props.values[i]} numerical f={props.f} index={i}\n                                 step={props.step} positive={props.positive} styling={props.styling}/>);\n    }\n\n    return set;\n}\n\nexport class ParameterInput extends React.Component {\n\n\n    constructor(props) {\n        super();\n        this.styling = props.styling;\n        this.active = props.active;\n        this.f = props.f;\n        this.step = props.step;\n        this.title = props.title;\n        this.values = props.values;\n        this.numerical = props.numerical;\n        this.index = props.index;\n        this.selectingSet = props.selectingSet;\n        this.changeValue = this.changeValue.bind(this);\n\n        if (props.positive) {\n            this.min = 0;\n        }\n    }\n\n    changeValue(value) {\n        this.active = value;\n        this.f(value, this.index);\n    }\n\n    render() {\n        let InputBox;\n        if (this.numerical) {\n            let defaultVal = this.values;\n            InputBox = (<div style={this.styling[0]}>\n                <InputNumber defaultValue={defaultVal} step={this.step} onChange={this.changeValue} min={this.min}/>\n            </div>);\n        } else {\n            let vals = this.values;\n            let active = this.active;\n            let listItems = [];\n            let act;\n\n            for (let val of vals) {\n                (active.localeCompare(val)) ? act = false : act = true;\n                listItems.push(<Dropdown.Item key={val} eventKey={val} active={act}\n                                              onSelect={this.changeValue}>{val}</Dropdown.Item>);\n            }\n\n            listItems.push(<Dropdown.Item key={'panel'} eventKey={'panel'} panel style={{width: 150}}></Dropdown.Item>);\n\n            InputBox = (<ButtonToolbar style={{width: 10, marginLeft: 0}}>\n                <Dropdown style={{width: 100}} title={this.active}>\n                    {listItems}\n                </Dropdown>\n            </ButtonToolbar>);\n\n        }\n\n        return (<div>\n            <Row style={{marginTop: 15}}>\n                <Col md={10}><p style={this.styling[1]}>{this.title}</p></Col>\n                <Col md={10}/>\n                <Col md={14}>{InputBox}</Col>\n            </Row>\n        </div>);\n    }\n}\n\nexport const SliceSlider = (props) => {\n    const [value, setValue] = React.useState(props.vals);\n    let f = props.f;\n    let i = props.index;\n\n    return (<div>\n        <br/>\n        <Row>\n            <Col md={5}>\n                <p style={{marginTop: 10, marginLeft: 30}}>{props.title}</p>\n            </Col>\n            <Col md={1}/>\n            <Col md={16}>\n                <InputGroup>\n                    <InputNumber\n                        min={-100.0}\n                        max={100.0}\n                        value={value[0]}\n                        step={0.1}\n                        onChange={nextValue => {\n                            const end = value[1];\n                            if (!nextValue || isNaN(nextValue)) {\n                                nextValue = 0;\n                            }\n                            if (parseFloat(nextValue) > end) {\n                                return;\n                            }\n                            setValue([parseFloat(nextValue), end]);\n                            f(i, [parseFloat(nextValue), end]);\n                        }}\n                    />\n                    <InputGroup.Addon>to</InputGroup.Addon>\n                    <InputNumber\n                        min={-100.0}\n                        max={100.0}\n                        value={value[1]}\n                        step={0.1}\n                        onChange={(nextValue) => {\n                            if (!nextValue || isNaN(nextValue)) {\n                                nextValue = 0;\n                            }\n                            const start = value[0];\n                            if (start > parseFloat(nextValue)) {\n                                return;\n                            }\n                            setValue([start, parseFloat(nextValue)]);\n                            f(i, [start, parseFloat(nextValue)]);\n                        }}\n                    />\n                </InputGroup>\n            </Col>\n        </Row>\n        <Row>\n            <Col md={21}>\n                <RangeSlider\n                    min={-100.0}\n                    max={100.0}\n                    progress\n                    style={{marginLeft: 35, marginTop: 30}}\n                    value={value}\n                    onChange={value => {\n                        setValue(value);\n                        f(i, value);\n                    }}\n                />\n            </Col>\n\n        </Row>\n    </div>);\n}\n\nexport const CustomSlider = (props) => {\n    let f = props.f;\n    let [value, setValue] = useState(props.val);\n    let type;\n    let disabled = props.disabled;\n    const [min, max] = props.boundaries;\n\n    if (props.type == null) {\n        type = null;\n    } else {\n        type = props.type;\n    }\n\n    return (\n\n        <Row>\n            <Col md={10}>\n                <Slider\n                    style={{marginLeft: 25, marginTop: 16, width: 170}}\n                    value={parseInt(value)}\n                    min={min}\n                    max={max}\n                    disabled={disabled}\n                    onChange={value => {\n                        setValue(value);\n                        f(value, type);\n                    }}\n                />\n            </Col>\n            <Col md={4}>\n                <InputNumber\n                    style={{marginLeft: 80, marginTop: 3, marginBottom: 3, width: 65, height: 35}}\n                    min={min}\n                    max={max}\n                    value={value}\n                    disabled={disabled}\n                    onChange={value => {\n                        if (!value || isNaN(value)) {\n                            value = 0;\n                        }\n                        setValue(value);\n                        f(value, props.type)\n                    }}\n                />\n            </Col>\n        </Row>);\n}","import {\n    Alert,\n    Button,\n    ButtonToolbar,\n    ControlLabel,\n    Drawer,\n    Dropdown,\n    Form,\n    FormGroup,\n    Header,\n    Icon,\n    Nav,\n    Navbar,\n    Slider,\n    Tooltip,\n    Whisper\n} from 'rsuite';\nimport {ParameterSet} from './Tools';\nimport React from \"react\";\nimport {Shape} from \"../Model/Shapes\";\n\n\nclass ExportDropdown extends React.Component {\n\n    constructor(props) {\n        super();\n        this.dimensions = [1000, 1000];\n        this.resolution = [10];\n        this.f = props.f;\n        this.setResolution = this.setResolution.bind(this);\n        this.setDimensions = this.setDimensions.bind(this);\n        this.export = this.export.bind(this);\n    }\n\n    setDimensions(val, index) {\n        this.dimensions[index] = parseInt(val);\n    }\n\n    setResolution(val) {\n        this.resolution[0] = parseInt(val);\n    }\n\n    export() {\n        this.f(...this.dimensions.concat(this.resolution));\n    }\n\n    render() {\n        return (<Dropdown title=\"Export\" trigger='click' placement=\"bottomEnd\" icon={<Icon icon=\"export\"/>}>\n\n            <ParameterSet f={this.setDimensions} titles={['Height', 'Width']} values={this.dimensions} step={5} positive\n                          styling={[{marginRight: 25}, {marginTop: 18, marginLeft: 35}]}/>\n            <ParameterSet f={this.setResolution} titles={['Resolution']} values={this.resolution} step={1} positive\n                          styling={[{marginRight: 25}, {marginTop: 18, marginLeft: 35}]}/>\n\n            <Button style={{width: 180, marginLeft: 25, marginRight: 25, marginTop: 15, marginBottom: 15}}\n                    appearance='primary' onClick={this.export}> Export </Button>\n        </Dropdown>);\n    }\n\n}\n\nclass LibraryDropdown extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.model = props.model;\n        this.state = {active: 2};\n        this.f = props.f;\n        this.toggler = props.toggler;\n    }\n\n    render() {\n        return (<Dropdown\n            title=\"Library\"\n            trigger='click'\n            placement=\"bottomEnd\"\n            icon={<Icon icon=\"database\"/>}\n            appearance='subtle'\n            onSelect={(eventKey) => {\n                this.f(eventKey);\n            }}>\n\n            <Dropdown.Menu title=\"Samples\">\n                <Dropdown.Item eventKey={14}>Single Molecule</Dropdown.Item>\n                <Dropdown.Item eventKey={15}>QMGA Geometries</Dropdown.Item>\n                <Dropdown.Item eventKey={1}>Unit Vector Orientations</Dropdown.Item>\n                <Dropdown.Item eventKey={2}>Quaternion Orientations</Dropdown.Item>\n            </Dropdown.Menu>\n            <Dropdown.Menu title=\"Unfolded Samples\">\n                <Dropdown.Item eventKey={17}>Unfolded SC4 Nematic</Dropdown.Item>\n                <Dropdown.Item eventKey={18}>Unfolded E3 Chiral Nematic</Dropdown.Item>\n            </Dropdown.Menu>\n            <Dropdown.Menu title=\"Spherocylinders\">\n                <Dropdown.Item eventKey={3}>SC4 Isotropic</Dropdown.Item>\n                <Dropdown.Item eventKey={4}>SC4 Nematic</Dropdown.Item>\n                <Dropdown.Item eventKey={5}>SC4 Smectic</Dropdown.Item>\n            </Dropdown.Menu>\n            <Dropdown.Menu title=\"Prolate and Oblate Ellipsoids\">\n                <Dropdown.Item eventKey={12}>E3 Chiral Nematic</Dropdown.Item>\n                <Dropdown.Item eventKey={6}>E5 Isotropic</Dropdown.Item>\n                <Dropdown.Item eventKey={7}>E5 Nematic</Dropdown.Item>\n                <Dropdown.Item eventKey={8}>O5 Isotropic</Dropdown.Item>\n                <Dropdown.Item eventKey={9}>O5 Nematic</Dropdown.Item>\n            </Dropdown.Menu>\n            <Dropdown.Menu title=\"Dense Packings\">\n                <Dropdown.Item eventKey={10}>Biaxial Crystal (Small)</Dropdown.Item>\n                <Dropdown.Item eventKey={11}>Biaxial Crystal (Large)</Dropdown.Item>\n                <Dropdown.Item eventKey={13}>HBC (in Cylinder)</Dropdown.Item>\n            </Dropdown.Menu>\n            <Dropdown.Item panel style={{width: 120}}></Dropdown.Item>\n        </Dropdown>);\n\n    }\n}\n\nclass PerformanceDropdown extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.model = props.model;\n        this.state = {val: props.model.lod + 1};\n        this.updateVal = this.updateVal.bind(this);\n    }\n\n    updateVal(val) {\n        this.setState({\n            val: val\n        });\n    }\n\n    render() {\n        const lod = this.state.val;\n        return (<Dropdown title=\"Level of Detail\" trigger='click' placement=\"bottomEnd\" icon={<Icon icon=\"sliders\"/>}>\n            <Form style={{marginLeft: 20, marginTop: 20}} layout=\"inline\">\n                <FormGroup>\n                    <ControlLabel>Adjust LOD</ControlLabel>\n                    <Whisper placement=\"bottom\" trigger=\"hover\" speaker={<Tooltip>\n                        Decreasing LOD will increase rendering speed.\n                    </Tooltip>}>\n                        <Icon icon=\"question-circle\" size=\"lg\"/>\n                    </Whisper>\n                </FormGroup>\n            </Form>\n\n            <Slider\n                min={1}\n                step={1}\n                max={Shape.complexity_count}\n                value={lod}\n                graduated\n                progress\n                style={{width: 200, marginLeft: 30, marginRight: 30, marginBottom: 20}}\n                onChange={(value) => {\n                    this.model.updateLOD(value - 1);\n                    this.updateVal(value);\n                    this.model.update();\n                }}\n\n            />\n            <br/>\n        </Dropdown>);\n    }\n\n}\n\n\nclass GeneralMenu extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.model = props.model;\n        this.functions = props.functions;\n        this.toggler = props.toggler;\n        this.state = {fps: 0, showDrawer: false, rotating: false, numOfRender: this.model.numOfObject};\n        this.updateFPS = this.updateFPS.bind(this);\n        this.toggleDrawer = this.toggleDrawer.bind(this);\n        this.toggleAutorotate = this.toggleAutorotate.bind(this);\n        this.runPerformanceTest = this.runPerformanceTest.bind(this);\n\n\n        this.chronometer = props.chronometer;\n        this.chronometer.f = this.updateFPS;\n\n\n        this.toggler.autorotate = () => {\n            this.toggleAutorotate();\n        }\n\n\n    }\n\n    toggleAutorotate() {\n        this.setState({\n            rotating: !this.state.rotating\n        });\n        this.model.toggleAutorotate();\n        if (this.model.rotating) {\n            this.toggler.closeSidemenu();\n        }\n        this.continuousRender();\n    }\n\n    runPerformanceTest() {\n        Alert.info(\"To modify testing parameters, see 'initTesting()' in Model class.\");\n\n        this.model.initTesting(this.chronometer.step);\n\n        if (!this.state.rotating) {\n            this.toggleAutorotate();\n        }\n\n        this.chronometer.testing = true;\n    }\n\n    continuousRender = () => {\n        this.model.update();\n        this.chronometer.click();\n        this.model.controls.update();\n        if (this.model.rotating) {\n            requestAnimationFrame(this.continuousRender);\n        }\n    }\n\n\n    toggleDrawer() {\n        this.setState({\n            showDrawer: !this.state.showDrawer\n        });\n    }\n\n    updateFPS(fps) {\n        this.setState({\n            fps: fps.toFixed(2), numOfRender: this.model.numOfObject\n        });\n    }\n\n    render() {\n        const num = this.state.numOfRender;\n        const fps = this.state.fps;\n        const showDrawer = this.state.showDrawer;\n        const rotating = this.state.rotating;\n        return (<div>\n            <Header style={{height: 56}}>\n                <Navbar>\n                    <Navbar.Body>\n                        <Nav pullRight>\n                            <ButtonToolbar>\n\n                                <Nav.Item active>fps: {fps}</Nav.Item>\n                                <Nav.Item active>Draw calls made: {num}</Nav.Item>\n                                <Nav.Item onClick={this.runPerformanceTest} appearance=\"active\"\n                                          icon={<Icon icon=\"dashboard\"/>}>Run Performance Test</Nav.Item>\n\n                                <Nav.Item active={rotating} onClick={this.toggleAutorotate} appearance=\"subtle\"\n                                          icon={<Icon icon=\"refresh\" spin={rotating}/>}>Autorotate</Nav.Item>\n\n\n                                <PerformanceDropdown model={this.model}/>\n                                <LibraryDropdown f={this.functions[3]}/>\n                                <Nav.Item onClick={this.toggleDrawer} appearance=\"subtle\"\n                                          icon={<Icon icon=\"info\"/>}>About</Nav.Item>\n                                <ExportDropdown f={this.functions[2]}/>\n                                <Nav.Item appearance=\"subtle\" icon={<Icon icon=\"file-download\"/>}\n                                          onSelect={this.functions[0]}>Save</Nav.Item>\n                                <input type=\"file\"\n                                       id=\"upload-btn\"\n                                       style={{display: 'none'}}\n                                       className='input-file'\n                                       accept='.json,.webmga'\n                                       onChange={e => this.functions[1](e.target.files[0])}/>\n                                <label htmlFor=\"upload-btn\">\n                                    <Nav.Item icon={<Icon icon=\"file-upload\"/>}>Upload</Nav.Item>\n                                </label>\n\n                            </ButtonToolbar>\n\n                        </Nav>\n                        <Nav>\n                            <h6 style={{padding: 20}}> WebMGA</h6>\n                        </Nav>\n                    </Navbar.Body>\n                </Navbar>\n            </Header>\n            <Drawer\n                size={'sm'}\n                placement={'right'}\n                show={showDrawer}\n                onHide={this.toggleDrawer}\n                backdrop={false}\n            >\n                <Drawer.Header>\n                    <Drawer.Title>About</Drawer.Title>\n                    <br/>\n                    <ButtonToolbar>\n                        <Button color=\"cyan\" href=\"http://students.cs.ucl.ac.uk/2019/group3/WebMGA/notes.pdf\"\n                                target=\"_blank\" rel=\"noopener noreferrer\">\n                            <Icon icon=\"mortar-board\"/> Liquid Crystals\n                        </Button>\n                        <Button key=\"man\" color=\"cyan\"\n                                href=\"http://students.cs.ucl.ac.uk/2019/group3/WebMGA/manual.txt\" target=\"_blank\"\n                                rel=\"noopener noreferrer\">\n                            <Icon icon=\"info-circle\"/> User Manual\n                        </Button>\n                        <Button color=\"cyan\" href=\"dissertations/2021.pdf\"\n                                target=\"_blank\" rel=\"noopener noreferrer\">\n                            <Icon icon=\"book\"/> Dissertation 2021\n                        </Button>\n                        <Button color=\"cyan\" href=\"dissertations/2023.pdf\"\n                                target=\"_blank\" rel=\"noopener noreferrer\">\n                            <Icon icon=\"book\"/> Dissertation 2023\n                        </Button>\n                        <Button color=\"cyan\" href=\"https://github.com/joe-down/WebMGA-3\" target=\"_blank\"\n                                rel=\"noopener noreferrer\">\n                            <Icon icon=\"github\"/> Github\n                        </Button>\n                    </ButtonToolbar>\n                    <br/>\n                    <p><i>See 'Liquid Crystals' for a scientific explanation of the liquid crystal configurations\n                        included in the library.</i></p>\n\n                    <p><i>For information on how to upload a custom configuration or how to cite WebMGA in a\n                        scientific publication, see 'User Manual'.</i></p>\n\n                </Drawer.Header>\n\n                <div style={{margin: 25}}>\n                    <h2>WebMGA </h2>\n                    <br/>\n                    WebMGA was developed by Eduardo Battistini in 2020-21 for his final project within the BSc\n                    Computer Science at University College London, supervised by Guido Germano, Michael P. Allen,\n                    and Tobias Ritschel.\n                    <br/><br/>\n                    The WebGL Molecular Graphics Application, or WebMGA, is a web-based visualisation tool for\n                    coarse-grained molecular models that utilises prolated and elongated convex bodies as the\n                    elementary units of simulation.\n                    <br/><br/>\n                    Given the prevalence of said geometries in the modelling of liquid crystal systems and the lack\n                    of available visualisation platforms suitable for this niche, WebMGA provides a unique,\n                    out-of-the-box solution for researchers and educators to generate, stylise, and interact with\n                    three-dimensional renders of molecular simulations.\n                    <br/><br/>\n                    WebMGA is written in Javascript, and implements the graphics library <a\n                    href=\"https://threejs.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Threejs</a> for rendering\n                    images and the <a href=\"https://rsuitejs.com/\" target=\"_blank\"\n                                      rel=\"noopener noreferrer\">rSuite</a> library to provide a sleek user interface\n                    that is intuitively compartmentalised and easy to learn.\n                    <br/><br/>\n                    WebMGA is an evolution of <a href=\"http://qmga.sourceforge.net/\" target=\"_blank\"\n                                                 rel=\"noopener noreferrer\">QMGA</a>, an OpenGL and Qt3 based\n                    application written in C++ that filled this gap in molecular graphics in 2008.\n\n                </div>\n            </Drawer>\n        </div>);\n    }\n}\n\nexport default GeneralMenu;","\nimport { Nav, Divider, Checkbox, FormGroup, RadioGroup, Radio, Grid, Row, Col, Alert, Whisper, Tooltip, Icon,Input } from 'rsuite';\nimport React from \"react\";\nimport { SliceSlider, ParameterInput, ParameterSet, CustomSlider } from './Tools'\nimport {View} from './View'\n\nimport ccapture from \"ccapture.js-npmfixed\";\nimport { Scrollbars } from 'rc-scrollbars';\n\nconst TITLE_LEFT_MARGIN = 30;\nconst dividerStyle = {\n    color: '#A4A9A3'\n}\n\nconst submenuParameterSetStyling = [\n    { width: 130, marginLeft: 10 },\n    { marginTop: 10, marginLeft: 30 }\n];\n\nexport class ModelsOptions extends React.Component {\n\n    constructor(props) {\n        super();\n        this.state = View.state.model;\n        this.model = props.model;\n        this.model.deleteAllMeshes();\n        this.selectShape = this.selectShape.bind(this);\n        this.selectSet = this.selectSet.bind(this);\n        this.updateParameter = this.updateParameter.bind(this);\n        this.toggleWireframe = this.toggleWireframe.bind(this);\n        this.toggleColour = this.toggleColour.bind(this);\n        this.updateUserColour = this.updateUserColour.bind(this);\n    }\n\n\n    updateUserColour(val, type) {\n        let colour = this.state.configurations[this.state.active].colour;\n\n        switch (type) {\n            case 'r':\n                colour.r = parseInt(val);\n                break;\n            case 'g':\n                colour.g =  parseInt(val);\n                break;\n            case 'b':\n                colour.b =  parseInt(val);\n                break;\n            default:\n                Alert.error('Error: Unexpected RGB Identifier');\n        }\n        this.model.updateUserColour(this.state.active, colour);\n        this.model.update();\n        View.state.model.configurations[this.state.active].colour = colour;\n    }\n\n    toggleColour() {\n        let toggle = !this.state.configurations[this.state.active].colourFromDirector;\n        this.setState({\n            colourFromDirector: toggle\n        });\n        View.state.model.configurations[this.state.active].colourFromDirector = toggle;\n        this.model.toggleUserColour(this.state.active, toggle);\n        this.model.update();\n    }\n\n    toggleWireframe() {\n        let toggle = !this.state.configurations[this.state.active].displayAsWireframe;\n        this.setState({\n            displayAsWireframe: toggle\n        });\n        View.state.model.configurations[this.state.active].displayAsWireframe = toggle;\n        this.model.toggleWireframe(this.state.active, toggle);\n        this.model.update();\n    }\n\n    updateParameter(val, i) {\n        if (isNaN(val) ||!val) {\n            val =0\n        }\n        const parameter = parseFloat(val);\n        let globalState = View.state.model.configurations[this.state.active];\n        globalState.parameters.vals[i] = parameter;\n\n        let configs = this.state.configurations;\n        configs[this.state.active].parameters.vals[i] = parameter;\n\n        this.setState({\n            configurations: configs\n        });\n\n        this.model.updateShape(this.state.active, globalState.shape, globalState.parameters);\n        this.model.update();\n        this.reset();\n    }\n\n    reset() {\n        let i;\n        if (this.state.reset > 50) {\n            i = 0;\n        } else {\n            i = this.state.reset;\n        }\n        this.setState(\n            {\n                reset: ++i\n            }\n        );\n    }\n\n    selectSet(val) {\n        for (let i = 0; i < this.state.sets.length; i++) {\n            if (this.state.sets[i].localeCompare(val) === 0) {\n                this.setState({\n                    active: i\n                })\n                View.state.model.active = i;\n                break;\n            }\n        }\n        this.reset();\n    }\n\n    selectShape(val) {\n        let parameters = this.model.getParameters(val);\n        this.setState(\n            {\n                shape: val,\n                parameters: parameters\n            }\n        );\n        this.reset();\n        View.state.model.configurations[this.state.active].shape = val;\n        View.state.model.configurations[this.state.active].parameters = parameters;\n        this.model.updateShape(this.state.active, val, parameters);\n        this.model.update();\n    }\n\n    render() {\n        const configState = this.state.configurations[this.state.active];\n        const reset = this.state.reset;\n        const title = configState.title;\n        const shapes = [\"Sphere\", \"Ellipsoid\", \"Spherocylinder\", \"Spheroplatelet\", \"Cut Sphere\", \"Double Cut Sphere\", \"Cap\", \"Lens\", \"Cinacchi Lens\", \"Biconvex Lens\"];\n        const sets = this.state.sets;\n\n        return (\n            <Scrollbars  style={{height:800}}>\n            <div key={reset} >\n                <Divider><strong style={dividerStyle}> Configuration</strong></Divider>\n                <ParameterInput key ={5}f={this.selectSet} selectingSet title=\"Set\" values={sets} active={title} styling={submenuParameterSetStyling} />\n                <ParameterInput key ={6}f={this.selectShape} title=\"Shape\" values={shapes} active={configState.shape} styling={submenuParameterSetStyling} />\n                <ParameterSet f={this.updateParameter} titles={configState.parameters.names} values={configState.parameters.vals} step={0.1} positive styling={submenuParameterSetStyling} />\n                <br />\n                <Divider><strong style={dividerStyle}>  Material </strong></Divider>\n\n                <Row className=\"show-grid\">\n                    <Col xs={1} />\n                    <Col xs={20}>\n                        <Checkbox checked={configState.displayAsWireframe} onClick={this.toggleWireframe}> Display as Wireframe </Checkbox>\n                        <Checkbox checked={configState.colourFromDirector} onClick={this.toggleColour}> Colour from Director </Checkbox>\n                        <br />\n                    </Col>\n                </Row>\n\n                <p style={{ marginLeft: TITLE_LEFT_MARGIN }}> RGB </p>\n                <CustomSlider f={this.updateUserColour} disabled={configState.colourFromDirector} boundaries={[0, 255]} val={configState.colour.r} type={'r'} />\n                <CustomSlider f={this.updateUserColour} disabled={configState.colourFromDirector} boundaries={[0, 255]} val={configState.colour.g} type={'g'} />\n                <CustomSlider f={this.updateUserColour} disabled={configState.colourFromDirector} boundaries={[0, 255]} val={configState.colour.b} type={'b'} />\n            </div>\n            </Scrollbars>\n        );\n    }\n}\n\nexport class VideoOptions extends React.Component{\n    constructor(props){\n        super();\n        this.model = props.model;\n        this.state =View.state.reference;\n        this.functions = props.functions;\n        this.toggler = props.toggler;\n        this.setfps = this.setfps.bind(this);\n        this.UploadFiles = this.UploadFiles.bind(this);\n        this.RealTimeVideo = this.RealTimeVideo.bind(this);\n        this.VideoToggle = this.VideoToggle.bind(this);\n        this.setVideoState = this.setVideoState.bind(this);\n        this.state.filename = 'WebMGA-Video.webm';\n        this.setFileName = this.setFileName.bind(this);\n\n    }\n    setFileName (val){\n        this.setState({\n            filename:val\n        })\n    }\n    setfps(val){\n     this.setState({\n        fps:val\n     })\n     View.state.reference.fps = val;\n    }\n    UploadFiles(){\n        let toggle = ! this.state.uploaded;\n        this.setState({\n            uploaded: toggle\n        })\n        if (toggle === true){\n            async function runAfterUpload(model, functions) {\n                const lst = await model.uploadConfig();\n                functions[1](lst[0],true,0);\n            }\n            runAfterUpload(this.model,this.functions).then(()=>{\n                this.model.notifyFinishUpload();\n            })\n        }\n        else{\n            this.model.Video_sample_list =[];\n        }\n\n        View.state.reference.uploaded= !View.state.reference.uploaded;\n    }\n    setVideoState(){\n        var data = this.functions[5]();\n        this.state.vidstate  = data;\n        let toggle = ! this.state.loadVideoState\n        this.setState({\n            loadVideoState :toggle\n        })\n        View.state.reference.loadVideoState =!View.state.reference.loadVideoState;\n    }\n    VideoToggle(){\n        console.log(this.state.video);\n        let toggle = !this.state.video;\n        this.setState({\n            video:toggle\n        })\n        this.state.video = toggle;\n        console.log(toggle)\n        if(toggle ===true){\n            this.toggler.closeSidemenu();\n            const samples = this.model.retrieveVideoSample();\n            const max_iter = samples.length;\n            var capturer = new ccapture( { format: 'webm',framerate:this.state.fps,quality:100});\n            this.RealTimeVideo(0,samples,max_iter,capturer,this.state.vidstate ,this.state.filename);\n\n        }\n        View.state.reference.video = !View.state.reference.video\n    }\n\n    RealTimeVideo(i,samples,max_iter,capturer,vidState,filename){\n        if(i ===0){\n            capturer.start();\n            capturer.capture(this.model.renderer.domElement);\n        }\n        if(i<max_iter){\n            this.functions[1].bind(this)(samples[i],i,vidState);\n            capturer.capture( this.model.renderer.domElement )\n            console.log('running animation',i)\n            if(this.state.video === true ){\n                requestAnimationFrame( ()=> this.RealTimeVideo(i+1,samples,max_iter,capturer,vidState,filename));\n            };\n        }\n        if (i === max_iter){\n                capturer.stop();\n                capturer.save(function( blob ) {\n                    console.log(blob);\n                    var url = URL.createObjectURL(blob);\n                    var link = document.createElement('a');\n                    link.href = url;\n                    console.log(filename)\n                    link.download = filename + '.webm';\n                    document.body.appendChild(link);\n                    link.click();\n                    document.body.removeChild(link);\n                });\n                View.state.reference.video =false;\n                View.state.reference.setVideoState = false;\n\n        }}\n\n\n    render(){\n        const video = this.state.video;\n        const upload = this.state.uploaded;\n        const setVideoState = this.state.loadVideoState;\n        const fps = this.state.fps;\n        return(\n            <div>\n                <Grid fluid>\n                    <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                            <br />\n                            <p><b> Load Configurations </b></p>\n                        </Col>\n                    </Row>\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox checked={upload} onClick={this.UploadFiles} > Load </Checkbox>\n                        </Col>\n                    </Row>\n\n                    <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                            <br />\n                            <p><b> Set Frame Rate</b></p>\n                        </Col>\n                    </Row>\n                    <CustomSlider boundaries={[1,60]} val={fps} f={this.setfps}type={'fps'} />\n                    <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                            <br />\n                            <p><b> Enviroment set up  </b></p>\n                        </Col>\n                    </Row>\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox onClick={this.setVideoState} checked={setVideoState}>Apply </Checkbox>\n                        </Col>\n                        <Col xs={1}>\n                            <Whisper placement=\"bottom\" trigger=\"hover\" speaker={\n                                <Tooltip>\n                                    Modify enviromental set ups such as show unit box at other menus.\n                                    Toggle Apply to apply settings to Video.\n                            </Tooltip>\n                            }>\n                                <Icon style={{ marginTop: 8 }} icon=\"question-circle\" size=\"lg\" />\n                            </Whisper>\n                        </Col>\n                    </Row>\n\n                    <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                            <br />\n                            <p><b> Create Video </b></p>\n                        </Col>\n                    </Row>\n                    <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                        <p>Input File name:</p>\n                        <Input style={{ width:150,height:30,marginLeft: 20 }} placeholder=\"New_Video\"\n                            onChange={(filename) => this.setFileName(filename)}/>\n                        </Col>\n                    </Row>\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox onClick={this.VideoToggle} checked={video} disabled={!upload||!setVideoState}> Create </Checkbox>\n                        </Col>\n                   </Row>\n\n                </Grid>\n                <br />\n                <br />\n            </div>\n\n        )\n    }\n}\n\n\n\nexport class CameraOptions extends React.Component {\n\n    constructor(props) {\n        super();\n        this.state = View.state.camera;\n        this.model = props.model;\n        this.toggler = props.toggler;\n        this.selectType = this.selectType.bind(this);\n        this.updateLookat = this.updateLookat.bind(this);\n        this.updatePosition = this.updatePosition.bind(this);\n        this.updateZoom = this.updateZoom.bind(this);\n        this.updateState = this.updateState.bind(this);\n\n        this.toggler.updateCamera = () => {\n            this.updateState()\n        }\n    }\n\n    updateState(){\n        this.setState(View.state.camera);\n    }\n\n    updateZoom(val) {\n        this.setState({\n            zoom: val\n        });\n        this.model.updateCameraZoom(parseInt(val));\n        this.model.update();\n        View.state.camera.zoom = val;\n    }\n\n    selectType(val) {\n        this.setState({\n            type: val\n        });\n        View.state.camera.type = val;\n        this.model.setCamera(val,false);\n        if (val === \"orthographic\") {\n            this.updateZoom(50);\n        } else {\n            this.updateZoom(1);\n        }\n\n    }\n\n    updatePosition(val, type) {\n        let position = this.state.position;\n        if (val != isNaN && val != null) {\n            switch (type) {\n                case 'x':\n                    position.x = parseInt(val);\n                    break;\n                case 'y':\n                    position.y = parseInt(val);\n                    break;\n                case 'z':\n                    position.z = parseInt(val);\n                    break;\n                default:\n                    Alert.error('Error: Unexpected Camera Position Input');\n                    return;\n            }\n        }\n\n        this.model.updateCameraPosition(position);\n        this.model.update();\n        View.state.camera.position = position;\n    }\n\n    updateLookat(val, type) {\n        let lookAt = this.state.lookAt;\n\n        if (isNaN(val) ||!val) {\n            val =0\n        }\n        switch (type) {\n            case 0:\n                lookAt.x = parseFloat(val);\n                break;\n            case 1:\n                lookAt.y = parseFloat(val);\n                break;\n            case 2:\n                lookAt.z = parseFloat(val);\n                break;\n            default:\n                Alert.error('Error: Unexpected Look At Input');\n                return;\n        }\n\n        this.model.updateLookAt(lookAt);\n        this.model.update();\n        View.state.camera.lookAt = lookAt;\n    }\n\n\n    render() {\n        const cameraType = this.state.type;\n        const zoom = this.state.zoom;\n        const lookAt = [this.state.lookAt.x, this.state.lookAt.y, this.state.lookAt.z];\n        const cameraPosition = this.state.position;\n\n\n        return (\n            <div key={JSON.stringify(this.state)}>\n                <br />\n                <Row className=\"show-grid\">\n                    <Col xs={2} />\n                    <Col xs={12}>\n\n                        <FormGroup controlId=\"radioList\">\n                            <RadioGroup name=\"radioList\" value={cameraType} onChange={this.selectType}>\n                                <p><b>Type</b></p>\n                                <Radio value=\"perspective\">Perspective </Radio>\n                                <Radio value=\"orthographic\">Orthographic </Radio>\n                            </RadioGroup>\n                        </FormGroup>\n\n                    </Col>\n                </Row>\n\n                <Grid fluid>\n\n                    <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                            <br />\n                            <p><b> Position</b></p>\n                        </Col>\n                    </Row>\n\n                    <CustomSlider boundaries={[-50, 50]} val={cameraPosition.x} f={this.updatePosition} type={'x'} />\n                    <CustomSlider boundaries={[-50, 50]} val={cameraPosition.y} f={this.updatePosition} type={'y'} />\n                    <CustomSlider boundaries={[-50, 50]} val={cameraPosition.z} f={this.updatePosition} type={'z'} />\n                    <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                            <br />\n                            <p><b> Zoom </b></p>\n                        </Col>\n                    </Row>\n                    <CustomSlider key={cameraType} boundaries={[1, 100]} val={zoom} f={this.updateZoom} />\n                    <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                            <br />\n                            <p><b> Look at</b></p>\n                        </Col>\n                    </Row>\n                    <ParameterSet titles={[\"x\", \"y\", \"z\"]} values={lookAt} f={this.updateLookat} step={0.5} styling={submenuParameterSetStyling} />\n\n                </Grid>\n                <br />\n\n\n\n            </div>);\n    }\n}\n\nexport class SlicingOptions extends React.Component {\n\n    constructor(props) {\n        super();\n        this.state = View.state.slicing\n        this.model = props.model;\n        this.toggleSlicer = this.toggleSlicer.bind(this);\n        this.toggleHelperX = this.toggleHelperX.bind(this);\n        this.toggleHelperY = this.toggleHelperY.bind(this);\n        this.toggleHelperZ = this.toggleHelperZ.bind(this);\n        this.updateHelpers = this.updateHelpers.bind(this);\n        this.updateSlicer = this.updateSlicer.bind(this);\n        console.log(this.state,View.state.slicing);\n    }\n\n    toggleSlicer(){\n        let toggle = !this.state.slicing_enabled;\n        this.model.enableClipping(toggle,View.state.model.active);\n        this.setState({\n            slicing_enabled :toggle\n        })\n        View.state.slicing.slicing_enabled = toggle\n        console.log(this.state,View.state.slicing);\n    }\n\n    updateHelpers(helpers) {\n        this.setState(\n            {\n                helpers: helpers\n            }\n        );\n        View.state.slicing.helpers = helpers;\n    }\n\n    toggleHelperX() {\n        let helpers = this.state.helpers;\n        let toggle = !helpers[0];\n        helpers[0] = toggle;\n        this.updateHelpers(helpers);\n        this.model.toggleHelper(0, toggle);\n        this.model.update();\n    }\n\n    toggleHelperY() {\n        let helpers = this.state.helpers;\n        let toggle = !helpers[1];\n        helpers[1] = toggle;\n        this.updateHelpers(helpers);\n        this.model.toggleHelper(1, toggle);\n        this.model.update();\n    }\n\n    toggleHelperZ() {\n        let helpers = this.state.helpers;\n        let toggle = !helpers[2];\n        helpers[2] = toggle;\n        this.updateHelpers(helpers);\n        this.model.toggleHelper(2, toggle);\n        this.model.update();\n    }\n\n    updateSlicer(i, val) {\n\n        switch (i) {\n            case 0:\n                this.setState(\n                    {\n                        x:val\n                    }\n                );\n                View.state.slicing.x = val;\n                break;\n            case 1:\n                this.setState(\n                    {\n                        y:val\n                    }\n                );\n                View.state.slicing.ty = val;\n                break;\n            case 2:\n                this.setState(\n                    {\n                        z:val\n                    }\n                );\n                View.state.slicing.z = val;\n                break;\n            default:\n                Alert.error('Error: Unexpected Slicing Identifier');\n        }\n\n\n\n        this.model.updateSlicer(i, val);\n        this.model.update();\n    }\n    render() {\n        const state = this.state;\n        const slicing_enabled = this.state.slicing_enabled;\n        return (\n            <div>\n                <br />\n                <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                            <br />\n                            <p><b> Enable Slicing</b></p>\n                        </Col>\n                    </Row>\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox style={{ marginLeft: 12 }} checked={slicing_enabled}onClick={this.toggleSlicer}> enable </Checkbox>\n                        </Col>\n                    </Row>\n                <SliceSlider title=\"X : \" f={this.updateSlicer} index={0} vals={state.x} disabled={!slicing_enabled}/>\n                <br />\n                <Grid fluid>\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox checked={state.helpers[0]} onClick={this.toggleHelperX}> Show Helper</Checkbox>\n                        </Col>\n                    </Row>\n                </Grid>\n                <SliceSlider title=\"Y : \" f={this.updateSlicer} index={1} vals={state.y} />\n                <br />\n                <Grid fluid>\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox checked={state.helpers[1]} onClick={this.toggleHelperY}> Show Helper</Checkbox>\n                        </Col>\n                    </Row>\n                </Grid>\n                <SliceSlider title=\"Z : \" f={this.updateSlicer} index={2} vals={state.z} />\n                <br />\n                <Grid fluid>\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox checked={state.helpers[2]} onClick={this.toggleHelperZ}> Show Helper</Checkbox>\n                        </Col>\n                    </Row>\n                </Grid>\n            </div>\n        );\n    }\n\n}\n\n\n\n\n\nexport const AdditionalLightsNav = ({ active, onSelect }) => {\n    return (\n        <Nav activeKey={active} onSelect={onSelect} style={{ margin: 10, width: 280 }} justified appearance=\"tabs\">\n            <Nav.Item eventKey=\"point\">Point</Nav.Item>\n            <Nav.Item eventKey=\"directional\">Directional</Nav.Item>\n        </Nav>\n    );\n};\n\nexport class AdditionalLightOptions extends React.Component {\n\n    constructor(props) {\n        super();\n        this.state = View.state.pointLight;\n        this.model = props.model;\n        this.reset = 0;\n        this.handleSelect = this.handleSelect.bind(this);\n        this.updateColour = this.updateColour.bind(this);\n        this.updatePosition = this.updatePosition.bind(this);\n        this.toggleLightEnabled = this.toggleLightEnabled.bind(this);\n        this.toggleHelper = this.toggleHelper.bind(this);\n\n    }\n    handleSelect() {\n        if (this.state.active.localeCompare('point') === 0) {\n            this.setState(View.state.directionalLight);\n        } else {\n            this.setState(View.state.pointLight);\n        }\n        if (this.reset > 5) {\n            this.reset = 0;\n        }\n\n        this.setState({ reset: ++this.reset });\n    }\n\n    toggleHelper() {\n        let helper = !this.state.helper;\n        this.setState({\n            helper: helper\n        });\n\n        if (this.state.active.localeCompare('point') === 0) {\n            View.state.pointLight.helper = helper;\n            this.model.toggleLightHelper(2, helper);\n            this.model.update();\n        } else {\n            View.state.directionalLight.helper = helper;\n            this.model.toggleLightHelper(1, helper);\n            this.model.update();\n        }\n    }\n\n    toggleLightEnabled() {\n        let enabled = !this.state.enabled;\n        this.setState({\n            enabled: enabled\n        });\n        let intensity;\n        if (this.state.active.localeCompare('point') === 0) {\n            View.state.pointLight.enabled = enabled;\n            intensity = View.state.pointLight.colour.i;\n        } else {\n            View.state.directionalLight.enabled = enabled;\n            intensity = View.state.directionalLight.colour.i;\n        }\n\n        if (enabled) {\n            this.updateColour(intensity, 'i');\n        } else {\n            this.updateColour(0, 'i');\n        }\n        this.setState({ reset: ++this.reset });\n\n        if (this.state.active.localeCompare('point') === 0) {\n            View.state.pointLight.colour.i = intensity;\n        } else {\n            View.state.directionalLight.colour.i = intensity;\n        }\n    }\n\n    updateColour(val, type) {\n        let colour = this.state.colour;\n\n        switch (type) {\n            case 'r':\n                colour.r = val;\n                break;\n            case 'g':\n                colour.g = val;\n                break;\n            case 'b':\n                colour.b = val;\n                break;\n            case 'i':\n                colour.i = val;\n                break;\n            default:\n                Alert.error('Error: Unexpected RGB Identifier');\n        }\n\n        if (this.state.active.localeCompare('point') === 0) {\n            this.model.updateLight(2, colour);\n            View.state.pointLight.colour = colour;\n        } else {\n            this.model.updateLight(1, colour);\n            View.state.directionalLight.colour = colour;\n        }\n        this.model.update();\n    }\n    updatePosition(val, type) {\n        let position = this.state.position;\n\n        switch (type) {\n            case 'x':\n                position.x = val;\n                break;\n            case 'y':\n                position.y = val;\n                break;\n            case 'z':\n                position.z = val;\n                break;\n            default:\n                Alert.error('Error: Unexpected Position Identifier');\n        }\n\n        if (this.state.active.localeCompare('point') === 0) {\n            this.model.updateLightPosition(2, position);\n            View.state.pointLight.position = position;\n        } else {\n            this.model.updateLightPosition(1, position);\n            View.state.directionalLight.position = position;\n        }\n        this.model.update();\n    }\n\n    render() {\n        const active = this.state.active;\n        const lightState = this.state;\n        return (\n            <div key={lightState.reset}>\n                <br />\n                <AdditionalLightsNav active={active} onSelect={this.handleSelect} />\n                <br />\n                <Grid fluid>\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox checked={lightState.enabled} onClick={this.toggleLightEnabled}> <strong>Enabled </strong> </Checkbox>\n                            <Checkbox checked={lightState.helper} onClick={this.toggleHelper}> <strong>Show Helper </strong> </Checkbox>\n                            <br />\n                        </Col>\n                    </Row>\n                </Grid>\n                <p style={{ marginLeft: TITLE_LEFT_MARGIN }}> RGB </p>\n                <CustomSlider disabled={!lightState.enabled} boundaries={[0, 255]} val={lightState.colour.r} f={this.updateColour} type={'r'} />\n                <CustomSlider disabled={!lightState.enabled} boundaries={[0, 255]} val={lightState.colour.g} f={this.updateColour} type={'g'} />\n                <CustomSlider disabled={!lightState.enabled} boundaries={[0, 255]} val={lightState.colour.b} f={this.updateColour} type={'b'} />\n                <p style={{ marginLeft: TITLE_LEFT_MARGIN }}> Intensity </p>\n                <CustomSlider disabled={!lightState.enabled} boundaries={[0, 100]} val={lightState.colour.i} f={this.updateColour} type={'i'} />\n                <p style={{ marginLeft: TITLE_LEFT_MARGIN }}> Position XYZ </p>\n                <CustomSlider disabled={!lightState.enabled} boundaries={[-50, 50]} val={lightState.position.x} f={this.updatePosition} type={'x'} />\n                <CustomSlider disabled={!lightState.enabled} boundaries={[-50, 50]} val={lightState.position.y} f={this.updatePosition} type={'y'} />\n                <CustomSlider disabled={!lightState.enabled} boundaries={[-50, 50]} val={lightState.position.z} f={this.updatePosition} type={'z'} />\n            </div>\n        );\n    }\n}\n\nexport class AmbientLightOptions extends React.Component {\n    constructor(props) {\n        super();\n\n        this.state = View.state.ambientLight;\n\n        this.model = props.model;\n\n        this.updateColour = this.updateColour.bind(this);\n        this.updateBg = this.updateBg.bind(this);\n    }\n    updateColour(val, i) {\n        let colour = this.state.ambientLightColour;\n\n        switch (i) {\n            case 'r':\n                colour.r = val;\n                break;\n            case 'g':\n                colour.g = val;\n                break;\n            case 'b':\n                colour.b = val;\n                break;\n            case 'i':\n                colour.i = val;\n                break;\n            default:\n                Alert.error('Error: Unexpected RGB Identifier');\n        }\n        this.model.updateLight(0, colour);\n        this.model.update();\n        View.state.ambientLight.ambientLightColour = colour;\n    }\n    updateBg() {\n        console.log(this.state.darkBackGround)\n        let toggle = !this.state.darkBackGround;\n        this.setState({\n            darkBackGround:toggle\n        })\n        console.log(this.state.darkBackGround)\n        if (toggle === true){\n            this.model.updateBg(\"#000000\");\n        }\n        else{\n            this.model.updateBg('#FFFFFF');\n        }\n        this.model.update();\n        View.state.ambientLight.darkBackGround = !View.state.ambientLight.darkBackGround;\n\n    }\n    render() {\n        const ambientLightColour = this.state.ambientLightColour;\n        const backgroundColour = this.state.darkBackGround;\n        return (\n            <div>\n                <Divider><strong style={dividerStyle}> Ambient Light </strong></Divider>\n                <p style={{ marginLeft: TITLE_LEFT_MARGIN }}> RGB </p>\n                <CustomSlider disabled={false} boundaries={[0, 255]} val={ambientLightColour.r} f={this.updateColour} type={'r'} />\n                <CustomSlider disabled={false} boundaries={[0, 255]} val={ambientLightColour.g} f={this.updateColour} type={'g'} />\n                <CustomSlider disabled={false} boundaries={[0, 255]} val={ambientLightColour.b} f={this.updateColour} type={'b'} />\n                <p style={{ marginLeft: TITLE_LEFT_MARGIN }}> Intensity </p>\n                <CustomSlider disabled={false} boundaries={[0, 100]} val={ambientLightColour.i} f={this.updateColour} type={'i'} />\n                <Divider><strong style={dividerStyle}> Background Colour</strong></Divider>\n                <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox style={{ marginLeft: 12 }} checked ={backgroundColour} onClick={this.updateBg}> Dark Mode</Checkbox>\n                        </Col>\n                </Row>\n            </div>\n        );\n    }\n}\n\nexport class ReferenceOptions extends React.Component {\n    constructor(props) {\n        super();\n        this.state = View.state.reference;\n        this.state.model = View.state.model;\n        this.model = props.model;\n        this.toggleFold = this.toggleFold.bind(this);\n        this.toggleBoundingShapeEnabled= this.toggleBoundingShapeEnabled.bind(this);\n        this.update_repeats = this.update_repeats.bind(this);\n        this.toggleAxes = this.toggleAxes.bind(this);\n\n        this.toggleMulticolour = this.toggleMulticolour.bind(this);\n        this.toggle_axes_enabled = this.toggle_axes_enabled.bind(this)\n        this.toggle_axes_colour = this.toggle_axes_colour.bind(this)\n\n    }\n\n    toggleFold() {\n        let toggle = !this.state.model.configurations[this.state.model.active].displayFoldState;\n        this.setState({\n            displayFoldState: toggle\n        });\n        console.log(this.state.model);\n        View.state.model.configurations[this.state.model.active].displayFoldState = toggle;\n        this.model.toggleFoldState(this.state.model.active,toggle);\n        this.model.update();\n    }\n\n    toggleBoundingShapeEnabled() {\n        let toggle = !this.state.boundingShapeEnabled;\n        this.setState({\n            boundingShapeEnabled: toggle\n        });\n        this.model.updateBoundingShape(View.state.reference.activeShape, toggle);\n        this.model.update();\n        View.state.reference.boundingShapeEnabled = ! View.state.reference.boundingShapeEnabled;\n    }\n\n    toggle_axes_enabled() {\n        this.model.toggle_axes_enabled();\n        this.setState({axesEnabled: !this.model.axes_enabled});\n    }\n\n    toggle_axes_colour() {\n        this.model.toggle_axes_colour();\n        this.setState({multicolour: !this.model.colour_axes});\n    }\n\n    toggleMulticolour() {\n        this.setState({\n            multicolour: !this.state.multicolour\n        });\n        this.model.toggleAxesMulticolour();\n        this.model.update();\n        View.state.reference.multicolour = !View.state.reference.multicolour;\n    }\n    toggleAxes() {\n        this.setState({\n            showAxes: !this.state.showAxes\n        });\n        this.model.toggleAxes();\n        this.model.update();\n\n        View.state.reference.showAxes = !View.state.reference.showAxes;\n    }\n\n    update_repeats(val, type) {\n        val = Math.abs(Math.round(val));\n        switch (type) {\n            case 0:\n                this.state.repeats.x = val;\n                break;\n            case 1:\n                this.state.repeats.y = val;\n                break;\n            case 2:\n                this.state.repeats.z = val;\n                break;\n            default:\n                throw new Error(\"Bad repeat type\")\n        }\n        console.log(\"bread\", this.state, View)\n        this.model.update_repeats(this.state.repeats.x, this.state.repeats.y, this.state.repeats.z);\n        this.model.update();\n    }\n\n    render() {\n        const configState = this.state.model.configurations[this.state.model.active];\n        const enabled = this.state.boundingShapeEnabled;\n        const showAxes = this.model.axes_enabled;\n        const multicolour = this.model.colour_axes;\n        return (\n            <div>\n\n                <Grid fluid>\n                <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                            <br />\n                            <p><b> Unit Box </b></p>\n                        </Col>\n                    </Row>\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox style={{ marginLeft: 12 }} checked={enabled}onClick={this.toggleBoundingShapeEnabled}>  Show </Checkbox>\n                        </Col>\n                    </Row>\n                    <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                            <br />\n                            <p><b> Periodic Boundary Conditions  </b></p>\n                        </Col>\n                    </Row>\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox style={{ marginLeft: 12 }} checked={configState.displayFoldState} onClick={this.toggleFold}> Fold</Checkbox>\n                        </Col>\n                    </Row>\n                    <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                            <br />\n                            <p><b> Repeats  </b></p>\n                        </Col>\n                    </Row>\n                    <ParameterSet titles={[\"x\", \"y\", \"z\"]} values={[this.state.repeats.x, this.state.repeats.y, this.state.repeats.z]} f={this.update_repeats} step={1} styling={submenuParameterSetStyling} />\n                    <Row className=\"show-grid\">\n                        <Col xs={2} />\n                        <Col xs={12}>\n                            <br />\n                            <p><b> Axes </b></p>\n                        </Col>\n                    </Row>\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n                            <Checkbox style={{marginLeft: 12}} checked={showAxes}\n                                      onClick={this.toggle_axes_enabled}> Show</Checkbox>\n\n                        </Col>\n                    </Row>\n\n                    <Row className=\"show-grid\">\n                        <Col xs={1} />\n                        <Col xs={12}>\n\n                            <Checkbox style={{marginLeft: 12}} checked={multicolour}\n                                      onClick={this.toggle_axes_colour}> Multi-Colour</Checkbox>\n\n                        </Col>\n                        <Col xs={4}>\n                            <Whisper placement=\"bottom\" trigger=\"hover\" speaker={\n                                <Tooltip>\n                                    X : RED <br /> Y : GREEN <br /> Z : BLUE\n                            </Tooltip>\n                            }>\n                                <Icon style={{ marginTop: 8 }} icon=\"question-circle\" size=\"lg\" />\n                            </Whisper>\n                        </Col>\n                    </Row>\n\n\n\n                </Grid>\n\n            </div>\n        );\n    }\n}\n","import {Alert, Container, Content, Icon, IconButton, Nav, Navbar, Sidebar} from 'rsuite';\nimport React, {Component} from \"react\";\nimport {\n    AdditionalLightOptions,\n    AmbientLightOptions,\n    CameraOptions,\n    ModelsOptions,\n    ReferenceOptions,\n    SlicingOptions,\n    VideoOptions\n} from './SubMenus'\n\n\nconst NavToggle = ({expand, onChange}) => {\n    return (<Navbar appearance=\"subtle\" className=\"nav-toggle\">\n        <Navbar.Body>\n            <Nav pullRight>\n                <IconButton\n                    circle\n                    style={{textAlign: 'center', margin: 10}}\n                    onClick={onChange}\n                    appearance=\"default\"\n                    icon={<Icon icon={expand ? 'angle-left' : 'angle-right'}/>}/>\n            </Nav>\n        </Navbar.Body>\n    </Navbar>);\n};\n\nconst navItemStyle = {margin: 6.5};\n\nlet sidebarHeight = window.innerHeight - 56;\n\nconst CustomNav = ({active, onSelect, ...props}) => {\n    return (<div>\n        <Nav {...props} activeKey={active} onSelect={onSelect}\n             style={{backgroundColor: '#101010', height: sidebarHeight}}>\n            <Nav.Item title=\"Models\" eventKey=\"Models\" icon={<Icon style={navItemStyle} size=\"lg\" icon=\"shapes\"/>}>\n            </Nav.Item>\n            {/* <Whisper placement=\"right\" trigger=\"hover\" speaker={(<Tooltip>Slicing</Tooltip>)}> */}\n            <Nav.Item title=\"Slicing\" eventKey=\"Slicing\" icon={<Icon style={navItemStyle} size=\"lg\" icon=\"cut\"/>}/>\n            {/* </Whisper> */}\n            {/* <Whisper placement=\"right\" trigger=\"hover\" speaker={(<Tooltip>Slicing</Tooltip>)}> */}\n            <Nav.Item title=\"Video Rendering\" eventKey=\"Video Rendering\"\n                      icon={<Icon style={navItemStyle} size=\"lg\" icon=\"film\"/>}/>\n            {/* </Whisper> */}\n            {/* <Whisper placement=\"right\" trigger=\"hover\" speaker={(<Tooltip>View</Tooltip>)}> */}\n            <Nav.Item title=\"Camera\" eventKey=\"Camera\" icon={<Icon style={navItemStyle} size=\"lg\" icon=\"eye\"/>}/>\n            {/* </Whisper> */}\n            {/* <Whisper placement=\"right\" trigger=\"hover\" speaker={(<Tooltip>Ambient Light</Tooltip>)}> */}\n            <Nav.Item title=\"Ambient\" eventKey=\"Ambient\"\n                      icon={<Icon style={navItemStyle} size=\"lg\" icon=\"sun-o\"/>}/>\n            {/* </Whisper> */}\n            {/* <Whisper placement=\"right\" trigger=\"hover\" speaker={(<Tooltip>Other Lighting</Tooltip>)}> */}\n            <Nav.Item title=\"Lighting\" eventKey=\"Lighting\"\n                      icon={<Icon style={navItemStyle} size=\"lg\" icon=\"creative\"/>}/>\n            {/* </Whisper> */}\n            {/* <Whisper placement=\"right\" trigger=\"hover\" speaker={(<Tooltip>Reference Frame Frame</Tooltip>)}> */}\n            <Nav.Item title=\"Reference\" eventKey=\"Reference\"\n                      icon={<Icon style={navItemStyle} size=\"lg\" icon=\"cube\"/>}/>\n            {/* </Whisper> */}\n\n        </Nav>\n    </div>);\n};\n\nconst MenuContent = ({active, expand, onChange, model, toggler, functions}) => {\n\n    let menuContent = [];\n\n    if (!expand) {\n        menuContent.push(<NavToggle expand={expand} onChange={onChange}/>);\n    } else {\n        menuContent.push(<div style={{backgroundColor: '#0F131B'}}>\n            <Nav>\n                <Navbar appearance=\"subtle\">\n                    <Nav>\n                        <h3 style={{marginTop: 15, marginLeft: 30}}>{active}</h3>\n                    </Nav>\n                    <Nav pullRight>\n                        <NavToggle expand={expand} onChange={onChange}/>\n                    </Nav>\n                </Navbar>\n\n            </Nav>\n        </div>);\n    }\n\n    if (expand) {\n        switch (active) {\n            case \"Models\":\n                menuContent.push(<ModelsOptions key={active} model={model}/>);\n                break;\n            case \"Camera\":\n                menuContent.push(<CameraOptions key={active} model={model} toggler={toggler}/>);\n                break;\n            case \"Ambient\":\n                menuContent.push(<AmbientLightOptions key={active} model={model}/>);\n                break;\n            case \"Lighting\":\n                menuContent.push(<AdditionalLightOptions key={active} model={model}/>);\n                break;\n            case \"Slicing\":\n                menuContent.push(<SlicingOptions key={active} model={model}/>);\n                break;\n            case \"Reference\":\n                menuContent.push(<ReferenceOptions key={active} model={model}/>);\n                break;\n            case \"Video Rendering\":\n                menuContent.push(<VideoOptions key={active} model={model} functions={functions} toggler={toggler}/>);\n                break;\n            default:\n                Alert.error('Error: Unknown Submenu Identifier');\n        }\n    }\n\n    return menuContent;\n\n}\n\nclass VisualisationMenu extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            expand: props.sidebarExpanded, active: 'Models'\n        };\n        this.functions = props.functions;\n        this.model = props.model;\n        this.handleToggle = this.handleToggle.bind(this);\n        this.handleSelect = this.handleSelect.bind(this);\n        this.toggler = props.toggler;\n\n        this.toggler.closeSidemenu = () => {\n            if (this.state.expand) {\n                this.handleToggle();\n            }\n        }\n    }\n\n    handleToggle() {\n        this.setState({\n            expand: !this.state.expand\n        });\n        this.model.toggleSidebar();\n    }\n\n    handleSelect(activeKey) {\n        this.setState({\n            active: activeKey\n        });\n\n        if (!this.state.expand) {\n            this.handleToggle();\n        }\n\n    }\n\n    render() {\n        const {expand} = this.state;\n        const {active} = this.state;\n        return (<div>\n                <Sidebar\n                    style={{display: 'flex', flexDirection: 'column'}}\n                    width={expand ? 356 : 56}\n                    collapsible\n                    appearance=\"default\"\n                >\n                    <Container>\n                        <Sidebar width={56}>\n                            <CustomNav vertical appearance=\"subtle\" active={active} onSelect={this.handleSelect}/>\n                        </Sidebar>\n                        <Content>\n                            <MenuContent key={10} active={active} expand={expand} onChange={this.handleToggle}\n                                         model={this.model} toggler={this.toggler} functions={this.functions}/>\n                        </Content>\n\n                    </Container>\n\n                </Sidebar>\n            </div>\n\n        );\n    }\n}\n\n\nexport default VisualisationMenu;","import React from \"react\";\nimport GeneralMenu from './GeneralMenu';\nimport VisualisationMenu from './VisualisationMenu';\n\nexport class View {\n    static state;\n    header;\n    sidebar;\n    model;\n    expanded;\n    ModelDefaultState = {\n        active: 0, reset: 0, sets: [], configurations: [],\n    }\n    SlicingDefaultState = {\n        clipIntersection: false,\n        slicing_enabled: false,\n        helpers: [false, false, false],\n        x: [-80, 80],\n        y: [-80, 80],\n        z: [-80, 80]\n    }\n    ConfigurationDefaultState = {\n        title: '', shape: 'Ellipsoid', parameters: {\n            names: ['X', 'Y', 'Z'], vals: [1, 1, 0.2]\n        }, colour: {\n            r: 255, g: 255, b: 255\n        }, colourFromDirector: true, displayAsWireframe: false\n    }\n    CameraDefaultState = {\n        type: 'orthographic', lookAt: {\n            x: 0, y: 0, z: 0\n        }, position: {\n            x: 0, y: 0, z: -15\n        }, zoom: 50\n    }\n    PointLightDefaultState = {\n        reset: 0, active: 'point', enabled: true, helper: false, colour: {\n            r: 255, g: 255, b: 255, i: 60\n        }, position: {\n            x: 5, y: 0, z: 5\n        }\n    }\n    DirectionalLightDefaultState = {\n        reset: 0, active: 'directional', enabled: true, helper: false, colour: {\n            r: 255, g: 255, b: 255, i: 50\n        }, position: {\n            x: -5, y: 0, z: -5\n        }\n\n    }\n    ReferenceDefaultState = {\n        boundingShapeEnabled: false,\n        activeShape: 'box',\n        showAxes: false,\n        multicolour: true,\n        size: 50,\n        fps: 24,\n        uploaded: true,\n        video: false,\n        loadVideoState: false,\n        repeats: {x: 0, y: 0, z: 0}\n    }\n    AmbientLightDefaultState = {\n        ambientLightColour: {\n            r: 255, g: 255, b: 255, i: 40\n        }, darkBackGround: true\n    }\n\n    constructor(m, io, chrono, toggler) {\n        View.state = {}\n        this.expanded = false;\n        this.model = m;\n        this.header = <GeneralMenu chronometer={chrono} functions={io} model={this.model} toggler={toggler}/>;\n        this.sidebar =\n            <VisualisationMenu model={this.model} functions={io} sidebarExpanded={this.expanded} toggler={toggler}/>;\n    }\n\n    getData() {\n        return View.state;\n    }\n\n    setState(state, vid) {\n        View.state = state;\n        if (!vid) {\n            this.loadLightingAndCamera(state, vid);\n        }\n        if (View.state.reference.repeats === undefined) {\n            View.state.reference.repeats = this.ReferenceDefaultState.repeats\n        }\n        this.loadReferenceAndSlicing(state);\n        this.loadModel(state);\n    }\n\n    loadModel(state) {\n        let substate;\n        for (let i in state.model.configurations) {\n            substate = state.model.configurations[i];\n            this.model.updateUserColour(i, substate.colour);\n            this.model.toggleUserColour(i, substate.colourFromDirector);\n            this.model.toggleWireframe(i, substate.displayAsWireframe);\n            this.model.toggleFoldState(i, substate.displayFoldState);\n            this.model.updateShape(i, substate.shape, substate.parameters);\n        }\n        this.model.updateBoundingShape(state.reference.activeShape, state.reference.boundingShapeEnabled)\n    }\n\n    loadState(state, vid) {\n        if (!vid) {\n            this.loadLightingAndCamera(state, vid);\n        }\n        this.loadReferenceAndSlicing(state);\n\n    }\n\n    loadReferenceAndSlicing(state) {\n        if (this.xor(this.model.axesEnabled, state.reference.showAxes)) {\n            this.model.toggleAxes();\n        }\n        this.model.toggleFoldState(0, state.boundingShapeEnabled);\n        this.model.enableClipping(state.slicing.slicing_enabled);\n        this.model.toggleHelper(0, state.slicing.helpers[0]);\n        this.model.toggleHelper(1, state.slicing.helpers[1]);\n        this.model.toggleHelper(2, state.slicing.helpers[2]);\n        this.model.updateSlicer(0, state.slicing.x);\n        this.model.updateSlicer(1, state.slicing.y);\n        this.model.updateSlicer(2, state.slicing.z);\n\n    }\n\n    loadLightingAndCamera(state, vid) {\n        console.log('called load light')\n        let directionalLightColour = JSON.parse(JSON.stringify(state.directionalLight.colour));\n        let pointLightColour = JSON.parse(JSON.stringify(state.pointLight.colour));\n\n        if (!state.directionalLight.enabled) {\n            directionalLightColour.i = 0;\n        }\n        if (!state.pointLight.enabled) {\n            pointLightColour.i = 0;\n        }\n        if (state.ambientLight.darkBackGround) {\n            this.model.updateBg(\"#000000\");\n        }\n        if (!state.ambientLight.darkBackGround) {\n            this.model.updateBg('#FFFFFF');\n        }\n        this.model.updateLight(0, state.ambientLight.ambientLightColour);\n        this.model.updateLight(1, directionalLightColour);\n        this.model.updateLight(2, pointLightColour);\n        this.model.updateLightPosition(1, state.directionalLight.position);\n        this.model.updateLightPosition(2, state.pointLight.position);\n        this.model.toggleLightHelper(1, state.directionalLight.helper);\n        this.model.toggleLightHelper(2, state.pointLight.helper);\n        if (!vid) {\n            this.model.setCamera(state.camera.type, false);\n            this.model.updateCameraPosition(state.camera.position);\n        }\n        this.model.updateLookAt(state.camera.lookAt);\n        this.model.updateCameraZoom(state.camera.zoom);\n    }\n\n    setDefaultState(init, vid) {\n        View.state = {};\n        View.state.reference = this.ReferenceDefaultState;\n        View.state.ambientLight = this.AmbientLightDefaultState;\n        View.state.pointLight = this.PointLightDefaultState;\n        View.state.directionalLight = this.DirectionalLightDefaultState;\n        View.state.camera = this.CameraDefaultState;\n        View.state.slicing = this.SlicingDefaultState;\n        View.state.model = this.ModelDefaultState;\n        View.state.model.configurations = [];\n        View.state.model.sets = [];\n\n        for (let i in this.model.sets) {\n            let set = JSON.parse(JSON.stringify(this.ConfigurationDefaultState));\n            set.title = this.model.sets[i].name;\n            View.state.model.sets.push(set.title);\n            View.state.model.configurations.push(set);\n        }\n\n        this.loadState(View.state, vid);\n\n        if (!init) {\n            this.loadModel(View.state);\n        }\n    }\n\n    xor(a, b) {\n        return (a && !b) || (!a && b);\n    }\n\n}\n\nexport default View;","import Model from \"./Model/Model\";\nimport View from \"./View/View\"\nimport 'rsuite/dist/styles/rsuite-dark.css';\nimport {mean, std} from 'mathjs';\nimport unfolded_sample1 from './Samples/UnfoldedSC4.json';\nimport unfolded_sample2 from './Samples/UnfoldedE3.json';\nimport sample1 from './Samples/dummy-vector.json';\nimport sample2 from './Samples/dummy-quaternion.json';\nimport sample3 from './Samples/sc4-isotropic.json';\nimport sample4 from './Samples/sc4-nematic.json';\nimport sample5 from './Samples/sc4-smectic.json';\nimport sample6 from './Samples/e5-isotropic.json';\nimport sample7 from './Samples/e5-nematic.json';\nimport sample8 from './Samples/o5-isotropic.json';\nimport sample9 from './Samples/o5-nematic.json';\nimport sample10 from './Samples/bx-crystal.json';\nimport sample11 from './Samples/bx-crystal-2.json';\nimport sample12 from './Samples/fig1.json';\nimport sample13 from './Samples/hbc.json';\nimport sample14 from './Samples/single.json'\nimport sample15 from './Samples/qmga-shapes.json'\n\nimport {Alert, Notification} from 'rsuite'\n\n\nclass Controller {\n    model;\n    view;\n    io;\n    ExternalToggle = class ExternalToggle {\n        // these functions are defined within their respective React components\n        closeSidemenu = () => {\n        }\n        autorotate = () => {\n        }\n        updateCamera = () => {\n        }\n\n    }\n    Chronometer = class Chronometer {\n\n        constructor(notify, externalToggle) {\n            this.fps = 0;\n            this.frames = 0;\n            this.prevTime = null;\n            this.model = null;\n\n            this.notify = notify;\n            this.externalToggle = externalToggle;\n\n            this.step = 5000;\n            this.tick = 12;\n            this.testing = false;\n            this.counter = 0;\n            this.rawPerformanceData = [];\n            this.avgPerformanceData = [];\n            this.stdPerformanceData = [];\n        }\n\n        f = (n) => {\n            //is initialised in Header React Component\n        }\n\n        fps = () => {\n            return this.fps;\n        }\n\n        logPerformance = () => {\n            this.rawPerformanceData.push(this.fps);\n            if (this.counter === this.tick) {\n                this.avgPerformanceData.push(mean(this.rawPerformanceData));\n                this.stdPerformanceData.push(std(this.rawPerformanceData));\n                this.rawPerformanceData = [];\n                this.counter = 0;\n\n                this.notify('info', ' Test Update (' + this.model.testTotal.toString() + ' Molecules)', (\n                    <p style={{width: 320}}>\n                        <b>FPS</b> <br/>\n                        Average: {this.avgPerformanceData[this.avgPerformanceData.length - 1].toString()} <br/>\n                        Standard Deviation: {this.stdPerformanceData[this.stdPerformanceData.length - 1].toString()}\n                        <br/>\n                    </p>));\n\n                console.log('# of Molecules: ' + this.model.testTotal.toString() + ' FPS - Avg:  ' + this.avgPerformanceData[this.avgPerformanceData.length - 1].toString() + 'Std: ' + this.stdPerformanceData[this.stdPerformanceData.length - 1].toString())\n\n                if (this.model.addRandomParticles(this.step)) {\n                    this.testing = false;\n                    this.model.deleteAllMeshes();\n                    console.log('Average FPS');\n                    console.log(this.avgPerformanceData);\n                    console.log('Std FPS');\n                    console.log(this.stdPerformanceData);\n                    this.externalToggle.autorotate();\n                    this.notify('success', 'Test Completed Succesfully', (<p style={{width: 320}}>\n                        All molecules deleted. Please see console output for a list of average FPS and standard\n                        deviations.\n                    </p>));\n\n                }\n            }\n            this.counter++;\n        }\n\n\n        click = () => {\n            this.frames++;\n\n            if (this.prevTime === null) {\n                this.prevTime = Date.now();\n            }\n\n            let time = Date.now();\n\n\n            if (time > this.prevTime + 1000) {\n                this.fps = (this.frames * 1000) / (time - this.prevTime);\n\n                if (this.testing) {\n                    this.logPerformance();\n                }\n\n                this.prevTime = time;\n                this.frames = 0;\n                this.f(this.fps);\n\n\n            }\n        }\n    };\n\n    constructor() {\n\n        this.io = [this.save, this.load, this.export, this.loadSample, this.toggleAutorotate, this.saveVideoState];\n        this.externalToggle = new this.ExternalToggle();\n        this.chronometer = new this.Chronometer(this.notify, this.externalToggle);\n\n        this.model = new Model(this.chronometer, this.notify);\n        this.view = new View(this.model, this.io, this.chronometer, this.externalToggle);\n\n        Alert.config(({\n            top: 70, duration: 8000\n        }));\n\n    }\n\n    start = () => {\n        this.chronometer.model = this.model;\n        this.generate(sample2, true, false);\n        // this.model.occlusionCulling();\n        this.addListeners();\n        this.notify('info', `Welcome to WebMGA`, (<div>\n            <p style={{width: 320}}>\n                Check out the liquid crystal configurations in the Library, and head to the About section to\n                learn more!\n\n            </p>\n            <p style={{width: 320}}>\n                This application works best on the Chrome browser.\n            </p></div>));\n        // this.loadVideoSample();\n    }\n\n\n    notify(type, title, description) {\n        Notification[type]({\n            title: title, placement: 'bottomEnd', duration: 7000, description: description\n        });\n    }\n\n    //from stackoverflow\n    download = (data, filename, type) => {\n        let file = new Blob([data], {type: type});\n        if (window.navigator.msSaveOrOpenBlob) // IE10+\n            window.navigator.msSaveOrOpenBlob(file, filename); else { // Others\n            let a = document.createElement(\"a\"), url = URL.createObjectURL(file);\n            a.href = url;\n            a.download = filename;\n            document.body.appendChild(a);\n            a.click();\n            setTimeout(function () {\n                document.body.removeChild(a);\n                window.URL.revokeObjectURL(url);\n            }, 0);\n        }\n    }\n\n    save = () => {\n        let data = {};\n        data.model = this.model.getData();\n        data.state = this.view.getData();\n        this.download(JSON.stringify(data), 'visualisation.webmga', 'application/json');\n    }\n\n    saveVideoState = () => {\n        let data = {};\n        data.state = this.view.getData();\n        console.log('get state');\n        return JSON.stringify(data);\n\n    }\n\n    generate = (data, starting, vidstate) => {\n        this.model.genSets(data.model.sets);\n        if (data.state == null) {\n            if (vidstate) {\n                this.view.setState((JSON.parse(vidstate)).state, true);\n            } else {\n                this.view.setDefaultState(starting, false);\n                Alert.info(\"Setting default viewing state.\");\n            }\n        } else {\n            this.view.setState(data.state, false);\n        }\n        this.model.update();\n        this.externalToggle.closeSidemenu();\n    }\n\n    load = (file, VIDEO, vidstate) => {\n        let fileReader = new FileReader();\n        fileReader.onloadend = () => {\n            let data;\n            if (file.type === \"application/json\") {\n                data = JSON.parse(fileReader.result);\n            } else if (file.name.split(\".\").pop().toLowerCase() === \"qmga\") {\n                data = this.qmga_to_json(fileReader.result);\n            } else {\n                data = this.cnf_to_json(fileReader.result);\n            }\n            try {\n                console.log(vidstate);\n                this.generate(data, false, vidstate);\n                if (VIDEO === false) {\n                    Alert.success('File loaded successfully.');\n                }\n            } catch {\n                Alert.error('Error: Please review uploaded file. See manual for help.');\n            }\n        };\n        fileReader.readAsText(file);\n    }\n\n    qmga_to_json(data) {\n        let set = {name: \"Molecules\", orientationType: \"v\"}\n        let split_data = data.trim().split(\"\\n\")\n        let unit_box = split_data[0].split(/ +/)\n        set.unitBox = [parseFloat(unit_box[0]) / 2, parseFloat(unit_box[1]) / 2, parseFloat(unit_box[2]) / 2]\n        let molecule_count = split_data.length - 1\n        set.positions = new Array(molecule_count)\n        set.orientations = new Array(molecule_count)\n        for (let molecule_number = 0; molecule_number < molecule_count; ++molecule_number) {\n            let molecule_data = split_data[molecule_number + 1].trim().split(/ +/)\n            //TODO need to implement scale at position 0\n            set.positions[molecule_number] = molecule_data.slice(1, 4).map(value => parseFloat(value))\n            set.orientations[molecule_number] = molecule_data.slice(4, 7).map(value => parseFloat(value))\n        }\n        return {model: {sets: [set]}, state: null}\n    }\n\n    cnf_to_json(data) {\n        let set = {name: \"Molecules\", orientationType: \"v\"}\n        let split_data = data.trim().split(\"\\n\")\n        set.unitBox = [parseFloat(split_data[1]), parseFloat(split_data[2]), parseFloat(split_data[3])]\n        let molecule_count = parseInt(split_data[0])\n        set.positions = new Array(molecule_count)\n        set.orientations = new Array(molecule_count)\n        for (let molecule of split_data.slice(5)) {\n            let molecule_data = molecule.trim().split(/ +/)\n            let molecule_number = parseInt(molecule_data[12]) - 1\n            set.positions[molecule_number] = molecule_data.slice(0, 3).map(value => parseFloat(value))\n            set.orientations[molecule_number] = molecule_data.slice(6, 9).map(value => parseFloat(value))\n        }\n        return {model: {sets: [set]}, state: null}\n    }\n\n\n    loadSample = (id) => {\n        let sample;\n\n        switch (id) {\n            case 1:\n                sample = sample1;\n                break;\n            case 2:\n                sample = sample2;\n                break;\n            case 3:\n                sample = sample3;\n                break;\n            case 4:\n                sample = sample4;\n                break;\n            case 5:\n                sample = sample5;\n                break;\n            case 6:\n                sample = sample6;\n                break;\n            case 7:\n                sample = sample7;\n                break;\n            case 8:\n                sample = sample8;\n                break;\n            case 9:\n                sample = sample9;\n                break;\n            case 10:\n                sample = sample10;\n                break;\n            case 11:\n                sample = sample11;\n                break;\n            case 12:\n                sample = sample12;\n                break;\n            case 13:\n                sample = sample13;\n                break;\n            case 14:\n                sample = sample14;\n                break;\n            case 15:\n                sample = sample15;\n                break;\n            case 17:\n                sample = unfolded_sample1;\n                break;\n            case 18:\n                sample = unfolded_sample2;\n                break;\n            default:\n                Alert.error('Error: File does not exist');\n                return;\n        }\n\n        this.generate(sample, false, false);\n\n\n        Alert.success('File loaded successfully.');\n\n    }\n    export = (height, width, resolution) => {\n        // fix orthographic projection\n        this.model.height = height;\n        this.model.width = width;\n        this.model.updateCamera();\n\n        this.model.renderer.setSize(width, height);\n\n        this.model.renderer.render(this.model.scene, this.model.camera);\n\n        const dataURL = this.model.renderer.domElement.toDataURL(\"image/jpeg\", resolution / 10);\n\n        let link = document.createElement('a');\n        link.download = \"WebMGA Visualisation.jpeg\";\n        link.href = dataURL;\n        link.click();\n\n        this.model.updateDimensions();\n        this.model.updateCamera();\n\n\n        this.notify('success', `Thank you!`, (<div>\n            Image exported successfully.\n        </div>));\n    }\n\n    getHeader = () => {\n        return this.view.header;\n    }\n\n    getSidebar = () => {\n        return this.view.sidebar;\n    }\n\n\n    getDomElement = () => {\n        return this.model.renderer.domElement;\n    }\n\n    updateCamera = () => {\n        View.state.camera.position.x = Math.round(this.model.camera.position.x * 100) / 100;\n        View.state.camera.position.y = Math.round(this.model.camera.position.y * 100) / 100;\n        View.state.camera.position.z = Math.round(this.model.camera.position.z * 100) / 100;\n\n        View.state.camera.lookAt.x = Math.round(this.model.controls.target.x * 100) / 100;\n        View.state.camera.lookAt.y = Math.round(this.model.controls.target.y * 100) / 100;\n        View.state.camera.lookAt.z = Math.round(this.model.controls.target.z * 100) / 100;\n\n        View.state.camera.zoom = this.model.camera.zoom;\n\n\n        this.externalToggle.updateCamera();\n    }\n\n    render = () => {\n        this.model.update();\n        this.updateCamera();\n    }\n\n    addListeners = () => {\n        this.model.controls.addEventListener('change', this.render);\n\n        document.body.style.overflow = \"hidden\";\n\n        window.addEventListener('resize', () => {\n            this.model.updateDimensions();\n            this.model.updateCamera();\n        });\n\n        document.addEventListener('fullscreenchange', () => {\n            this.model.updateDimensions();\n            this.model.updateCamera();\n        });\n\n\n        document.body.onkeydown = (e) => {\n            switch (e.code) {\n                case 'Space':\n                    this.externalToggle.autorotate();\n                    if (this.chronometer.testing) {\n                        this.chronometer.testing = false;\n                    }\n                    break;\n                case  'KeyA':\n                    console.log(this.model.camera.position);\n                    break;\n            }\n\n            // //g\n            // if (key == 71) {\n            //     this.model.toggleGrid();\n            // }\n            // if (key == 69) {\n            //     this.view.toggleSidebar();\n            // }\n        }\n    }\n}\n\nexport default Controller;","import React, {Component} from \"react\";\nimport 'rsuite/dist/styles/rsuite-dark.css';\nimport {Container, Content} from 'rsuite';\nimport Controller from \"./Controller\";\n\nclass App extends Component {\n    controller;\n\n    constructor(props) {\n        super(props);\n        this.controller = new Controller();\n\n        this.state = {\n            header: this.controller.getHeader(), sidebar: this.controller.getSidebar()\n        };\n    }\n\n    componentDidMount() {\n        this.mount.appendChild(this.controller.getDomElement());\n        this.controller.start();\n    }\n\n    render() {\n        const header = this.state.header;\n        const sidebar = this.state.sidebar;\n\n        return (<div>\n            <Container>\n                {header}\n                <Container>\n                    {sidebar}\n                    <Content>\n                        <div ref={ref => (this.mount = ref)}/>\n                    </Content>\n                </Container>\n\n            </Container>\n\n        </div>)\n    }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(<React.StrictMode> <App/> </React.StrictMode>, document.getElementById('root'));\n"],"sourceRoot":""}